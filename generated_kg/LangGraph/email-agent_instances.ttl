# Execution time: 97.71 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - The ontology lacks a dedicated class for "email" artifacts with structured fields; modeled emails as beam:Instance (subclass of beam:Resource) and captured structured fields as literal properties within the instance description.
# - The ontology does not include a native construct to represent tool schemas/programmatic validation (Zod schemas, argument typing, or tool_call metadata). These are preserved as literal strings in Config instances.
# - The ontology does not have classes/properties to represent conditional routing logic and route functions explicitly (e.g., routeAfterInterrupt, routeAfterWritingEmail). These are captured as descriptions attached to relevant WorkflowStep and Task individuals.
# - The ontology does not have a specific property/class to capture "human response" structured data (HumanResponse with types "ignore", "response", "accept", "edit"). Modeled human responses indirectly (HumanAgent participates in interrupt task) and the allowed interrupt config encoded in a Config literal.
# - The ontology lacks a property to represent tool binding choice (tool_choice). This is recorded as a literal in Tool config.
# - No code or framework-specific constructs (e.g., function names, SDK calls) are stored. Only semantic elements (prompts, schemas, capabilities, resources, workflow topology, configs) are included so the solution can be re-created semantically.
# - Assumed the workflow pattern "Email Assistant" is a single-agent workflow (no Team used).
# - No additional classes or properties were added; only existing ones from the provided ontology were used.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .

#################################################################
# Instances for Email Assistant Agent solution
#################################################################

### Language model used by the agent
:GPT4oModel rdf:type :LanguageModel ;
  rdfs:label "gpt-4o (ChatOpenAI)" ;
  dcterms:description """ChatOpenAI model used as the LLM backing the agent. The implementation used model "gpt-4o" with deterministic generation (temperature 0).""" ;
  dcterms:title "gpt-4o" .

### Agent configuration (model and temperature)
:EmailAgentConfig rdf:type :Config ;
  rdfs:label "Email Agent Config" ;
  :configKey "model" ;
  :configValue "gpt-4o" ;
  dcterms:description "Primary LLM configuration for the agent (model and temperature). Note: temperature recorded below as separate config entry." .

:EmailAgentConfig_Temperature rdf:type :Config ;
  rdfs:label "Email Agent Config - temperature" ;
  :configKey "temperature" ;
  :configValue "0" ;
  dcterms:description "Temperature config for deterministic responses." .

### Tool representing the 'write_email' tool bound to the model
:WriteEmailTool rdf:type :Tool ;
  rdfs:label "write_email tool (schema-bound)" ;
  dcterms:description """Tool binding used by the LLM to produce structured email objects. Description: "Write an email based on the conversation history".""";
  :hasToolConfig :WriteEmailTool_SchemaConfig ;
  :hasCapability :Capability_ComposeEmail .

:WriteEmailTool_SchemaConfig rdf:type :Config ;
  rdfs:label "write_email tool schema config" ;
  :configKey "schema" ;
  :configValue """z.object({
  subject: z.string().describe("The subject of the email"),
  body: z.string().describe("The body of the email"),
  to: z.string().describe("The recipient of the email"),
})""" ;
  dcterms:description """The tool expects an argument object that matches the schema for an email with fields: subject, body, to. Stored as a literal representation of the Zod schema used in the implementation. The tool was bound with name "write_email" and description "Write an email based on the conversation history".""". 

### Agent individual
:EmailAssistantAgent rdf:type :LLMAgent ;
  rdfs:label "Email Assistant Agent" ;
  dcterms:description """An LLM-based agent that assists with writing, editing, and sending emails by generating a structured email (subject, body, to), presenting an interrupt UI for human edit/accept/ignore/response, and optionally sending the email. Agent name set to "Email Assistant Agent" in the implementation.""" ;
  :agentID "email-assistant-agent" ;
  :agentRole "email_assistant" ;
  :hasAgentConfig :EmailAgentConfig , :EmailAgentConfig_Temperature ;
  :useLanguageModel :GPT4oModel ;
  :agentToolUsage :WriteEmailTool ;
  :hasAgentCapability :Capability_ComposeEmail , :Capability_RewriteEmail , :Capability_SendEmail , :Capability_HandleHumanInterrupt .

### Agent capabilities
:Capability_ComposeEmail rdf:type :Capability ;
  rdfs:label "Compose Email" ;
  rdfs:comment "Generate a draft email (subject, body, to) from conversation history." .

:Capability_RewriteEmail rdf:type :Capability ;
  rdfs:label "Rewrite Email" ;
  rdfs:comment "Rewrite email content given user's response/instructions; should only change requested fields." .

:Capability_SendEmail rdf:type :Capability ;
  rdfs:label "Send Email" ;
  rdfs:comment "Finalize and send the composed email (in this implementation it yields a confirmation message indicating successful send)." .

:Capability_HandleHumanInterrupt rdf:type :Capability ;
  rdfs:label "Handle Human Interrupt" ;
  rdfs:comment "Present the email to a human for review and accept/edit/ignore/response and handle the resulting input accordingly." .

### Resources (inputs/outputs)
:ConversationHistory rdf:type beam:Instance ;
  rdfs:label "Conversation History" ;
  dcterms:description "Sequence of messages between user and agent used as input to generate the email. In implementation substituted into the prompt via {CONVERSATION}." .

:DraftEmailResource rdf:type beam:Instance ;
  rdfs:label "Draft Email" ;
  dcterms:description """Structured email artifact with fields:
- subject: string
- body: string
- to: string

This is the primary data produced by the writing and rewriting tasks. The implementation expects these exact fields.""";
  # store placeholder fields; actual values are produced runtime per instance
  :configKey "email.subject" ;
  :configValue "" ;
  :stepOrder 0 .

:SentEmailRecord rdf:type beam:Instance ;
  rdfs:label "Sent Email Record" ;
  dcterms:description "A record/artifact representing that the email was sent. In implementation returned as an AI message: 'Successfully sent email.' (represented as an artifact here)." .

:HumanResponseResource rdf:type beam:Instance ;
  rdfs:label "Human Response (interrupt result)" ;
  dcterms:description """Represents the human-interaction result from the interrupt UI. Possible response types recorded in implementation: 'ignore', 'response', 'accept', or 'edit' (with args carrying edited email fields). This ontology stores allowed values in the interrupt config and records that user participated in interrupt interactions.""" .

### Prompts
:WriteEmailPrompt rdf:type :Prompt ;
  rdfs:label "Write Email Prompt" ;
  :promptInstruction """You're an AI email assistant, tasked with writing an email for the user.
Use the entire conversation history between you, and the user to craft the email for them.

<conversation>
{CONVERSATION}
</conversation>

If there is NOT enough information to send an email, respond to the user requesting the missing information.
Required fields:
- subject - The subject of the email
- body - The body of the email
- to - The recipient of the email""" ;
  :promptContext "Build an email from conversation history." ;
  dcterms:description "This prompt is used by the write-email task; inputs include {CONVERSATION} which is replaced by conversation history." .

:RewriteEmailPrompt rdf:type :Prompt ;
  rdfs:label "Rewrite Email Prompt" ;
  :promptInstruction """You're an AI email assistant, tasked with rewriting an email for the user.
Here is the current state of the email for the user:
<email>
  <subject>
    {SUBJECT}
  </subject>
  <body>
    {BODY}
  </body>
  <to>
    {TO}
  </to>
</email>

Here is the user's response, which should contain some request for changes to the email:
<user-response>
{USER_RESPONSE}
</user-response>

Given that, please rewrite the email. Do NOT modify anything the user does not request to be changed.""" ;
  :promptContext "Rewrite an existing draft email only according to user request. Inputs: {SUBJECT}, {BODY}, {TO}, {USER_RESPONSE}." ;
  dcterms:description "Used by rewrite-email task; will call the same write_email tool with tool_choice set to write_email." .

:InterruptPrompt rdf:type :Prompt ;
  rdfs:label "Interrupt / Human Review Prompt" ;
  :promptInstruction """# New Email
  
## Subject
{SUBJECT}

## To
{TO}

## Body
{BODY}

## Response Instructions

- **Response**: Any response submitted will be passed to an LLM to rewrite the email. It can rewrite the email body, subject, or recipient.

- **Edit or Accept**: Editing/Accepting the email will send the email.

- **Ignore**: Ignoring the email will end the conversation, and the email will not be sent.""" ;
  :promptContext "Displayed to the human to review the current draft email and choose an action (ignore, response, edit, accept)." ;
  dcterms:description "The interrupt step displays the draft and enumerates allowed actions. This literal contains the exact formatted description used in the implementation." .

### Interrupt configuration (what allowed actions are)
:InterruptConfig rdf:type :Config ;
  rdfs:label "Interrupt Interaction Config" ;
  :configKey "allow_ignore" ;
  :configValue "true" ;
  dcterms:description "Allowed interrupt actions and behavior recorded for the human review UI. Additional flags:" ;
  :configKey "allow_respond" ;
  :configValue "true" ;
  :configKey "allow_edit" ;
  :configValue "true" ;
  :configKey "allow_accept" ;
  :configValue "true" ;
  :configKey "action_request" ;
  :configValue """{ action: "New Email Draft", args: { subject, body, to } }""" ;
  :configKey "description" ;
  :configValue """(see Interrupt / Human Review Prompt)""" .

### Tasks (semantic actions represented by the nodes)
:WriteEmailTask rdf:type :Task ;
  rdfs:label "writeEmail (generate draft)" ;
  dcterms:description """Generates a draft email (subject, body, to) by invoking the LLM with the Write Email Prompt and a tool named "write_email" implementing the sendEmailSchema. If insufficient information, prompts the user for missing information. Produces Draft Email resource and a model response message.""";
  :requiresResource :ConversationHistory ;
  :producedResource :DraftEmailResource ;
  :hasPrompt :WriteEmailPrompt ;
  :requiresCapability :Capability_ComposeEmail ;
  :performedByAgent :EmailAssistantAgent .

:RewriteEmailTask rdf:type :Task ;
  rdfs:label "rewriteEmail (apply user's requested changes)" ;
  dcterms:description """Rewrites a previously generated draft email in response to a human 'response' action. It uses the Rewrite Email Prompt with substitution of the current draft and the human response text; it calls the same structured tool (write_email) and returns a new Draft Email resource. Implementation enforces: only proceed if humanResponse.args is a string and an existing email exists; otherwise error.""";
  :requiresResource :DraftEmailResource ;
  :producedResource :DraftEmailResource ;
  :hasPrompt :RewriteEmailPrompt ;
  :requiresCapability :Capability_RewriteEmail ;
  :performedByAgent :EmailAssistantAgent .

:SendEmailTask rdf:type :Task ;
  rdfs:label "sendEmail (finalize & send)" ;
  dcterms:description """Finalizes and sends the email. In the implementation this yields a confirmation AI message 'Successfully sent email.' and produces a SentEmailRecord resource. This task is reached when the human accepts or when routing logic selects sending directly.""";
  :requiresResource :DraftEmailResource ;
  :producedResource :SentEmailRecord ;
  :requiresCapability :Capability_SendEmail ;
  :performedByAgent :EmailAssistantAgent .

:InterruptTask rdf:type :Task ;
  rdfs:label "interrupt (human review/edit/accept/ignore)" ;
  dcterms:description """Presents the current draft email to a human actor with allowed actions: ignore, response, edit, accept. If 'ignore' or no response -> ends conversation. If 'response' -> passes human text to rewriteEmail. If 'accept' or 'edit' (with structured args) -> may send or update the draft depending on edit content. Implementation validates edits contain subject, body, to when edit action used.""";
  :requiresResource :DraftEmailResource ;
  :producedResource :HumanResponseResource ;
  :hasPrompt :InterruptPrompt ;
  :requiresCapability :Capability_HandleHumanInterrupt .

### PerformedBy / performedByAgent relationships (who performs tasks)
:WriteEmailTask :performedByAgent :EmailAssistantAgent .
:RewriteEmailTask :performedByAgent :EmailAssistantAgent .
:SendEmailTask :performedByAgent :EmailAssistantAgent .
# Interrupt is a human-interaction task (human participates)
:InterruptTask rdfs:comment "Human is the primary participant in this step for review and decisions." .

### Human agent (user)
:UserHuman rdf:type :HumanAgent ;
  rdfs:label "End User (human reviewer)" ;
  dcterms:description "Human who reviews the draft email presented by interrupt and may ignore/respond/edit/accept." ;
  :humanParticipatedIn :InterruptTask .

### Workflow pattern and steps representing the state graph
:EmailAssistantWorkflow rdf:type :WorkflowPattern ;
  rdfs:label "Email Assistant Workflow Pattern" ;
  dcterms:description "Workflow representing the state graph with nodes: writeEmail -> interrupt -> [sendEmail | rewriteEmail | END]. rewriteEmail -> interrupt. sendEmail -> END." ;
  :hasWorkflowStep :WriteEmailStep , :InterruptStep , :RewriteEmailStep , :SendEmailStep .

:WriteEmailStep rdf:type :StartStep ;
  rdfs:label "writeEmail (start step)" ;
  :stepOrder 1 ;
  :hasAssociatedTask :WriteEmailTask ;
  rdfs:comment "Initial step: generate draft from conversation history." ;
  :nextStep :InterruptStep .

:InterruptStep rdf:type :WorkflowStep ;
  rdfs:label "interrupt (human review step)" ;
  :stepOrder 2 ;
  :hasAssociatedTask :InterruptTask ;
  rdfs:comment "Human review step; branching depends on human action." ;
  # possible next steps from interrupt: sendEmail, rewriteEmail, or end; record as related steps
  :relatedStep :SendEmailStep , :RewriteEmailStep .

:RewriteEmailStep rdf:type :WorkflowStep ;
  rdfs:label "rewriteEmail (revision step)" ;
  :stepOrder 3 ;
  :hasAssociatedTask :RewriteEmailTask ;
  rdfs:comment "When human responds with free text, rewrite the draft and go back to interrupt." ;
  :nextStep :InterruptStep .

:SendEmailStep rdf:type :EndStep ;
  rdfs:label "sendEmail (send & end)" ;
  :stepOrder 4 ;
  :hasAssociatedTask :SendEmailTask ;
  rdfs:comment "When human accepts or route selects send, send the email and end the workflow." .

### Workflow topology and mapping to tasks (associations)
:WriteEmailStep :hasAssociatedTask :WriteEmailTask .
:InterruptStep :hasAssociatedTask :InterruptTask .
:RewriteEmailStep :hasAssociatedTask :RewriteEmailTask .
:SendEmailStep :hasAssociatedTask :SendEmailTask .

### Additional documentation of routing logic (captured as descriptions on the workflow)
:EmailAssistantWorkflow dcterms:description """Routing logic (semantic description from implementation):
- Start at writeEmail.
- After writeEmail: if no email produced -> END. Else -> interrupt (human review).
- In interrupt:
  - if human response type is missing or 'ignore' -> END.
  - if human response type is 'response' -> rewriteEmail.
  - if human response type is 'accept' or 'edit' (with edited email args) -> sendEmail (or update draft then send).
- After rewriteEmail -> interrupt.
- sendEmail -> END.
""".

#################################################################
# Link tasks to prompts and configs (explicit)
#################################################################
:WriteEmailTask :taskPrompt :WriteEmailPrompt .
:RewriteEmailTask :taskPrompt :RewriteEmailPrompt .
:InterruptTask :taskPrompt :InterruptPrompt .

:WriteEmailTool :hasToolConfig :WriteEmailTool_SchemaConfig .
:EmailAssistantAgent :hasAgentConfig :EmailAgentConfig , :EmailAgentConfig_Temperature .
:InterruptTask :hasConfig :InterruptConfig .

#################################################################
# Minimal metadata and provenance hints
#################################################################
:EmailAssistantAgent rdfs:comment "Compiled state graph agent named 'Email Assistant Agent' that orchestrates prompts, tool calls, human interrupts, and send actions." .

# End of instance data.