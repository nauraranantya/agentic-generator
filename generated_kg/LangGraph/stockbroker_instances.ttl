# Execution time: 92.47 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - The ontology does not have explicit constructs for:
#   - "StateGraph" or nodes/edges semantics (start node, transitions, compiled graph). We modeled the high-level workflow as a WorkflowPattern and a WorkflowStep but not the runtime graph structure or node/IDs.
#   - Tool-call runtime metadata (tool_call id, tool_calls array structure, arguments object structure, binding/SDK semantics). We modeled tool schemas and preserved argument field names/types as literals but did not create a separate object model for tool_call messages or ids.
#   - UI components, typed UI mapping, and React/server UI specifics. These were deliberately omitted per instructions; we preserved only the semantic intent (UI items produced) as resource descriptions.
#   - Implementation-level details such as function names, TypeScript types, imports, fetch/pagination control flow, and error handling. We represented the effects (e.g., fetching prices, paginated retrieval, snapshot endpoint) as tasks/tools and descriptions, not as code.
# - Environment variables and runtime secrets (FINANCIAL_DATASETS_API_KEY) are modeled as Resources with descriptions; this does not model secure storage or access controls.
# - The ontology lacks a dedicated property to represent "tool schemas" as structured data. We stored the tool schemas as Config instances (configKey/configValue) attached to the Tool via hasToolConfig. This preserves the schema text but is not a typed schema object in the ontology.
# - The ontology has no property specifically for "tool call arguments" or "tool call response structure." We modeled argument names and expected outputs in Prompt and Config descriptions and preserved schema text literals.
# - The dynamic, conversational "messages" state (state.messages) was preserved semantically as an LLM message resource but not modeled as a mutable sequence. The ontology captures that the agent passes conversation messages to the LLM but not the exact runtime order.
# - No new classes or properties were added. Some implementation details were necessarily condensed into description literals or Config entries to preserve fidelity.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@base <http://www.w3id.org/agentic-ai/onto#> .

#################################################################
# Individuals for Stockbroker agent solution
#################################################################

# Language Model used by the agent
:Gpt4oMini a :LanguageModel ;
    rdfs:label "gpt-4o-mini" ;
    dcterms:description "Statistical language model used by the Stockbroker agent (model name used in ChatOpenAI constructor)." .

# Agent individual
:StockbrokerAgent a :LLMAgent ;
    rdfs:label "Stockbroker Agent" ;
    :agentID "stockbroker_01" ;
    :agentRole "stockbroker" ;
    :useLanguageModel :Gpt4oMini ;
    :hasAgentConfig :StockbrokerAgentConfig_Temperature ,
                    :StockbrokerAgentConfig_Model ,
                    :StockbrokerAgentConfig_Tools ;
    :hasAgentGoal :GetStockInfoGoal ;
    :hasKnowledge :StockbrokerKnowledgeBase ;
    :agentPrompt :StockbrokerSystemPrompt ;
    :agentToolUsage :Tool_StockPrice ,
                    :Tool_Portfolio ,
                    :Tool_BuyStock ;
    :operatesIn :TradingEnvironment .

# Agent configuration items (stored as Config individuals)
:StockbrokerAgentConfig_Temperature a :Config ;
    :configKey "temperature" ;
    :configValue "0" ;
    rdfs:label "Agent temperature config" ;
    dcterms:description "Temperature used when constructing the language model call (temperature: 0)." .

:StockbrokerAgentConfig_Model a :Config ;
    :configKey "model" ;
    :configValue "gpt-4o-mini" ;
    rdfs:label "Agent model config" ;
    dcterms:description "Specifies the language model name passed to the LLM API wrapper." .

:StockbrokerAgentConfig_Tools a :Config ;
    :configKey "tools" ;
    :configValue "stock-price, portfolio, buy-stock" ;
    rdfs:label "Agent tools config" ;
    dcterms:description "List of tools bound to the LLM when invoking: stock-price, portfolio, buy-stock" .

# Knowledge base for the agent containing tool schemas and notes
:StockbrokerKnowledgeBase a :KnowledgeBase ;
    rdfs:label "Stockbroker Knowledge Base" ;
    dcterms:description """Contains the tool schemas and notes used by the stockbroker agent:
- getStockPriceSchema: { ticker: string }
- getPortfolioSchema: { get_portfolio: boolean }
- buyStockSchema: { ticker: string, quantity: number }
This KnowledgeBase also documents reliance on the FINANCIAL_DATASETS_API_KEY environment variable and the HTTP endpoints:
- https://api.financialdatasets.ai/prices
- https://api.financialdatasets.ai/prices/snapshot
Additionally notes paginated retrieval of thirty-day prices via next_page_url and the attempt to iterate up to 10 times to fetch additional pages if present.
""" .

# Environment / context
:TradingEnvironment a :Environment ;
    rdfs:label "Trading Environment" ;
    :envType "virtual" ;
    dcterms:description "Operational environment context for the Stockbroker agent (uses external financial datasets API)." .

# Security / external resource (API key)
:FinancialDatasetsAPIKey a beam:Resource ;
    rdfs:label "FINANCIAL_DATASETS_API_KEY (env var)" ;
    dcterms:description "Environment variable required by the agent to access the financial datasets API (FINANCIAL_DATASETS_API_KEY)." .

#################################################################
# Tools as ontology Tool individuals
#################################################################

:Tool_StockPrice a :Tool ;
    rdfs:label "stock-price" ;
    dcterms:description "A tool to get the stock price of a company. Invoked with argument { ticker: string }. When called, the agent fetches one-day and thirty-day price collections from https://api.financialdatasets.ai/prices with specified query parameters (interval, interval_multiplier, start_date, end_date, limit). The thirty-day retrieval may follow next_page_url to aggregate pages." ;
    :hasCapability :GetStockPricesCapability ;
    :hasToolConfig :ToolConfig_StockPrice .

:Tool_Portfolio a :Tool ;
    rdfs:label "portfolio" ;
    dcterms:description "A tool to get the user's portfolio details. Only called when the user explicitly requests portfolio details. Invoked with argument { get_portfolio: true }." ;
    :hasCapability :GetPortfolioCapability ;
    :hasToolConfig :ToolConfig_Portfolio .

:Tool_BuyStock a :Tool ;
    rdfs:label "buy-stock" ;
    dcterms:description "A tool to buy a stock. Invoked with arguments { ticker: string, quantity: number }. When called, the agent requests a price snapshot from https://api.financialdatasets.ai/prices/snapshot and includes the snapshot and quantity in the UI output." ;
    :hasCapability :BuyStockCapability ;
    :hasToolConfig :ToolConfig_BuyStock .

# Tool capability individuals
:GetStockPricesCapability a :Capability ;
    rdfs:label "Get stock prices" ;
    dcterms:description "Capability to query historical and recent market prices for a given ticker." .

:GetPortfolioCapability a :Capability ;
    rdfs:label "Get portfolio" ;
    dcterms:description "Capability to retrieve the user's portfolio details." .

:BuyStockCapability a :Capability ;
    rdfs:label "Buy stock" ;
    dcterms:description "Capability to initiate a purchase action for a given stock and quantity." .

# Tool configuration individuals (store schemas and relevant config as strings)
:ToolConfig_StockPrice a :Config ;
    :configKey "schema" ;
    :configValue """{ "ticker": "string" } (description: The ticker symbol of the company)""" ;
    dcterms:description "Schema for the stock-price tool arguments. Also contains request parameters used for one-day and thirty-day queries: interval/minute, interval_multiplier 5 for one-day, 30 for thirty-day; date ranges and limits." .

:ToolConfig_Portfolio a :Config ;
    :configKey "schema" ;
    :configValue """{ "get_portfolio": "boolean" } (description: Should be true.)""" ;
    dcterms:description "Schema for the portfolio tool arguments." .

:ToolConfig_BuyStock a :Config ;
    :configKey "schema" ;
    :configValue """{ "ticker": "string", "quantity": "number" } (description: ticker to buy and quantity)""" ;
    dcterms:description "Schema for the buy-stock tool arguments." .

#################################################################
# Prompts used by the agent and tasks
#################################################################

:StockbrokerSystemPrompt a :Prompt ;
    rdfs:label "Stockbroker system prompt" ;
    :promptInstruction "You are a stockbroker agent that uses tools to get the stock price of a company" ;
    :promptContext "System-level instruction provided to the LLM on each invocation. Used with the conversation messages array state.messages." ;
    :promptOutputIndicator "Produces an LLM message with possible tool_calls array (tool call metadata) and assistant content." .

:CallToolsPrompt a :Prompt ;
    rdfs:label "Call tools prompt (task-level)" ;
    :promptInstruction """When invoking tools the agent binds the following tool definitions to the LLM: 
- stock-price: schema { ticker: string } — returns oneDayPrices and thirtyDayPrices arrays (may require pagination)
- portfolio: schema { get_portfolio: boolean } — returns portfolio UI
- buy-stock: schema { ticker: string, quantity: number } — triggers snapshot retrieval for ticker and responds with snapshot and quantity
The agent will include prior conversation messages in the invocation. The LLM should emit tool_calls describing which tool to call and with which arguments.""";
    :promptContext "Task-level instruction specifying tool definitions and expected tool_calls metadata." ;
    :promptOutputIndicator "tool_calls (array), message (assistant response with content and tool call entries)" .

#################################################################
# Workflow pattern and steps
#################################################################

:StockbrokerWorkflow a :WorkflowPattern ;
    rdfs:label "Stockbroker" ;
    dcterms:description "Top-level workflow pattern representing the Stockbroker StateGraph. The compiled graph contains a single 'agent' node which calls external tools and returns UI items." ;
    :hasWorkflowStep :StartAgentStep .

:StartAgentStep a :StartStep ;
    rdfs:label "Agent Node Step" ;
    :stepOrder 1 ;
    dcterms:description "The initial and only executed workflow step in this pattern. It invokes the agent's Call Tools task." ;
    :hasAssociatedTask :CallToolsTask ;
    :nextStep :EndAgentStep .

:EndAgentStep a :EndStep ;
    rdfs:label "End Step" ;
    :stepOrder 2 ;
    dcterms:description "Terminal step for the Stockbroker workflow pattern." .

#################################################################
# Tasks and their relations to tools, resources, and produced outputs
#################################################################

:CallToolsTask a :Task ;
    rdfs:label "Call tools" ;
    dcterms:description "Task executed by the Stockbroker agent to call the language model with bound tools and to route resulting tool calls to tool-specific handlers. Uses the system prompt and conversation messages as input to the LLM." ;
    :taskPrompt :CallToolsPrompt ;
    :performedByAgent :StockbrokerAgent ;
    :requiresResource :FinancialDatasetsAPIKey ;
    :producedResource :LLMMessageResource , :UIItemsResource ;
    :contributesToObjective :GetStockInfoGoal .

# When the LLM indicates a stock-price tool call, the agent triggers a network retrieval task
:GetPricesForTickerTask a :Task ;
    rdfs:label "Get prices for ticker" ;
    dcterms:description "Task representing the retrieval of price series for a given ticker. This task calls the external prices endpoint and may follow next_page_url to fetch paginated thirty-day data. Produces oneDayPrices and thirtyDayPrices arrays." ;
    :performedBy :Tool_StockPrice ;
    :requiresResource :FinancialDatasetsAPIKey ;
    :producedResource :OneDayPricesResource , :ThirtyDayPricesResource ;
    :requiresCapability :GetStockPricesCapability ;
    :contributesToObjective :GetStockInfoGoal .

# When the LLM indicates a buy-stock tool call, the agent triggers snapshot retrieval
:GetPriceSnapshotTask a :Task ;
    rdfs:label "Get price snapshot for ticker" ;
    dcterms:description "Task representing retrieval of a snapshot for a ticker via the /prices/snapshot endpoint, used to support a buy-stock action. Produces a snapshot resource." ;
    :performedBy :Tool_BuyStock ;
    :requiresResource :FinancialDatasetsAPIKey ;
    :producedResource :PriceSnapshotResource ;
    :requiresCapability :BuyStockCapability ;
    :contributesToObjective :GetStockInfoGoal .

# Portfolio tool invocation task
:GetPortfolioTask a :Task ;
    rdfs:label "Get portfolio" ;
    dcterms:description "Task invoked when the user requests portfolio details. Performed by the portfolio tool and results in UI output describing the portfolio." ;
    :performedBy :Tool_Portfolio ;
    :producedResource :PortfolioUIResource ;
    :requiresCapability :GetPortfolioCapability ;
    :contributesToObjective :GetStockInfoGoal .

#################################################################
# Resources produced and used
#################################################################

:LLMMessageResource a beam:Resource ;
    rdfs:label "LLM message" ;
    dcterms:description "The assistant message returned by the LLM invocation. May include content, and tool_calls array with each tool call having an id, name, and args object. This resource is pushed to the UI along with UI items representing tool outputs." .

:UIItemsResource a beam:Resource ;
    rdfs:label "UI items" ;
    dcterms:description "A list of UI items produced by the agent to present results (e.g., chart for prices, portfolio view, buy confirmation). Modeled here as a resource produced by the CallToolsTask." .

:OneDayPricesResource a beam:Resource ;
    rdfs:label "oneDayPrices" ;
    dcterms:description "Array of Price entries for a single day. Retrieved from https://api.financialdatasets.ai/prices with interval=minute and interval_multiplier=5, start_date=end_date=today, limit=5000." .

:ThirtyDayPricesResource a beam:Resource ;
    rdfs:label "thirtyDayPrices" ;
    dcterms:description "Array of Price entries covering up to 30 days. Retrieved from https://api.financialdatasets.ai/prices with interval=minute and interval_multiplier=30; may require pagination following next_page_url to collect additional pages." .

:PriceSnapshotResource a beam:Resource ;
    rdfs:label "snapshot" ;
    dcterms:description "Snapshot object returned by https://api.financialdatasets.ai/prices/snapshot for a requested ticker. Used by the buy-stock UI item to present price at purchase time." .

:PortfolioUIResource a beam:Resource ;
    rdfs:label "portfolio UI" ;
    dcterms:description "UI representation of the user's portfolio produced when the portfolio tool is invoked." .

#################################################################
# Goal and Objective
#################################################################

:GetStockInfoGoal a :Goal ;
    rdfs:label "Get stock information and perform trades" ;
    dcterms:description "Goal: Provide stock price information to the user, show portfolio details on request, and facilitate buy orders when requested by user." .

#################################################################
# Relationships and summary linking
#################################################################

# Agent hasGoal (high-level)
:StockbrokerAgent :hasAgentGoal :GetStockInfoGoal .

# Workflow is associated with the agent
:StockbrokerAgent :hasWorkflowPattern :StockbrokerWorkflow .

# Tools are related back to the workflow pattern via the CallToolsTask
:StockbrokerWorkflow :hasWorkflowStep :StartAgentStep .
:StartAgentStep :hasAssociatedTask :CallToolsTask .

# Task-to-Tool relationships
:GetPricesForTickerTask :performedBy :Tool_StockPrice .
:GetPriceSnapshotTask :performedBy :Tool_BuyStock .
:GetPortfolioTask :performedBy :Tool_Portfolio .

# Task produced resources
:GetPricesForTickerTask :producedResource :OneDayPricesResource , :ThirtyDayPricesResource .
:GetPriceSnapshotTask :producedResource :PriceSnapshotResource .
:GetPortfolioTask :producedResource :PortfolioUIResource .

# The CallToolsTask is performed by the agent and produces LLM message and UI items
:CallToolsTask :performedByAgent :StockbrokerAgent ;
    :producedResource :LLMMessageResource , :UIItemsResource .

#################################################################
# Additional descriptive items preserving fidelity to source code
#################################################################

:ImplementationNotes a :Context ;
    rdfs:label "Implementation notes (preserved as context)" ;
    dcterms:description """Preserved implementation-level semantics (not code):
- The agent binds three tools to the language model (stock-price, portfolio, buy-stock).
- The LLM invocation receives a system message (Stockbroker system prompt) and the conversation history (state.messages).
- The LLM may return tool_calls describing which tool to call and with what args; the agent inspects message.tool_calls for matches by name.
- For stock-price tool calls, the agent invokes the prices endpoint twice (one-day and thirty-day parameterizations) in parallel and handles pagination of the thirty-day response by following next_page_url up to 10 iterations.
- For buy-stock tool calls, the agent calls the snapshot endpoint and then surfaces a UI item that includes the snapshot and requested quantity.
- For portfolio tool calls, the agent surfaces a portfolio UI item only when explicitly requested.
- The FINANCIAL_DATASETS_API_KEY environment variable is required to access the external API.
- The agent's LLM temperature is set to 0 for deterministic responses.
These notes are preserved for semantic reconstruction; actual functions, SDK usage, and UI implementation are not modeled here.
""" .

# End of individuals.