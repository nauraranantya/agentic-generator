# Execution time: 119.78 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - Conditional routing logic (the functions routeStart, routeAfterClassifying, routeAfterExtraction) and the branching semantics are modeled as human-readable descriptions attached to the workflow/steps. The ontology lacks first-class constructs to represent conditional transitions or conditions; these are therefore expressed as literal descriptions on relevant individuals.
# - Tool-call metadata (tool_call ids, tool response objects, runtime generated UUIDs, and the internal "tool_calls" structure returned by the LLM) are runtime / implementation details and cannot be represented precisely with existing classes/properties. I preserved the tool names, schemas and their mapping to tasks/tools as literals or tool individuals.
# - The LangGraph state machine, typed UI items, and framework-specific constructs (StateGraph, LangGraphRunnableConfig, typedUi, tags, push mechanics, etc.) are implementation-specific and not modeled as classes. UI components and runtime push behavior are omitted; UI outputs are represented only as produced resources (e.g., accommodations list).
# - Schemas declared with zod are represented as descriptive strings attached to Tool individuals (dc:description). There is no facility in the ontology to model typed schemas formally, so the schema fields and descriptions are preserved as literals.
# - The calculateDates function logic and defaulting rules (default guest count, fallback dates relative to "now") are preserved as descriptions attached to the TripDetails resource. The ontology cannot represent executable date-calculation logic; it is documented as literal.
# - Language model tuning / binding (e.g., model name, temperature, tool bindings, tool_choice) are represented as Config individuals with key/value pairs. The ontology supports Config but not structured nested config objects; keys/values are stored as strings.
# - Dynamic runtime values (randomized accommodation IDs, faker-generated content, shuffled image URLs, and timestamps) are runtime artifacts and represented as descriptive templates or representative resource entries; lists (image URLs) are preserved as literal lists in descriptions where relevant.
# - No new classes or properties have been added; only existing classes/properties are used.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@base <http://www.w3id.org/agentic-ai/onto#> .

#################################################################
# Trip Planner Workflow Pattern and Steps
#################################################################

:TripPlanner_Workflow a :WorkflowPattern ;
    <http://purl.org/dc/terms/title> "Trip Planner" ;
    <http://purl.org/dc/terms/description> """
An agent workflow (StateGraph) named "Trip Planner". It contains three primary workflow steps (classify, extraction, callTools) with conditional branching:
- At START: routeStart(state) chooses "extraction" when tripDetails is missing, otherwise "classify".
- After "classify": routeAfterClassifying(state) chooses "callTools" when tripDetails remain relevant, otherwise "extraction".
- After "extraction": routeAfterExtraction(state) returns END if tripDetails remain undefined (missing fields), otherwise "callTools".
These conditional functions are documented on step individuals below.
""" ;
    :hasWorkflowStep :StartStep_TripPlanner ,
                     :Step_Extraction ,
                     :Step_Classify ,
                     :Step_CallTools ,
                     :EndStep_TripPlanner .

:StartStep_TripPlanner a :StartStep ;
    <http://purl.org/dc/terms/title> "Start" ;
    <http://www.w3id.org/agentic-ai/onto#stepOrder> 0 ;
    <http://purl.org/dc/terms/description> """
Start of the workflow. Conditional route function (routeStart):
- If state.tripDetails is undefined -> go to 'extraction' step.
- Otherwise -> go to 'classify' step.
This conditional branching is part of the workflow builder logic; the ontology captures it as descriptive metadata.
""" ;
    :nextStep :Step_Extraction , :Step_Classify .

:Step_Extraction a :WorkflowStep ;
    <http://purl.org/dc/terms/title> "extraction" ;
    <http://www.w3id.org/agentic-ai/onto#stepOrder> 1 ;
    :hasAssociatedTask :Task_Extraction ;
    <http://purl.org/dc/terms/description> """
Extraction step: calls an extraction tool to extract TripDetails from the conversation using a tool schema. After extraction:
- If tripDetails remains undefined (missing required 'location'), route to END to request clarification.
- Otherwise route to 'callTools'.
""" ;
    :nextStep :Step_CallTools , :EndStep_TripPlanner .

:Step_Classify a :WorkflowStep ;
    <http://purl.org/dc/terms/title> "classify" ;
    <http://www.w3id.org/agentic-ai/onto#stepOrder> 2 ;
    :hasAssociatedTask :Task_Classify ;
    <http://purl.org/dc/terms/description> """
Classify step: uses a classification tool to check whether the tripDetails remain relevant to the user's latest message.
- If classification indicates isRelevant == false, the agent clears tripDetails and routes to 'extraction'.
- If isRelevant == true, routes to 'callTools'.
""" ;
    :nextStep :Step_CallTools , :Step_Extraction .

:Step_CallTools a :WorkflowStep ;
    <http://purl.org/dc/terms/title> "callTools" ;
    <http://www.w3id.org/agentic-ai/onto#stepOrder> 3 ;
    :hasAssociatedTask :Task_CallTools ;
    <http://purl.org/dc/terms/description> """
CallTools step: agent uses bound tools (list-accommodations, list-restaurants) to produce UI items and resources (accommodations list, restaurants list). The step produces UI items (typed UI items in implementation) and message responses. It expects state.tripDetails to be defined.
""" ;
    :nextStep :EndStep_TripPlanner .

:EndStep_TripPlanner a :EndStep ;
    <http://purl.org/dc/terms/title> "End" ;
    <http://www.w3id.org/agentic-ai/onto#stepOrder> 4 ;
    <http://purl.org/dc/terms/description> "Terminal step of the Trip Planner workflow." .

#################################################################
# Tasks
#################################################################

:Task_Extraction a :Task ;
    <http://purl.org/dc/terms/title> "extraction" ;
    <http://purl.org/dc/terms/description> """
Extraction task: given the entire conversation history, call a tool named "extract" with the following schema:
- location: string (required) - "The location to plan the trip for. Can be a city, state, or country."
- startDate: string (optional) - "YYYY-MM-DD"
- endDate: string (optional) - "YYYY-MM-DD"
- numberOfGuests: number (optional) - defaults to 2 if not provided

Behavior notes:
- Do NOT guess or make up information. If location missing, produce a single-sentence clarification request: "Please specify the location for the trip you want to go on".
- After extraction: apply date defaulting logic (see TripDetails resource description).
""" ;
    :taskPrompt :Prompt_Extraction ;
    :requiresResource :ConversationHistory ;
    :performedByAgent :TripPlanner_Agent ;
    :producedResource :TripDetails_Resource ;
    :requiresCapability :Capability_ExtractInformation .

:Task_Classify a :Task ;
    <http://purl.org/dc/terms/title> "classify" ;
    <http://purl.org/dc/terms/description> """
Classification task: use a tool named "classify" with schema { isRelevant: boolean } to determine if previously extracted tripDetails remain relevant to the user's most recent message.
- If isRelevant == false -> the agent will clear tripDetails (tripDetails becomes undefined) and routing will proceed to extraction.
- If isRelevant == true -> proceed to callTools.
""" ;
    :taskPrompt :Prompt_Classify ;
    :requiresResource :ConversationHistory ;
    :requiresResource :TripDetails_Resource ;
    :performedByAgent :TripPlanner_Agent ;
    :producedResource :ClassificationResult_Resource ;
    :requiresCapability :Capability_ClassifyRelevance .

:Task_CallTools a :Task ;
    <http://purl.org/dc/terms/title> "callTools" ;
    <http://purl.org/dc/terms/description> """
CallTools task: binds ACCOMMODATIONS_TOOLS (list-accommodations and list-restaurants), invokes the language model to decide which tool(s) to call, and pushes UI items for results. The LLM receives the system message:
"You are an AI assistant who helps users book trips. Use the user's most recent message(s) to contextually generate a response."
The task expects state.tripDetails to be defined and produces resources:
- Accommodations list resource
- Restaurants list resource
- UI items (represented here as produced resources)
""" ;
    :taskPrompt :Prompt_CallTools ;
    :requiresResource :TripDetails_Resource ;
    :performedByAgent :TripPlanner_Agent ;
    :producedResource :AccommodationsList_Resource , :RestaurantsList_Resource ;
    :requiresCapability :Capability_ListAccommodations , :Capability_ListRestaurants .

#################################################################
# Agent and Language Model
#################################################################

:TripPlanner_Agent a :LLMAgent ;
    <http://www.w3id.org/agentic-ai/onto#agentID> "trip-planner-agent" ;
    <http://www.w3id.org/agentic-ai/onto#agentRole> "assistant / trip-planner" ;
    <http://purl.org/dc/terms/description> "An LLM-based agent that operates the Trip Planner workflow and uses bound tools to extract information and list accommodations/restaurants." ;
    :useLanguageModel :LanguageModel_gpt4o ;
    :hasAgentConfig :AgentConfig_model , :AgentConfig_temperature , :AgentConfig_boundTools , :AgentConfig_toolChoiceClassify ;
    :hasAgentCapability :Capability_ExtractInformation , :Capability_ClassifyRelevance , :Capability_ListAccommodations , :Capability_ListRestaurants ;
    :agentToolUsage :Tool_extract , :Tool_classify , :Tool_listAccommodations , :Tool_listRestaurants ;
    :hasPrompt :Agent_Default_Prompt .

:LanguageModel_gpt4o a :LanguageModel ;
    <http://purl.org/dc/terms/title> "gpt-4o" ;
    <http://purl.org/dc/terms/description> "Statistical language model used by the TripPlanner_Agent (implementation uses ChatOpenAI with model 'gpt-4o')." .

#################################################################
# Tool Individuals (schemas preserved as descriptions)
#################################################################

:Tool_extract a :Tool ;
    <http://purl.org/dc/terms/title> "extract" ;
    <http://purl.org/dc/terms/description> """
Tool name: "extract"
Purpose: Extract TripDetails from conversation history. Bound to the agent's LLM.
Schema (Zod, represented informally):
{
  location: string (describe: The location to plan the trip for. Can be a city, state, or country.),
  startDate: string (optional, describe: The start date of the trip. YYYY-MM-DD),
  endDate: string (optional, describe: The end date of the trip. YYYY-MM-DD),
  numberOfGuests: number (describe: The number of guests. Defaults to 2 if unspecified.)
}
Behavior: the tool returns only fields specified by the user; do not make up values. If location is missing, a clarification message should be generated requesting the location.
""" ;
    :hasToolConfig :ToolConfig_extract_schema ;
    :hasCapability :Capability_ExtractInformation .

:Tool_classify a :Tool ;
    <http://purl.org/dc/terms/title> "classify" ;
    <http://purl.org/dc/terms/description> """
Tool name: "classify"
Purpose: Classify whether trip details remain relevant to the user's most recent request.
Schema:
{
  isRelevant: boolean (describe: Whether the trip details are still relevant to the user's request.)
}
Notes: When invoked, tool_choice is set to "classify" in the implementation.
""" ;
    :hasToolConfig :ToolConfig_classify_schema , :ToolConfig_classify_tool_choice ;
    :hasCapability :Capability_ClassifyRelevance .

:Tool_listAccommodations a :Tool ;
    <http://purl.org/dc/terms/title> "list-accommodations" ;
    <http://purl.org/dc/terms/description> """
Tool name: "list-accommodations"
Purpose: A tool to list accommodations for the user. Implementation populates an accommodations list (id, name, price, rating, city, image) using a data generator.
Schema: {} (no input schema fields required in the implementation).
Produces: An accommodations list resource used to populate UI.
""" ;
    :hasToolConfig :ToolConfig_listAccommodations_schema ;
    :hasCapability :Capability_ListAccommodations .

:Tool_listRestaurants a :Tool ;
    <http://purl.org/dc/terms/title> "list-restaurants" ;
    <http://purl.org/dc/terms/description> """
Tool name: "list-restaurants"
Purpose: A tool to list restaurants for the user. Implementation uses trip details to produce a restaurants list.
Schema: {}.
Produces: A restaurants list resource used to populate UI.
""" ;
    :hasToolConfig :ToolConfig_listRestaurants_schema ;
    :hasCapability :Capability_ListRestaurants .

#################################################################
# Capability Individuals
#################################################################

:Capability_ExtractInformation a :Capability ;
    <http://purl.org/dc/terms/title> "extract information" .

:Capability_ClassifyRelevance a :Capability ;
    <http://purl.org/dc/terms/title> "classify relevance" .

:Capability_ListAccommodations a :Capability ;
    <http://purl.org/dc/terms/title> "list accommodations" .

:Capability_ListRestaurants a :Capability ;
    <http://purl.org/dc/terms/title> "list restaurants" .

#################################################################
# Configurations (stored as Config instances with key/value)
#################################################################

:AgentConfig_model a :Config ;
    :configKey "model" ;
    :configValue "gpt-4o" ;
    <http://purl.org/dc/terms/description> "Agent-level configuration: language model name." .

:AgentConfig_temperature a :Config ;
    :configKey "temperature" ;
    :configValue "0" ;
    <http://purl.org/dc/terms/description> "Agent-level configuration: deterministic responses (temperature 0)." .

:AgentConfig_boundTools a :Config ;
    :configKey "bound_tools" ;
    :configValue "extract, list-accommodations, list-restaurants" ;
    <http://purl.org/dc/terms/description> "Agent bound tools list used during tool binding step of the LLM." .

:AgentConfig_toolChoiceClassify a :Config ;
    :configKey "tool_choice" ;
    :configValue "classify" ;
    <http://purl.org/dc/terms/description> "Used when binding the 'classify' tool so the LLM will choose it deterministically when configured." .

:ToolConfig_extract_schema a :Config ;
    :configKey "schema" ;
    :configValue "location:string; startDate?:string; endDate?:string; numberOfGuests?:number" ;
    <http://purl.org/dc/terms/description> "Informal serialization of the extract tool's schema." .

:ToolConfig_classify_schema a :Config ;
    :configKey "schema" ;
    :configValue "isRelevant:boolean" ;
    <http://purl.org/dc/terms/description> "Informal serialization of the classify tool's schema." .

:ToolConfig_classify_tool_choice a :Config ;
    :configKey "tool_choice" ;
    :configValue "classify" ;
    <http://purl.org/dc/terms/description> "Tool configuration instructing the LLM to prefer the classify tool." .

:ToolConfig_listAccommodations_schema a :Config ;
    :configKey "schema" ;
    :configValue "{}" ;
    <http://purl.org/dc/terms/description> "List-accommodations tool does not require structured input in the implementation." .

:ToolConfig_listRestaurants_schema a :Config ;
    :configKey "schema" ;
    :configValue "{}" ;
    <http://purl.org/dc/terms/description> "List-restaurants tool does not require structured input in the implementation." .

#################################################################
# Prompts (preserve full prompt text where available)
#################################################################

:Prompt_Extraction a :Prompt ;
    :promptInstruction """You're an AI assistant for planning trips. The user has requested information about a trip they want to go on.
Before you can help them, you need to extract the following information from their request:
- location - The location to plan the trip for. Can be a city, state, or country.
- startDate - The start date of the trip. Should be in YYYY-MM-DD format. Optional
- endDate - The end date of the trip. Should be in YYYY-MM-DD format. Optional
- numberOfGuests - The number of guests for the trip. Optional

You are provided with the ENTIRE conversation history between you, and the user. Use these messages to extract the necessary information.

Do NOT guess, or make up any information. If the user did NOT specify a location, please respond with a request for them to specify the location.
You should ONLY send a clarification message if the user did not provide the location. You do NOT need any of the other fields, so if they're missing, proceed without them.
It should be a single sentence, along the lines of "Please specify the location for the trip you want to go on".

Extract only what is specified by the user. It is okay to leave fields blank if the user did not specify them.
""" ;
    :promptContext "The human message provided to the tool is the entire conversation history in a formatted string." ;
    :promptOutputIndicator "JSON-like tool call with fields [location, startDate?, endDate?, numberOfGuests?]" .

:Prompt_Classify a :Prompt ;
    :promptInstruction """You're an AI assistant for planning trips. The user has already specified the following details for their trip:
- location - ${state.tripDetails.location}
- startDate - ${state.tripDetails.startDate}
- endDate - ${state.tripDetails.endDate}
- numberOfGuests - ${state.tripDetails.numberOfGuests}

Your task is to carefully read over the user's conversation, and determine if their trip details are still relevant to their most recent request.
You should set is relevant to false if they are now asking about a new location, trip duration, or number of guests.
If they do NOT change their request details (or they never specified them), please set is relevant to true.
""" ;
    :promptContext "The human message provided is the entire conversation history (formatted)." ;
    :promptOutputIndicator "Tool call returning { isRelevant: boolean }" .

:Prompt_CallTools a :Prompt ;
    :promptInstruction """You are an AI assistant who helps users book trips. Use the user's most recent message(s) to contextually generate a response.""" ;
    :promptContext "CallTools uses recent conversation messages plus system prompt above to decide which tool(s) to call: list-accommodations, list-restaurants." ;
    :promptOutputIndicator "LLM may invoke one or more tool calls (list-accommodations, list-restaurants) or produce direct message responses." .

:Agent_Default_Prompt a :Prompt ;
    :promptInstruction "Agent-level default prompt/identity for TripPlanner_Agent (general assistant for planning trips)." .

#################################################################
# Resources and Instances (TripDetails, Conversation, Outputs)
#################################################################

:ConversationHistory a beam:Resource ;
    <http://purl.org/dc/terms/title> "Conversation History" ;
    <http://purl.org/dc/terms/description> "Represents the entire conversation history (state.messages) provided to tools and prompts. In the implementation this is a sequence of messages (system/human/assistant), formatted and passed as input to the LLM." .

:TripDetails_Resource a beam:Instance ;
    <http://purl.org/dc/terms/title> "TripDetails" ;
    <http://purl.org/dc/terms/description> """
TripDetails structure produced by extraction:
- location: string (required)
- startDate: Date
- endDate: Date
- numberOfGuests: integer (defaults to 2 if not provided or invalid)

Date defaulting logic (documented):
- If both startDate and endDate undefined: start = now + 4 weeks; end = now + 5 weeks.
- If startDate defined and endDate undefined: end = startDate + 1 week.
- If endDate defined and startDate undefined: start = endDate - 1 week.
- If both defined: use as-is.

Note: runtime values such as computed Date objects are produced at execution time; this resource captures the logical fields and defaulting policy.
""" .

:ClassificationResult_Resource a beam:Resource ;
    <http://purl.org/dc/terms/title> "classification result" ;
    <http://purl.org/dc/terms/description> "Result of the classify tool call: { isRelevant: boolean }." .

:AccommodationsList_Resource a beam:Resource ;
    <http://purl.org/dc/terms/title> "Accommodations List" ;
    <http://purl.org/dc/terms/description> """
Produced by the list-accommodations tool. Contains an array of accommodation objects:
- id (runtime UUID)
- name (string)
- price (number)
- rating (float)
- city (string)
- image (URL)
Image URL pool (representative list preserved from implementation): [list of many image URLs; implementation shuffles and picks 6].
Note: Implementation uses a generator (faker) to create sample entries, and randomly shuffles image URLs. This resource represents the output schema and sample content generation approach.
""" .

:RestaurantsList_Resource a beam:Resource ;
    <http://purl.org/dc/terms/title> "Restaurants List" ;
    <http://purl.org/dc/terms/description> "Produced by the list-restaurants tool. Contains restaurant entries relevant to tripDetails (implementation-specific, represented as a produced resource for UI consumption)." .

#################################################################
# Relationships (agent uses tools, tasks performed by agent, etc.)
#################################################################

# Agent uses / binds tools
:TripPlanner_Agent :agentToolUsage :Tool_extract , :Tool_classify , :Tool_listAccommodations , :Tool_listRestaurants .

# Tasks performed by agent already linked via performedByAgent above; repeated linking of tasks to tools used:
:Task_Extraction :performedByAgent :TripPlanner_Agent ;
    :requiresCapability :Capability_ExtractInformation ;
    :producedResource :TripDetails_Resource .

:Task_Classify :performedByAgent :TripPlanner_Agent ;
    :requiresCapability :Capability_ClassifyRelevance ;
    :producedResource :ClassificationResult_Resource .

:Task_CallTools :performedByAgent :TripPlanner_Agent ;
    :requiresCapability :Capability_ListAccommodations , :Capability_ListRestaurants ;
    :producedResource :AccommodationsList_Resource , :RestaurantsList_Resource .

#################################################################
# Misc: Mapping of workflow steps to tasks
#################################################################

:Step_Extraction :hasAssociatedTask :Task_Extraction .
:Step_Classify :hasAssociatedTask :Task_Classify .
:Step_CallTools :hasAssociatedTask :Task_CallTools .

#################################################################
# Notes preserved about randomization and UI (non-modeled runtime)
#################################################################

:AccommodationsList_Resource <http://purl.org/dc/terms/description> """
Implementation notes:
- The accommodations list is generated by getAccommodationsListProps which:
  - Takes tripDetails.city and returns 6 accommodations,
  - Randomly shuffles a pre-defined IMAGE_URLS array and assigns images,
  - Generates id, name, price, rating using faker library.
- These runtime generation details are preserved for fidelity but UI/typed components are not modeled in the ontology.
""" .

#################################################################
# End of triples
#################################################################