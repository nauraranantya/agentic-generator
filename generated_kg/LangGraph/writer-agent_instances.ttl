# Execution time: 83.07 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - Missing explicit ontology concepts for "StateGraph", "Graph nodes", "streaming sessions", "tool_call" structure, "message chunks", and "UI components". These runtime/SDK constructs are represented here as Tasks, Prompts, Resources, and Capabilities, but the ontology does not have dedicated classes/properties for stateful streams, tool-call identifiers, or UI elements.
# - The ontology lacks a dedicated way to model message-level details (e.g., isAIMessage, tool_calls arrays, tool_call ids, chunk concatenation). I modeled conversation state and tool call outputs as beam:Resource instances with descriptive literals.
# - The ontology does not provide a direct property to indicate ordering of workflow patterns beyond stepOrder on WorkflowStep; I used stepOrder on WorkflowStep individuals to capture sequence.
# - The ontology does not model runtime configuration namespaces or typed schemas directly (e.g., Zod schemas). I encoded schema and config data as string literals in Config instances (configKey / configValue).
# - UI components, UUID generation, and SDK-specific binding semantics were intentionally omitted per instructions; references to UI behavior, pushes or component props are preserved as descriptive literals on Tasks or Resources.
# - Streaming semantics (initStream/contentStream, tags like ["nostream"]) are represented as Capabilities and Config literals (Capability "streaming output", Agent config tag "tags":"[\"nostream\"]").
# - Where necessary, behavioral/operational details from the source code are preserved as literal descriptions on Task, Prompt, Tool and Resource individuals.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .

# Agent (LLM) instance
:WriterAgent rdf:type :LLMAgent ;
    dcterms:title "Writer Annotation Agent" ;
    :agentID "writer-annotation-agent-uuid-1" ;
    :agentRole "annotation-driven writer" ;
    :useLanguageModel :Claude3_5_Sonnet ;
    :hasAgentConfig :WriterAgentConfig_Nostream ;
    :hasAgentCapability :Capability_DocumentGeneration,
                        :Capability_ToolBinding,
                        :Capability_StreamingOutput ;
    :agentToolUsage :DraftTextDocumentTool ;
    :hasWorkflowPattern :WriterWorkflow ;
    dcterms:description "Agent coordinating a prepare -> writer -> suggestions workflow. Uses an Anthropic model and binds a tool 'draft_text_document' to create an initial draft; streams results in some steps and disables streaming in the final writer generation by setting tags ['nostream']." .

# Language model instance
:Claude3_5_Sonnet rdf:type :LanguageModel ;
    dcterms:title "claude-3-5-sonnet-latest" ;
    dcterms:description "Anthropic model referenced by ChatAnthropic in source: MODEL_NAME = 'claude-3-5-sonnet-latest'. Supports streaming invocation and non-stream invocation (tags: ['nostream'])." .

# Agent-level config (e.g., writer node used tags ['nostream'])
:WriterAgentConfig_Nostream rdf:type :Config ;
    :configKey "tags" ;
    :configValue "[\"nostream\"]" ;
    dcterms:description "Model invocation tags applied in the writer node to disable streaming (source: .withConfig({ tags: ['nostream'] }))." .

# Tool: draft_text_document
:DraftTextDocumentTool rdf:type :Tool ;
    dcterms:title "draft_text_document" ;
    dcterms:description """Prepare a text document for the user with a short title and short description for browsing purposes. Can be also used when creating a new version of the document.""";
    :hasToolConfig :DraftToolConfig_Schema ;
    :hasCapability :Capability_CreateDraft ;
    rdfs:label "draft_text_document" .

# Tool config: schema for draft_text_document (Zod schema from source)
:DraftToolConfig_Schema rdf:type :Config ;
    :configKey "schema" ;
    :configValue "{ title: z.string(), description: z.string() }" ;
    dcterms:description "Schema (Zod) used by the tool in source: const CreateTextDocumentTool = z.object({ title: z.string(), description: z.string() });" .

# Capabilities
:Capability_CreateDraft rdf:type :Capability ;
    rdfs:label "create draft document" ;
    dcterms:description "Tool capability: prepare a text document with title and description according to a schema." .

:Capability_DocumentGeneration rdf:type :Capability ;
    rdfs:label "document generation" ;
    dcterms:description "Agent capability: generate textual document content based on user messages and prompts." .

:Capability_ToolBinding rdf:type :Capability ;
    rdfs:label "tool binding" ;
    dcterms:description "Agent capability: bind schema-defined tools to model so model can produce tool calls." .

:Capability_StreamingOutput rdf:type :Capability ;
    rdfs:label "streaming output" ;
    dcterms:description "Agent can process streaming outputs (chunks) from the language model and concatenate them into messages." .

# Workflow pattern and steps
:WriterWorkflow rdf:type :WorkflowPattern ;
    dcterms:title "WriterAnnotationWorkflow" ;
    :hasWorkflowStep :PrepareStep, :WriterStep, :SuggestionsStep ;
    dcterms:description "Workflow representing the StateGraph: START -> prepare -> writer -> suggestions." .

:PrepareStep rdf:type :StartStep ;
    :hasAssociatedTask :PrepareTask ;
    :stepOrder 1 ;
    dcterms:description "Initial workflow step responsible for binding tools and performing an initial streaming call to produce a draft tool-call result." .

:WriterStep rdf:type :WorkflowStep ;
    :hasAssociatedTask :WriteTask ;
    :stepOrder 2 ;
    dcterms:description "Main writer step: generates final content; uses non-streaming invocation (tags ['nostream']) for the full-content generation and streams intermediate UI updates in implementation." .

:SuggestionsStep rdf:type :EndStep ;
    :hasAssociatedTask :SuggestionsTask ;
    :stepOrder 3 ;
    dcterms:description "Final step: post-process last AI message tool calls by sending 'Finished' tool messages, invoking the model to produce a finish message." .

# Tasks
:PrepareTask rdf:type :Task ;
    dcterms:title "prepare" ;
    dcterms:description """Binds the tool 'draft_text_document' with the model and streams its output (initStream). If state.context.writer.selected is present, a system message of 'Selected text in question: <selected>' is prepended. As model stream chunks arrive, tool call arguments (title, description) are extracted and a UI 'writer' component is populated with these arguments and isGenerating=true. Produces a draft candidate resource representing the tool call output.""";
    :performedByAgent :WriterAgent ;
    :requiresResource :ConversationStateResource ;
    :producedResource :DraftDocumentCandidateResource ;
    :taskPrompt :PrepareToolBindingPrompt .

:WriteTask rdf:type :Task ;
    dcterms:title "writer" ;
    dcterms:description """Generates the final text document content. Uses a non-streaming model invocation (tags ['nostream']) in implementation to get full content; however the code also uses a streaming invocation to update UI content progressively. System instruction: 'Write a text document based on the user's request. Only output the content, do not ask any additional questions.' If state.context.writer.selected is present the selected text is appended to the system instruction. Consumes conversation history and tool outputs; produces the final document content resource (FinalTextDocument).""";
    :performedByAgent :WriterAgent ;
    :requiresResource :ConversationStateResource, :DraftDocumentCandidateResource ;
    :producedResource :FinalTextDocument ;
    :taskPrompt :WriterSystemPrompt .

:SuggestionsTask rdf:type :Task ;
    dcterms:title "suggestions" ;
    dcterms:description """Takes the last AI message; for each tool call in the message, emits a tool-type message 'Finished' referencing the tool_call id. Then invokes the model with the updated messages and appends the model's finish message to the conversation. This step does non-streaming invocation in the implementation (model.invoke).""";
    :performedByAgent :WriterAgent ;
    :requiresResource :ConversationStateResource, :LastAIMessageResource ;
    :producedResource :SuggestionMessageResource ;
    :taskPrompt :SuggestionsPrompt .

# Prompts used in tasks
:PrepareToolBindingPrompt rdf:type :Prompt ;
    :promptInstruction """(used as tool description binding to model) Prepare a text document for the user with a short title and short description for browsing purposes. Can be also used when creating a new version of the document.""" ;
    :promptInputData "State: if present, prepend system content: 'Selected text in question: <state.context.writer.selected>'" ;
    :promptOutputIndicator "The tool should return a tool call with args matching schema { title: string, description: string }" ;
    dcterms:description "This prompt corresponds to the tool description passed into model.bindTools in the preparation node." .

:WriterSystemPrompt rdf:type :Prompt ;
    :promptInstruction """Write a text document based on the user's request. Only output the content, do not ask any additional questions.""" ;
    :promptInputData "Conversation messages (state.messages) excluding the last tool-call metadata chunk; if state.context.writer.selected exists: append '\\n\\nSelected text in question: <selected>' to the system instruction." ;
    :promptOutputIndicator "A single AI message containing the document content (only content, no additional questions)." ;
    dcterms:description "System instruction used in writer node; preserved exactly from source code." .

:SuggestionsPrompt rdf:type :Prompt ;
    :promptInstruction "Process the last AI message tool_calls: for each tool call, add a tool message 'Finished' referencing the call id, then invoke the model with the updated messages to produce a finishing message." ;
    :promptInputData "Last AI message with tool_calls array; the implementation adds a tool message { type: 'tool', content: 'Finished', tool_call_id: <id> } for each tool call before invoking the model." ;
    :promptOutputIndicator "An AI finish message appended to the conversation." .

# Conversation and message resources
:ConversationStateResource rdf:type beam:Resource ;
    dcterms:title "conversation state.messages" ;
    dcterms:description "Represents the sequence 'state.messages' passed into each node: initial messages from the user and system, including earlier AI messages and tool call fragments. Used as input to model invocations and tool binding." .

:LastAIMessageResource rdf:type beam:Resource ;
    dcterms:title "last AI message" ;
    dcterms:description "The last AI message in conversation state.messages, used by the suggestions step to examine .tool_calls and to create tool-completion messages." .

# Produced resources / document outputs
:DraftDocumentCandidateResource rdf:type beam:Instance ;
    dcterms:title "draft document candidate" ;
    dcterms:description "Resource produced by the prepare node's draft_text_document tool call. Contains fields 'title' and 'description' as specified by the tool schema. In implementation this is created by reading the tool call args from streamed message chunks." ;
    rdfs:label "draft candidate" .

:FinalTextDocument rdf:type beam:Instance ;
    dcterms:title "final text document content" ;
    dcterms:description "Full document content generated by the writer node (system instruction requests only content). In implementation this is assembled from contentStream chunks or returned via non-stream invocation depending on tags." ;
    rdfs:label "final document" .

:SuggestionMessageResource rdf:type beam:Instance ;
    dcterms:title "suggestion / finish message" ;
    dcterms:description "Message produced by the suggestions task consisting of the model's finish output after tool-call finalization (the 'Finished' tool messages are added prior to invocation)." .

# Relationships between tasks and tool usage / capabilities
:PrepareTask :requiresResource :ConversationStateResource .
:PrepareTask :producedResource :DraftDocumentCandidateResource .
:PrepareTask :performedByAgent :WriterAgent .

:WriteTask :requiresResource :ConversationStateResource , :DraftDocumentCandidateResource .
:WriteTask :producedResource :FinalTextDocument .
:WriteTask :performedByAgent :WriterAgent .

:SuggestionsTask :requiresResource :LastAIMessageResource , :ConversationStateResource .
:SuggestionsTask :producedResource :SuggestionMessageResource .
:SuggestionsTask :performedByAgent :WriterAgent .

# Tool and agent interactions / usages
:WriterAgent :agentToolUsage :DraftTextDocumentTool .
:DraftTextDocumentTool :resourceUsage :ConversationStateResource .
:DraftTextDocumentTool :hasCapability :Capability_CreateDraft .
:WriterAgent :hasAgentCapability :Capability_CreateDraft .

# Notes capturing literal code strings and behaviors (preserved for fidelity)
:SourceCodeLiteral_Prompts rdf:type :Instance ;
    dcterms:title "preserved prompts and strings from source code" ;
    dcterms:description """
MODEL_NAME = \"claude-3-5-sonnet-latest\"

Tool description (draft_text_document):
\"Prepare a text document for the user with a short title and short description for browsing purposes. Can be also used when creating a new version of the document.\"

CreateTextDocumentTool Zod schema:
const CreateTextDocumentTool = z.object({
  title: z.string(),
  description: z.string(),
});

Prepare: prepends system message if state.context.writer.selected:
`Selected text in question: ${state.context.writer?.selected}`

Writer system instruction:
\"Write a text document based on the user's request. Only output the content, do not ask any additional questions.\"

Writer uses non-stream invocation in code:
.withConfig({ tags: [\"nostream\"] })

Suggestions step behavior:
- If last message is an AI message and contains tool_calls, add messages of type 'tool' with content 'Finished' and tool_call_id equal to the tool call id.
- Then model.invoke(messages) and append returned finish message.
""" .

# End of Turtle instance population.