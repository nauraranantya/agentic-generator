# Execution time: 91.69 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - The ontology does not model execution/runtime concepts such as streaming responses, asynchronous streams, iterative event loops, or SDK-specific methods (e.g., agent.stream). These runtime/implementation details are represented as literals in prompts/configs and as Tasks to capture intent, but not as executable behavior.
# - The ontology does not provide properties/classes specifically for low-level storage backends, vector stores, or embedding functions. These are recorded as Config entries (configKey/configValue) and as LanguageModel titles where appropriate.
# - There is no explicit property to represent "memory options" as a structured object. They are encoded as separate Config instances with keys such as "memory.options.lastMessages", "memory.options.semanticRecall.topK", etc.
# - Sensitive values (database password) are preserved because fidelity to the source was requested; in practice, credentials should be protected.
# - SDK and code structure (imports, function names, TypeScript constructs) are not modeled â€” only the semantic elements (agents, prompts, memory, models, tasks, workflows, resources, configs) are represented.
# - Streaming chunked responses and interactive CLI loops are represented as Tasks and Prompt templates, but the ontology lacks streaming/time properties; see above.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@base <http://www.w3id.org/agentic-ai/onto#> .

#################################################################
# System / Team
#################################################################

:MastraTeam rdf:type :Team ;
    dcterms:title "Mastra (configured system)" ;
    rdfs:comment "Represents the Mastra orchestration containing configured agents (chefAgent, memoryAgent)." ;
    :hasAgentMember :ChefAgent_INDIVIDUAL , :MemoryAgent_INDIVIDUAL ;
    :hasWorkflowPattern :RecipeWorkflowPattern , :ConversationWithMemoryPattern .

#################################################################
# Language Models
#################################################################

:LM_gpt_4o rdf:type :LanguageModel ;
    dcterms:title "gpt-4o" ;
    dcterms:description "Statistical language model used by agents (from configuration: openai('gpt-4o'))." .

:LM_text_embedding_3_small rdf:type :LanguageModel ;
    dcterms:title "text-embedding-3-small" ;
    dcterms:description "Embedding model used by the memory component for semantic vectors (from configuration: openai.embedding('text-embedding-3-small'))." .

#################################################################
# Knowledge / Memory Store
#################################################################

:SharedMemoryStore rdf:type :Memory ;
    dcterms:title "Postgres-backed Memory" ;
    dcterms:description "A Memory instance configured with a PostgresStore for storage and a PgVector vector store for embeddings." ;
    :hasConfig :Config_MemoryStorage_Host , :Config_MemoryStorage_Port , :Config_MemoryStorage_User , :Config_MemoryStorage_Database , :Config_MemoryStorage_Password , :Config_PgVector_ConnectionString , :Config_Memory_Options_LastMessages , :Config_Memory_Options_SemanticRecall_TopK , :Config_Memory_Options_SemanticRecall_MessageRange , :Config_Memory_Embedder .

# Config items for memory storage and vector store
:Config_MemoryStorage_Host rdf:type :Config ;
    :configKey "memory.storage.host" ;
    :configValue "localhost" .

:Config_MemoryStorage_Port rdf:type :Config ;
    :configKey "memory.storage.port" ;
    :configValue "5432" .

:Config_MemoryStorage_User rdf:type :Config ;
    :configKey "memory.storage.user" ;
    :configValue "postgres" .

:Config_MemoryStorage_Database rdf:type :Config ;
    :configKey "memory.storage.database" ;
    :configValue "postgres" .

:Config_MemoryStorage_Password rdf:type :Config ;
    :configKey "memory.storage.password" ;
    :configValue "postgres" .

:Config_PgVector_ConnectionString rdf:type :Config ;
    :configKey "memory.vector.connectionString" ;
    :configValue "postgresql://postgres:postgres@localhost:5432" .

:Config_Memory_Options_LastMessages rdf:type :Config ;
    :configKey "memory.options.lastMessages" ;
    :configValue "10" .

:Config_Memory_Options_SemanticRecall_TopK rdf:type :Config ;
    :configKey "memory.options.semanticRecall.topK" ;
    :configValue "3" .

:Config_Memory_Options_SemanticRecall_MessageRange rdf:type :Config ;
    :configKey "memory.options.semanticRecall.messageRange" ;
    :configValue "2" .

:Config_Memory_Embedder rdf:type :Config ;
    :configKey "memory.embedder.model" ;
    :configValue "text-embedding-3-small" .

#################################################################
# Agents (LLMAgents)
#################################################################

:ChefAgent_INDIVIDUAL rdf:type :LLMAgent ;
    :agentID "chef-agent" ;
    dcterms:title "Chef Agent" ;
    :agentRole "Chef" ;
    :useLanguageModel :LM_gpt_4o ;
    :hasAgentConfig :ChefAgent_Config_Model , :ChefAgent_Config_MemoryReference ;
    :hasKnowledge :SharedMemoryStore ;
    :agentPrompt :ChefAgent_InstructionPrompt ;
    rdfs:comment "An LLM Agent configured to suggest recipes and cooking steps based on provided ingredients; friendly and practical tone (instructions authored in config)." ;
    :agentResourceUsage :UserResource_SOME_USER_ID .

:ChefAgent_InstructionPrompt rdf:type :Prompt ;
    :promptInstruction "You are Michel, a practical and experienced home chef who helps people cook great meals with whatever ingredients they have available. Your first priority is understanding what ingredients and equipment the user has access to, then suggesting achievable recipes. You explain cooking steps clearly and offer substitutions when needed, maintaining a friendly and encouraging tone throughout." ;
    :promptContext "Agent-level instructions used as the system persona for the Chef Agent." .

:ChefAgent_Config_Model rdf:type :Config ;
    :configKey "agent.model" ;
    :configValue "gpt-4o" .

:ChefAgent_Config_MemoryReference rdf:type :Config ;
    :configKey "agent.memory.reference" ;
    :configValue "SharedMemoryStore (Postgres + PgVector)" .

# Memory agent
:MemoryAgent_INDIVIDUAL rdf:type :LLMAgent ;
    :agentID "memory-agent" ;
    dcterms:title "Memory Agent" ;
    :agentRole "Memory" ;
    :useLanguageModel :LM_gpt_4o ;
    :hasAgentConfig :MemoryAgent_Config_Model , :MemoryAgent_Config_MemoryReference , :MemoryAgent_Config_Behavior ;
    :hasKnowledge :SharedMemoryStore ;
    :agentPrompt :MemoryAgent_InstructionPrompt ;
    rdfs:comment "Agent responsible for recalling memory from past interactions and prompting for missing user info." ;
    :agentResourceUsage :UserResource_SOME_USER_ID .

:MemoryAgent_InstructionPrompt rdf:type :Prompt ;
    :promptInstruction "You are an AI agent with the ability to automatically recall memories from previous interactions. You may have conversations that last hours, days, months, or years. If you don't know it already you should ask for the users name and some info about them." ;
    :promptContext "Agent-level instructions used as the system persona for the Memory Agent." .

:MemoryAgent_Config_Model rdf:type :Config ;
    :configKey "agent.model" ;
    :configValue "gpt-4o" .

:MemoryAgent_Config_MemoryReference rdf:type :Config ;
    :configKey "agent.memory.reference" ;
    :configValue "SharedMemoryStore (Postgres + PgVector)" .

:MemoryAgent_Config_Behavior rdf:type :Config ;
    :configKey "agent.behavior" ;
    :configValue "automatic recall of memories; prompt for user name/info if unknown" .

#################################################################
# Resources (user, produced outputs, examples)
#################################################################

:UserResource_SOME_USER_ID rdf:type beam:Resource ;
    dcterms:title "SOME_USER_ID" ;
    dcterms:description "Logical resource id used as the memory resource key for conversation threading (from source code: const resource = 'SOME_USER_ID')." .

:ThreadExample_39873fbf rdf:type beam:Instance ;
    dcterms:title "thread-39873fbf-84d6-425e-8c1b-8afd798d72a4" ;
    dcterms:description "Example thread id used in chat.ts for long running conversation testing." .

#################################################################
# Prompts observed in source (task-level prompts, system messages)
#################################################################

# index.ts prompts (chef interaction)
:Prompt_Index_WhatCanIMake rdf:type :Prompt ;
    :promptInstruction "In my kitchen I have: pasta, canned tomatoes, garlic, olive oil, and some dried herbs (basil and oregano). What can I make? Please keep your answer brief, only give me the high level steps." ;
    :promptContext "User message to Chef Agent describing available ingredients. Used to request high-level recipe steps." ;
    :promptOutputIndicator "A short list of possible recipes with high-level steps." .

:Prompt_Index_FriendsHouse rdf:type :Prompt ;
    :promptInstruction "Now I'm over at my friend's house, and they have: chicken thighs, coconut milk, sweet potatoes, and some curry powder." ;
    :promptContext "Follow-up user message to Chef Agent describing alternative ingredients at another location." ;
    :promptOutputIndicator "Recipe suggestions appropriate to the listed ingredients." .

:Prompt_Index_RecallPrevious rdf:type :Prompt ;
    :promptInstruction "What did we cook before I went to my friends house?" ;
    :promptContext "User asks Chef Agent to recall prior recipe suggestion; in the source this triggers memory recall with memoryOptions: lastMessages: 3." ;
    :promptOutputIndicator "A concise recall of previous recipe(s) recommended within last messages." .

# chat.ts prompts (memory agent conversation start)
:Prompt_Chat_SystemStart rdf:type :Prompt ;
    :promptInstruction "Chat with user started now ${ISO_TIMESTAMP}. Don't mention this message. This means some time may have passed between this message and the one before. The user left and came back again. Say something to start the conversation up again." ;
    :promptInputData "Note: in code this literal is constructed dynamically using new Date().toISOString(). The placeholder ${ISO_TIMESTAMP} indicates placement." ;
    :promptContext "System-level message used on conversation start to re-engage user after absence." ;
    :promptOutputIndicator "A short re-engagement message to the user." .

:Prompt_Chat_UserMessage_Template rdf:type :Prompt ;
    :promptInstruction "User message (free text). In the interactive loop the contents are forwarded directly to the memoryAgent." ;
    :promptContext "Template for interactive user messages to the Memory Agent." .

#################################################################
# Tasks extracted from code flows
#################################################################

# Recipe suggestion workflow tasks (index.ts run sequence)
:Task_RecipeSuggest_InitialQuery rdf:type :Task ;
    dcterms:title "Recipe Suggestion - initial ingredient list" ;
    dcterms:description "Agent.stream called with Prompt_Index_WhatCanIMake; ChefAgent produces short high-level steps. The call includes threadId and resourceId parameters to enable memory association." ;
    :taskPrompt :Prompt_Index_WhatCanIMake ;
    :performedByAgent :ChefAgent_INDIVIDUAL ;
    :requiresResource :UserResource_SOME_USER_ID ;
    :producedResource :RecipeSuggestion_Output1 .

:Task_RecipeSuggest_FriendsHouseQuery rdf:type :Task ;
    dcterms:title "Recipe Suggestion - friend's ingredient list" ;
    dcterms:description "Agent.stream called with Prompt_Index_FriendsHouse to produce alternative recipes. Uses same threadId and resourceId as previous to keep memory context." ;
    :taskPrompt :Prompt_Index_FriendsHouse ;
    :performedByAgent :ChefAgent_INDIVIDUAL ;
    :requiresResource :UserResource_SOME_USER_ID ;
    :producedResource :RecipeSuggestion_Output2 .

:Task_RecipeSuggest_RecallPrevious rdf:type :Task ;
    dcterms:title "Memory recall: what did we cook before" ;
    dcterms:description "Agent.stream called with Prompt_Index_RecallPrevious requesting recall using memoryOptions.lastMessages = 3." ;
    :taskPrompt :Prompt_Index_RecallPrevious ;
    :performedByAgent :ChefAgent_INDIVIDUAL ;
    :requiresResource :UserResource_SOME_USER_ID ;
    :producedResource :RecipeRecall_Output .

# Chat conversation tasks (chat.ts)
:Task_Chat_StartConversation rdf:type :Task ;
    dcterms:title "Conversation start with re-engagement system message" ;
    dcterms:description "On startup a system message (Prompt_Chat_SystemStart) is sent to the memory agent. This is used to re-engage a returning user and may include a dynamic timestamp." ;
    :taskPrompt :Prompt_Chat_SystemStart ;
    :performedByAgent :MemoryAgent_INDIVIDUAL ;
    :requiresResource :UserResource_SOME_USER_ID ;
    :producedResource :Chat_Reengage_Output .

:Task_Chat_InteractiveMessage rdf:type :Task ;
    dcterms:title "Interactive chat message handling" ;
    dcterms:description "Loop of receiving a user message and calling memoryAgent.stream(prompt, { memory: { thread, resource } }). The user message is forwarded as Prompt_Chat_UserMessage_Template at runtime with concrete content." ;
    :taskPrompt :Prompt_Chat_UserMessage_Template ;
    :performedByAgent :MemoryAgent_INDIVIDUAL ;
    :requiresResource :UserResource_SOME_USER_ID ;
    :producedResource :Chat_Response_Output .

#################################################################
# Produced resource instances (represent textual outputs)
#################################################################

:RecipeSuggestion_Output1 rdf:type beam:Instance ;
    dcterms:title "Recipe suggestion (initial)" ;
    dcterms:description "Text output from ChefAgent in response to Prompt_Index_WhatCanIMake. Contains high-level steps." .

:RecipeSuggestion_Output2 rdf:type beam:Instance ;
    dcterms:title "Recipe suggestion (friend's house)" ;
    dcterms:description "Text output from ChefAgent in response to Prompt_Index_FriendsHouse." .

:RecipeRecall_Output rdf:type beam:Instance ;
    dcterms:title "Recipe recall" ;
    dcterms:description "Text output from ChefAgent summarizing prior recipe suggestions (requested via Prompt_Index_RecallPrevious)." .

:Chat_Reengage_Output rdf:type beam:Instance ;
    dcterms:title "Chat re-engagement message" ;
    dcterms:description "Text produced by MemoryAgent after system start prompt (Prompt_Chat_SystemStart)." .

:Chat_Response_Output rdf:type beam:Instance ;
    dcterms:title "Chat agent response" ;
    dcterms:description "General chat response generated by MemoryAgent for user-provided messages." .

#################################################################
# Workflow patterns and steps
#################################################################

:RecipeWorkflowPattern rdf:type :WorkflowPattern ;
    dcterms:title "Recipe suggestion workflow" ;
    dcterms:description "Sequence in index.ts showing Chef Agent receiving ingredients, producing suggestions, and recalling prior suggestions using shared memory." ;
    :hasWorkflowStep :RecipeStep_StartQuery , :RecipeStep_FriendsHouseQuery , :RecipeStep_RecallQuery , :RecipeStep_End .

:RecipeStep_StartQuery rdf:type :StartStep , :WorkflowStep ;
    :stepOrder "1"^^xsd:integer ;
    :hasAssociatedTask :Task_RecipeSuggest_InitialQuery .

:RecipeStep_FriendsHouseQuery rdf:type :WorkflowStep ;
    :stepOrder "2"^^xsd:integer ;
    :hasAssociatedTask :Task_RecipeSuggest_FriendsHouseQuery ;
    :relatedStep :RecipeStep_StartQuery .

:RecipeStep_RecallQuery rdf:type :WorkflowStep ;
    :stepOrder "3"^^xsd:integer ;
    :hasAssociatedTask :Task_RecipeSuggest_RecallPrevious ;
    :relatedStep :RecipeStep_FriendsHouseQuery .

:RecipeStep_End rdf:type :EndStep , :WorkflowStep ;
    :stepOrder "4"^^xsd:integer ;
    :hasAssociatedTask :Task_RecipeSuggest_RecallPrevious ;
    :relatedStep :RecipeStep_RecallQuery .

:ConversationWithMemoryPattern rdf:type :WorkflowPattern ;
    dcterms:title "Conversational memory pattern" ;
    dcterms:description "Pattern in chat.ts showing a memory-aware conversation: system re-engagement message, interactive user loop, and memory-backed recall/persistence." ;
    :hasWorkflowStep :ConvStep_Start , :ConvStep_InteractiveLoop , :ConvStep_End .

:ConvStep_Start rdf:type :StartStep , :WorkflowStep ;
    :stepOrder "1"^^xsd:integer ;
    :hasAssociatedTask :Task_Chat_StartConversation .

:ConvStep_InteractiveLoop rdf:type :WorkflowStep ;
    :stepOrder "2"^^xsd:integer ;
    :hasAssociatedTask :Task_Chat_InteractiveMessage ;
    :relatedStep :ConvStep_Start .

:ConvStep_End rdf:type :EndStep , :WorkflowStep ;
    :stepOrder "3"^^xsd:integer ;
    :hasAssociatedTask :Task_Chat_InteractiveMessage ;
    :relatedStep :ConvStep_InteractiveLoop .

#################################################################
# Additional semantic links capturing usage / capabilities
#################################################################

# Agents declare capability "use memory" and "suggest recipes" as Capability individuals
:Capability_UseMemory rdf:type :Capability ;
    rdfs:label "use memory" ;
    rdfs:comment "Capability to store and recall conversation history via the SharedMemoryStore." .

:Capability_SuggestRecipes rdf:type :Capability ;
    rdfs:label "suggest recipes" ;
    rdfs:comment "Capability to propose recipes and high-level cooking steps given ingredient lists." .

:ChefAgent_INDIVIDUAL :hasAgentCapability :Capability_SuggestRecipes .
:MemoryAgent_INDIVIDUAL :hasAgentCapability :Capability_UseMemory .

# Agents operate in no specific modeled Environment in source code; but we can link to a generic environment context if desired:
:Env_LocalDevelop rdf:type :Environment ;
    :envType "local-development" ;
    dcterms:description "Configuration indicates use of localhost postgres and local services (from source code constants)." .

:ChefAgent_INDIVIDUAL :operatesIn :Env_LocalDevelop .
:MemoryAgent_INDIVIDUAL :operatesIn :Env_LocalDevelop .

#################################################################
# Miscellaneous notes preserved as Config entries for fidelity
#################################################################

:Config_Runtime_ThreadExample rdf:type :Config ;
    :configKey "runtime.exampleThread" ;
    :configValue "39873fbf-84d6-425e-8c1b-8afd798d72a4" .

:Config_Index_ThreadId_Template rdf:type :Config ;
    :configKey "index.threadId.example" ;
    :configValue "randomUUID() used in code - unique per run unless overridden" .

:Config_Chat_Resource_Variable rdf:type :Config ;
    :configKey "chat.memory.resource" ;
    :configValue "SOME_USER_ID (used as resource id for threading)" .

#################################################################
# End of instance population
#################################################################