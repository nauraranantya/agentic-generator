# Execution time: 87.87 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - Missing explicit class for an execution "Run" or "WorkflowRun" (cannot model runtime/instance/state as a first-class individual with specific run lifecycle properties). Modeled example runs as Task-produced beam:Resource artifacts instead.
# - No dedicated property or class for "suspend/resume" control semantics. Represented suspend/resume schemas and behavior as Prompt literals associated with the Task/WorkflowStep.
# - No first-class representation for "schema" (zod) objects. Captured input/output/suspend/resume schemas as JSON strings in Prompt promptInputData/promptOutputIndicator/promptContext.
# - No property for nesting/embedding a WorkflowPattern as a WorkflowStep call. Used hasSubPattern to link containing workflow to nested workflow and also created an explicit WorkflowStep representing the invocation for reconstructability.
# - No class for storage "Run snapshot" metadata or timing/delay. Captured storage/tool config as Config individuals and delay behavior described in Prompt/instructions.
# - No specific property to record sample runtime values (e.g., initial inputValue, resumeData). Included those as literal JSON examples in beam:Resource descriptions produced by an invocation Task.
# - No LLMAgent is present in the source code; runtime/action is modeled as Tool instances (Mastra runtime and LibSQLStore) and a Team for the Mastra system.
# - No unique "Run ID" or timeline modeling available in ontology; example run artifacts are provided as Resources with descriptive literals.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@base <http://www.w3id.org/agentic-ai/onto#> .

#################################################################
# System / Tools / Configuration
#################################################################

:mastra-system rdf:type :Team ;
               rdfs:label "Mastra System" ;
               rdfs:comment "The Mastra orchestrator system that defines and executes workflows." ;
               :hasWorkflowPattern :my-workflow ;
               :hasSystemConfig :mastra-system-config .

:mastra-system-config rdf:type :Config ;
                      rdfs:label "Mastra system config (storage reference)" ;
                      :configKey "storage" ;
                      :configValue "LibSQLStore (id: workflow-snapshots-storage, url: file:./workflow-snapshots.db)" .

:mastra-runtime rdf:type :Tool ;
                rdfs:label "Mastra Runtime (core executor)" ;
                rdfs:comment "Logical runtime tool that executes workflow steps and coordinates suspend/resume behavior." .

:libsql-store rdf:type :Tool ;
              rdfs:label "LibSQLStore" ;
              rdfs:comment "Storage plugin used by Mastra for workflow snapshots." ;
              :hasToolConfig :libsql-config-id , :libsql-config-url .

:libsql-config-id rdf:type :Config ;
                  :configKey "id" ;
                  :configValue "workflow-snapshots-storage" ;
                  rdfs:label "LibSQLStore id" .

:libsql-config-url rdf:type :Config ;
                   :configKey "url" ;
                   :configValue "file:./workflow-snapshots.db" ;
                   rdfs:label "LibSQLStore url" .

#################################################################
# Workflow Patterns (nested & top-level)
#################################################################

:my-workflow rdf:type :WorkflowPattern ;
             rdfs:label "my-workflow" ;
             rdfs:comment "Top-level workflow that invokes the nested data-processing workflow." ;
             :hasSubPattern :data-processing ;
             :hasWorkflowStep :invoke-data-processing-step .

# The nested workflow that performs the 4-step data processing pipeline
:data-processing rdf:type :WorkflowPattern ;
                 rdfs:label "data-processing" ;
                 rdfs:comment "Nested workflow composed of stepOne, stepTwo (suspend/resume), stepThree, stepFour." ;
                 :hasWorkflowStep :stepOne-ws ,
                                  :stepTwo-ws ,
                                  :stepThree-ws ,
                                  :stepFour-ws .

# A WorkflowStep in the top-level workflow that represents invocation of the nested workflow
:invoke-data-processing-step rdf:type :WorkflowStep ;
                            rdfs:label "invoke data-processing (nested workflow) step" ;
                            :stepOrder "1"^^xsd:integer ;
                            :hasAssociatedTask :task_invoke_data_processing .

:task_invoke_data_processing rdf:type :Task ;
                             rdfs:label "Invoke nested data-processing workflow" ;
                             rdfs:comment "Represents the top-level step that calls the nested data-processing workflow. Performed by Mastra runtime." ;
                             :performedBy :mastra-runtime ;
                             :hasPrompt :prompt_invoke_data_processing ;
                             :producedResource :res_example_run_suspended , :res_example_run_resumed .

:prompt_invoke_data_processing rdf:type :Prompt ;
                               rdfs:label "my-workflow invocation prompt/schema" ;
                               :promptInstruction "Invokes nested workflow 'data-processing' with input schema { inputValue: number } and expects output { isEven: boolean }." ;
                               :promptInputData "{\"inputSchema\": { \"inputValue\": \"number\" }, \"exampleInput\": { \"inputValue\": 30 } }" ;
                               :promptOutputIndicator "{\"outputSchema\": { \"isEven\": \"boolean\" } }" ;
                               :promptContext "This step represents a nested workflow invocation, mapping input to the nested pattern 'data-processing'." .

#################################################################
# Workflow Steps (nested data-processing) and Tasks/Prompts/Resources
#################################################################

### Step One
:stepOne-ws rdf:type :WorkflowStep ;
            rdfs:label "stepOne" ;
            :stepOrder "1"^^xsd:integer ;
            :hasAssociatedTask :task_stepOne .

:task_stepOne rdf:type :Task ;
              rdfs:label "stepOne task (double input)" ;
              rdfs:comment "Waits 10 seconds, computes doubledValue = inputValue * 2." ;
              :performedBy :mastra-runtime ;
              :hasPrompt :prompt_stepOne ;
              :producedResource :res_doubledValue .

:prompt_stepOne rdf:type :Prompt ;
                rdfs:label "stepOne prompt/schema/execution" ;
                :promptInputData "{\"inputSchema\": { \"inputValue\": \"number\" }, \"example\": { \"inputValue\": 30 } }" ;
                :promptOutputIndicator "{\"outputSchema\": { \"doubledValue\": \"number\" }, \"example\": { \"doubledValue\": 60 } }" ;
                :promptInstruction "Execution logic: await delay(10000); doubledValue = inputData.inputValue * 2; return { doubledValue }." ;
                :promptContext "This step uses an input numeric schema and produces doubledValue. Simulates a 10 second processing delay." .

:res_doubledValue rdf:type beam:Resource ;
                  rdfs:label "doubledValue (resource)" ;
                  <http://purl.org/dc/terms/description> "{\"name\": \"doubledValue\", \"type\": \"number\", \"exampleValue\": 60}" ;
                  rdfs:comment "Output resource produced by stepOne (doubledValue)." .

### Step Two (suspend/resume)
:stepTwo-ws rdf:type :WorkflowStep ;
            rdfs:label "stepTwo" ;
            :stepOrder "2"^^xsd:integer ;
            :hasAssociatedTask :task_stepTwo .

:task_stepTwo rdf:type :Task ;
              rdfs:label "stepTwo task (suspend/resume increment)" ;
              rdfs:comment "Conditionally suspends execution until resume data with extraNumber is provided. On resume computes incrementedValue." ;
              :performedBy :mastra-runtime ;
              :hasPrompt :prompt_stepTwo ;
              :producedResource :res_incrementedValue .

:prompt_stepTwo rdf:type :Prompt ;
                rdfs:label "stepTwo prompt/schema/suspend-resume" ;
                :promptInputData "{\"inputSchema\": { \"doubledValue\": \"number\" }, \"example\": { \"doubledValue\": 60 } }" ;
                :promptContext "{\"suspendSchema\": {}, \"resumeSchema\": { \"extraNumber\": \"number\" }, \"suspendBehavior\": \"When resumeData.extraNumber is absent, the step calls suspend({}) and returns { incrementedValue: 0 } as a transient output. On resume, it expects resumeData.extraNumber (number).\" }" ;
                :promptInstruction "Execution logic: if (!resumeData?.extraNumber) { await suspend({}); return { incrementedValue: 0 }; } else { incrementedValue = inputData.doubledValue + 1 + resumeData.extraNumber; return { incrementedValue }; }" ;
                :promptOutputIndicator "{\"outputSchema\": { \"incrementedValue\": \"number\" }, \"examples\": { \"suspendedReturn\": { \"incrementedValue\": 0 }, \"onResume\": { \"incrementedValue\": 66 } } }" .

:res_incrementedValue rdf:type beam:Resource ;
                      rdfs:label "incrementedValue (resource)" ;
                      <http://purl.org/dc/terms/description> "{\"name\": \"incrementedValue\", \"type\": \"number\", \"exampleOnResume\": 66, \"exampleWhenSuspended\": 0}" ;
                      rdfs:comment "Output resource produced by stepTwo. Value depends on resume data." .

### Step Three
:stepThree-ws rdf:type :WorkflowStep ;
              rdfs:label "stepThree" ;
              :stepOrder "3"^^xsd:integer ;
              :hasAssociatedTask :task_stepThree .

:task_stepThree rdf:type :Task ;
                rdfs:label "stepThree task (triple incrementedValue)" ;
                rdfs:comment "Triples the incrementedValue to produce tripledValue." ;
                :performedBy :mastra-runtime ;
                :hasPrompt :prompt_stepThree ;
                :requiresResource :res_incrementedValue ;
                :producedResource :res_tripledValue .

:prompt_stepThree rdf:type :Prompt ;
                  rdfs:label "stepThree prompt/schema/execution" ;
                  :promptInputData "{\"inputSchema\": { \"incrementedValue\": \"number\" }, \"example\": { \"incrementedValue\": 66 } }" ;
                  :promptOutputIndicator "{\"outputSchema\": { \"tripledValue\": \"number\" }, \"example\": { \"tripledValue\": 198 } }" ;
                  :promptInstruction "Execution logic: tripledValue = inputData.incrementedValue * 3; return { tripledValue }." .

:res_tripledValue rdf:type beam:Resource ;
                  rdfs:label "tripledValue (resource)" ;
                  <http://purl.org/dc/terms/description> "{\"name\": \"tripledValue\", \"type\": \"number\", \"exampleValue\": 198}" ;
                  rdfs:comment "Output resource produced by stepThree (tripledValue)." .

### Step Four
:stepFour-ws rdf:type :WorkflowStep ;
             rdfs:label "stepFour" ;
             :stepOrder "4"^^xsd:integer ;
             :hasAssociatedTask :task_stepFour .

:task_stepFour rdf:type :Task ;
               rdfs:label "stepFour task (isEven check)" ;
               rdfs:comment "Determines if tripledValue is even." ;
               :performedBy :mastra-runtime ;
               :hasPrompt :prompt_stepFour ;
               :requiresResource :res_tripledValue ;
               :producedResource :res_isEven .

:prompt_stepFour rdf:type :Prompt ;
                 rdfs:label "stepFour prompt/schema/execution" ;
                 :promptInputData "{\"inputSchema\": { \"tripledValue\": \"number\" }, \"example\": { \"tripledValue\": 198 } }" ;
                 :promptOutputIndicator "{\"outputSchema\": { \"isEven\": \"boolean\" }, \"example\": { \"isEven\": true } }" ;
                 :promptInstruction "Execution logic: isEven = (inputData.tripledValue % 2 === 0); return { isEven }." .

:res_isEven rdf:type beam:Resource ;
            rdfs:label "isEven (resource)" ;
            <http://purl.org/dc/terms/description> "{\"name\": \"isEven\", \"type\": \"boolean\", \"exampleValue\": true }" ;
            rdfs:comment "Final boolean output indicating whether the numeric pipeline result is even." .

#################################################################
# Example run artifacts (demonstrates suspend/resume sequence)
#################################################################

# Example: initial run that becomes suspended at stepTwo
:res_example_run_suspended rdf:type beam:Resource ;
                          rdfs:label "example run result (suspended)" ;
                          <http://purl.org/dc/terms/description> """
{
  \"status\": \"suspended\",
  \"suspendedSteps\": [\"stepTwo\"],
  \"observedOutputs\": {
    \"doubledValue\": 60,
    \"incrementedValue\": 0
  },
  \"input\": { \"inputValue\": 30 },
  \"note\": \"During stepTwo execution resumeData.extraNumber is absent; the step called suspend({}) and returned incrementedValue:0 as transient output.\"
}
""" ;
                          rdfs:comment "Representative example of run state after start() with inputValue 30: workflow suspended at stepTwo." .

# Example: resumed run result after providing resume data extraNumber:5
:res_example_run_resumed rdf:type beam:Resource ;
                        rdfs:label "example run result (resumed / completed)" ;
                        <http://purl.org/dc/terms/description> """
{
  \"status\": \"completed\",
  \"finalOutputs\": {
    \"doubledValue\": 60,
    \"incrementedValue\": 66,
    \"tripledValue\": 198,
    \"isEven\": true
  },
  \"resumeData\": { \"extraNumber\": 5 },
  \"note\": \"Resumed stepTwo with extraNumber 5, subsequent steps executed to completion.\"
}
""" ;
                        rdfs:comment "Representative example of run after resume(stepTwo, { extraNumber: 5 })." .

#################################################################
# Cross-references and provenance
#################################################################

# Associate produced resources with the top-level invocation task too, for reconstructability
:task_invoke_data_processing :producedResource :res_example_run_suspended , :res_example_run_resumed .

# Tool usage and resource containment
:mastra-system :containsResource :libsql-store .
:libsql-store :resourceUsage :libsql-config-id , :libsql-config-url .

# Link prompts to tasks (already linked) and document relationships
:task_stepOne rdfs:seeAlso :prompt_stepOne .
:task_stepTwo rdfs:seeAlso :prompt_stepTwo .
:task_stepThree rdfs:seeAlso :prompt_stepThree .
:task_stepFour rdfs:seeAlso :prompt_stepFour .
:task_invoke_data_processing rdfs:seeAlso :prompt_invoke_data_processing .