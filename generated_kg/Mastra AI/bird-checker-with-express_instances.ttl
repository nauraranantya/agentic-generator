# Execution time: 66.31 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - The ontology does not provide specific constructs for modeling HTTP endpoints, HTTP methods, or server runtime behavior. I modeled the runtime workflow and tasks (which correspond to the endpoints' functionality) but did not model Express/HTTP server internals.
# - The ontology does not have a dedicated class/property for input/output schema objects (e.g., zod schemas). I encoded schema details as string literals inside :Config and prompt output indicators.
# - The ontology lacks explicit properties to represent secret management (environment variables) or execution code. I recorded references to environment keys (UNSPLASH_ACCESS_KEY) as config key/value literals but did not model secrets or runtime retrieval mechanisms.
# - The ontology cannot represent code-level constructs (TypeScript types, SDK call semantics). I preserved the semantic intent (tool that fetches images, agent that analyzes images, expected outputs and prompts) as individuals and literal fields.
# - No other classes or properties were added; everything uses the existing ontology vocabulary.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@base <http://www.w3id.org/agentic-ai/onto#> .

#################################################################
# System / Team (runtime)
#################################################################

:mastraSystem rdf:type :Team ;
    dcterms:title "Mastra Server" ;
    dcterms:description "The deployed Mastra-based system hosting an agent and tools to fetch and analyze images (server runs on Node/Express)." ;
    :hasAgentMember :birdCheckerAgent ;
    :hasWorkflowPattern :imageMetadataWorkflow ;
    :hasSystemConfig :mastraSystemConfig .

:mastraSystemConfig rdf:type :Config ;
    :configKey "port" ;
    :configValue "process.env.PORT || 3001 (default 3001)" ;
    dcterms:description "System-level configuration: server port. Environment variable fallback described." .

#################################################################
# Language Model used by agent
#################################################################

:claudeModel rdf:type :LanguageModel ;
    dcterms:title "claude-3-haiku-20240307" ;
    dcterms:description "Anthropic language model referenced in the agent configuration (model id used in code)." .

#################################################################
# Agent
#################################################################

:birdCheckerAgent rdf:type :LLMAgent ;
    :agentID "bird-checker" ;
    dcterms:title "Bird Checker" ;
    :agentRole "image-analyst" ;
    :agentPrompt :birdCheckerAgentPrompt ;
    :useLanguageModel :claudeModel ;
    :hasAgentConfig :birdCheckerAgentConfig .

:birdCheckerAgentPrompt rdf:type :Prompt ;
    dcterms:description "Agent-level instructions: general behavior and capabilities for the agent." ;
    :promptInstruction "You can view an image and figure out if it is a bird or not. You can also figure out the species of the bird and where the picture was taken." .

:birdCheckerAgentConfig rdf:type :Config ;
    :configKey "model_provider" ;
    :configValue "@ai-sdk/anthropic (claude-3-haiku-20240307)" ;
    dcterms:description "Configuration describing the language model provider and model id used by the agent." .

#################################################################
# Tool: Unsplash image fetcher
#################################################################

:getRandomImageTool rdf:type :Tool ;
    dcterms:title "Get a random image from unsplash" ;
    dcterms:description "Gets a random image from Unsplash based on selected query option. Random page selection and order_by ('relevant' or 'latest') logic is applied at runtime." ;
    :hasToolConfig :getRandomImageToolConfig ;
    :resourceUsage :unsplashAPI .

:getRandomImageToolConfig rdf:type :Config ;
    :configKey "inputSchema" ;
    :configValue "{\"type\":\"enum\",\"values\":[\"wildlife\",\"feathers\",\"flying\",\"birds\"]}" ;
    dcterms:description "The tool expects an input 'query' which is one of the enumerated values. This mirrors the zod input schema in the implementation." .

:unsplashAPI rdf:type beam:Resource ;
    dcterms:title "Unsplash API" ;
    dcterms:description "External API resource used by the get-random-image tool. Requires UNSPLASH_ACCESS_KEY environment variable (UNSPLASH_ACCESS_KEY)." .

#################################################################
# Resources (data/artifacts)
#################################################################

:randomImageResource rdf:type beam:Instance ;
    dcterms:title "Unsplash Image" ;
    dcterms:description """Runtime artifact produced by the image-fetch tool. Fields produced at runtime include:
- imageUrl: raw image URL (string)
- photographerName: first name of photographer (string)
- photographerProfile: link to photographer profile (string)
This instance represents the image resource passed between tasks.""" .

:imageMetadataResource rdf:type beam:Instance ;
    dcterms:title "Image Metadata (bird detection)" ;
    dcterms:description """Metadata produced by the image analysis task. Schema (expected):
- bird: boolean
- species: string
- location: string
This reflects the structured output schema provided to the agent in the code (zod object with fields bird, species, location).""" .

#################################################################
# Tasks
#################################################################

:taskFetchRandomImage rdf:type :Task ;
    dcterms:title "Fetch Random Image" ;
    dcterms:description "Task that selects a random image from Unsplash using the getRandomImage tool with a query parameter drawn from an enum of options." ;
    :performedBy :getRandomImageTool ;
    :producedResource :randomImageResource .

:taskAnalyzeImage rdf:type :Task ;
    dcterms:title "Analyze Image Metadata" ;
    dcterms:description "Task that sends an image and an instruction prompt to the LLM agent to determine whether the image is a bird, the species (scientific name) and a short summary of the picture location." ;
    :performedByAgent :birdCheckerAgent ;
    :requiresResource :randomImageResource ;
    :producedResource :imageMetadataResource ;
    :hasPrompt :analyzeImagePrompt .

#################################################################
# Prompt used in the Analyze task (captures the exact user content)
#################################################################

:analyzeImagePrompt rdf:type :Prompt ;
    :promptInputData "{\"type\":\"image\",\"placeholder\":\"<imageUrl will be provided at runtime>\"}" ;
    :promptInstruction "view this image and let me know if it's a bird or not, and the scientific name of the bird without any explanation. Also summarize the location for this picture in one or two short sentences understandable by a high school student" ;
    :promptOutputIndicator "{\"bird\":\"boolean\",\"species\":\"string\",\"location\":\"string\"}" ;
    dcterms:description "This prompt mirrors the user message passed to birdCheckerAgent.generate in the implementation. The prompt includes an image and the text instruction. The expected structured output is described in promptOutputIndicator." .

#################################################################
# Workflow Pattern and Steps
#################################################################

:imageMetadataWorkflow rdf:type :WorkflowPattern ;
    dcterms:title "Image Metadata Workflow" ;
    dcterms:description "A simple two-step workflow: fetch a random image and analyze it for bird metadata. This workflow represents the server endpoints' functional logic." ;
    :hasWorkflowStep :stepFetchImage , :stepAnalyzeImage .

:stepFetchImage rdf:type :StartStep ;
    :stepOrder 1 ;
    dcterms:title "Fetch Image Step" ;
    :hasAssociatedTask :taskFetchRandomImage ;
    :nextStep :stepAnalyzeImage .

:stepAnalyzeImage rdf:type :EndStep ;
    :stepOrder 2 ;
    dcterms:title "Analyze Image Step" ;
    :hasAssociatedTask :taskAnalyzeImage .

#################################################################
# Additional links / provenance hints
#################################################################

# Indicate that the Team (system) follows this workflow and the agent participates in the tasks
:taskFetchRandomImage :performedBy :getRandomImageTool .
:taskAnalyzeImage :performedByAgent :birdCheckerAgent .

# Human agent is not present in this solution (no human participation modeled).
# End of individuals.