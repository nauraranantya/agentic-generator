# Execution time: 82.51 seconds
# Model used: gpt-5-mini

Issues / Assumptions:
- The ontology has no explicit class/property for "session" or "thread" concepts (runtime identifiers). I modelled the runtime threadId and resourceId as beam:Instance resources, but there is no standardized "session" property to link them to an agent or task.
- The ontology lacks properties to represent streaming behavior, callbacks, or tag-masking functions (e.g., maskStreamTags). I preserved these as literal configuration values or prompt instructions; they cannot be modelled as executable behavior.
- There is no explicit key/value pairing mechanism on Config objects. To preserve key->value fidelity I modelled each key/value pair as a separate Config individual (one Config instance per option).
- The ontology has no property to pair Config entries into a structured map (e.g., nested workingMemory.enabled and workingMemory.template). I encoded keys as literal strings that include the hierarchical key names exactly as in the source code.
- Implementation-specific details (file/module names, JS/TS constructs, SDK functions) are intentionally omitted per instructions and represented as semantic concepts (prompts, memory, model, tasks, resources) only.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@base <http://www.w3id.org/agentic-ai/onto#> .

################################################################################
# Agent instance
################################################################################

:todoAgent a :LLMAgent ;
    dcterms:title "TODO Agent" ;
    :agentID "todo-agent" ;
    :agentRole "todolist manager" ;
    :hasAgentConfig :todoAgentConfig_lastMessages ,
                    :todoAgentConfig_semanticRecall ,
                    :todoAgentConfig_workingMemory_enabled ,
                    :todoAgentConfig_workingMemory_template ,
                    :todoAgentConfig_streaming_maskTag ;
    :hasKnowledge :todoMemory ;
    :useLanguageModel :gpt4oMini ;
    :agentPrompt :todoAgentInstructionPrompt ;
    :hasAgentCapability :cap_manage_todo_list ,
                        :cap_timebox_tasks ,
                        :cap_save_memory_every_response ,
                        :cap_format_and_render_list_with_emojis_subtasks ;
    :agentResourceUsage :userResource .

################################################################################
# Language model / resources
################################################################################

:gpt4oMini a :LanguageModel ;
    dcterms:title "gpt-4o-mini" ;
    dcterms:description "The statistical language model used by the agent (model identifier from configuration)." .

:userResource a beam:Instance ;
    dcterms:title "SOME_USER_ID" ;
    dcterms:description "External identifier passed to the agent as resourceId (represents the user-specific resource used for memory/session association in the source). Note: value originates in the code as the constant 'SOME_USER_ID'." .

:thread_d4e58927_ca27_46f9_8559_0c792e76e6f6 a beam:Instance ;
    dcterms:title "d4e58927-ca27-46f9-8559-0c792e76e6f6" ;
    dcterms:description "Representative threadId used in the runtime example. Modeled as a resource instance to preserve the runtime identifier." .

################################################################################
# Memory (KnowledgeBase) and configuration (Config) instances
################################################################################

:todoMemory a :Memory ;
    dcterms:title "TODO Agent Working Memory" ;
    dcterms:description """Memory configuration used by the TODO Agent. Options extracted from source:
- lastMessages: 1
- semanticRecall: false
- workingMemory.enabled: true
- workingMemory.template: (see separate Config entry)
The agent depends on a single previous message and MUST store working memory in every response to remain consistent with the original implementation and instruction set.""" .

:todoAgentConfig_lastMessages a :Config ;
    :configKey "lastMessages" ;
    :configValue "1" ;
    dcterms:description "Number of last messages kept (source: Memory({ options: { lastMessages: 1 } }))" .

:todoAgentConfig_semanticRecall a :Config ;
    :configKey "semanticRecall" ;
    :configValue "false" ;
    dcterms:description "Semantic recall disabled (source: Memory({ options: { semanticRecall: false } }))" .

:todoAgentConfig_workingMemory_enabled a :Config ;
    :configKey "workingMemory.enabled" ;
    :configValue "true" ;
    dcterms:description "Working memory explicitly enabled (source: Memory({ options: { workingMemory: { enabled: true } } }))" .

:todoAgentConfig_workingMemory_template a :Config ;
    :configKey "workingMemory.template" ;
    :configValue """# Todo List
## Active Items
- Example (Due: Feb 7 3028, Started: Feb 7 2025)
  - Description: This is an example task - replace with whatever the user needs

## Completed Items
- None yet
""" ;
    dcterms:description "The initial working memory template string used by the agent (exact multi-line template from source)." .

:todoAgentConfig_streaming_maskTag a :Config ;
    :configKey "streaming.maskTag" ;
    :configValue "working_memory" ;
    dcterms:description "The mask/tag identifier used during streaming to capture or hide working memory sections (source uses maskStreamTags with tag 'working_memory')." .

################################################################################
# Prompts
################################################################################

:todoAgentInstructionPrompt a :Prompt ;
    dcterms:title "Agent Instructions (system role content configured on agent)" ;
    :promptInstruction """You are a helpful todolist AI agent. Help the user manage their todolist. If there is no list yet ask them what to add! If there is a list always print it out when the chat starts. For each item add emojis, dates, titles (with an index number starting at 1), descriptions, and statuses. For each piece of info add an emoji to the left of it. Also support subtask lists with bullet points inside a box. Help the user timebox each task by asking them how long it will take. You MUST save the todolist in every response message by printing out <working_memory> blocks. If you do not save it in working_memory you will forget - you only have access to one previous message at any time. The user is expecting you to save your memory in every interaction. If the user expresses any preference on how the list should be displayed, save that info in working_memory so you know how to format it later.""" ;
    :promptOutputIndicator "Expect the agent to emit working memory blocks wrapped in <working_memory> ... </working_memory> in every response." ;
    dcterms:description "Agent-level instructions provided as a persistent prompt (source: Agent({ instructions: ... }))" .

:systemMessageFirstChat a :Prompt ;
    dcterms:title "System message: first chat" ;
    :promptInstruction "Chat with user started now {timestamp}." ;
    :promptContext "Used as the system role content when a chat is detected as first-time (isFirstChat true). The source code inserts an ISO timestamp at {timestamp}." ;
    dcterms:description "Dynamic system message template used when starting a chat for the first time. Source: index.ts logic (uses new Date().toISOString())." .

:systemMessageReturnChat a :Prompt ;
    dcterms:title "System message: return chat / resumed session" ;
    :promptInstruction """Chat with user started now {timestamp}. Don't mention this message. This means some time has passed between this message and the one before. The user left and came back again. Say something to start the conversation up again.""" ;
    :promptContext "Used as the system role content when the chat is detected as not first-time (isFirstChat false). The source code inserts an ISO timestamp at {timestamp}." ;
    dcterms:description "Dynamic system message template used when the user returns to a chat session and the system wants the agent to re-engage without referencing the system message." .

:saveWorkingMemoryPrompt a :Prompt ;
    dcterms:title "Save working memory prompt fragment" ;
    :promptInstruction """You MUST save the todolist in every response message by printing out <working_memory> blocks. If you do not save it in working_memory you will forget - you only have access to one previous message at any time. The user is expecting you to save your memory in every interaction. If the user expresses any preference on how the list should be displayed, save that info in working_memory so you know how to format it later.""" ;
    :promptOutputIndicator "Agent must emit working memory content enclosed with <working_memory> ... </working_memory> tags in every response." ;
    dcterms:description "Explicit requirement embedded in the agent instructions and used during task execution to guarantee persistence." .

################################################################################
# Capabilities
################################################################################

:cap_manage_todo_list a :Capability ;
    rdfs:label "manage todo list" ;
    rdfs:comment "Ability to create, update, list, and complete todo items." .

:cap_timebox_tasks a :Capability ;
    rdfs:label "timebox tasks" ;
    rdfs:comment "Ability to ask the user for estimated durations and enforce timeboxing of tasks." .

:cap_save_memory_every_response a :Capability ;
    rdfs:label "save memory every response" ;
    rdfs:comment "Requirement to persist working memory in every interaction to prevent forgetting between turns." .

:cap_format_and_render_list_with_emojis_subtasks a :Capability ;
    rdfs:label "format and render list with emojis and subtasks" ;
    rdfs:comment "Ability to render todo lists with emojis, date fields, indexed titles, descriptions, statuses, and nested subtasks using boxed bullet lists." .

################################################################################
# Workflow pattern and steps (semantic description of agent behavior)
################################################################################

:todoChatLoop a :WorkflowPattern ;
    dcterms:title "TODO Agent Chat Loop" ;
    rdfs:comment "A simple conversational workflow: initialize, present list (or ask to add), accept user input, update list, timebox if needed, save working memory; repeat." ;
    :hasWorkflowStep :startStep ,
                     :presentListStep ,
                     :receiveUserInputStep ,
                     :askTimeboxStep ,
                     :saveMemoryStep ,
                     :endStep .

:startStep a :StartStep ;
    :stepOrder 1 ;
    rdfs:label "Start: Initialize chat" ;
    :hasAssociatedTask :initFirstChatTask , :initReturnChatTask .

:initFirstChatTask a :Task ;
    dcterms:title "Initialize First Chat" ;
    rdfs:comment "When the session is fresh, send the system prompt for first chat and ensure the agent prints the todo list if present (per agent instructions)." ;
    :taskPrompt :systemMessageFirstChat ;
    :performedByAgent :todoAgent ;
    :requiresResource :todoMemory ;
    :requiresResource :gpt4oMini .

:initReturnChatTask a :Task ;
    dcterms:title "Initialize Return Chat" ;
    rdfs:comment "When the user returns, send the return-chat system prompt (do not mention it) and re-engage user politely, then present todo list." ;
    :taskPrompt :systemMessageReturnChat ;
    :performedByAgent :todoAgent ;
    :requiresResource :todoMemory ;
    :requiresResource :gpt4oMini .

:presentListStep a :WorkflowStep ;
    :stepOrder 2 ;
    rdfs:label "Present todo list" ;
    :hasAssociatedTask :presentListTask .

:presentListTask a :Task ;
    dcterms:title "Present or Ask to Create Todo List" ;
    rdfs:comment "If a list exists, print it out per instructions (emoji, date, indexed titles, description, statuses, subtask boxes). If no list exists, ask the user what to add." ;
    :performedByAgent :todoAgent ;
    :requiresResource :todoMemory ;
    :requiresResource :gpt4oMini ;
    :taskPrompt :todoAgentInstructionPrompt .

:receiveUserInputStep a :WorkflowStep ;
    :stepOrder 3 ;
    rdfs:label "Receive user input / update list" ;
    :hasAssociatedTask :updateListTask .

:updateListTask a :Task ;
    dcterms:title "Update Todo List from User Input" ;
    rdfs:comment "Accepts user text, interprets actions (add, mark complete, edit), and updates the working memory structure accordingly." ;
    :performedByAgent :todoAgent ;
    :requiresResource :todoMemory ;
    :requiresResource :gpt4oMini ;
    :taskPrompt :todoAgentInstructionPrompt .

:askTimeboxStep a :WorkflowStep ;
    :stepOrder 4 ;
    rdfs:label "Ask timebox question" ;
    :hasAssociatedTask :timeboxTask .

:timeboxTask a :Task ;
    dcterms:title "Timebox Task / Ask Duration" ;
    rdfs:comment "For each todo item, the agent should ask the user how long it will take and record that as part of the todo entry." ;
    :performedByAgent :todoAgent ;
    :requiresResource :gpt4oMini ;
    :taskPrompt :todoAgentInstructionPrompt ;
    :contributesToObjective :timeboxingObjective .

:timeboxingObjective a :Objective ;
    dcterms:title "Timebox tasks objective" ;
    dcterms:description "Ensure tasks have an estimated duration to help with planning and prioritization." .

:saveMemoryStep a :WorkflowStep ;
    :stepOrder 5 ;
    rdfs:label "Persist working memory" ;
    :hasAssociatedTask :saveWorkingMemoryTask .

:saveWorkingMemoryTask a :Task ;
    dcterms:title "Save Working Memory" ;
    rdfs:comment "The agent must output the working memory in every response enclosed in <working_memory> tags and persist the list state." ;
    :taskPrompt :saveWorkingMemoryPrompt ;
    :performedByAgent :todoAgent ;
    :requiresResource :todoMemory ;
    :producedResource :workingMemoryInstance ;
    :contributesToObjective :persistenceObjective .

:persistenceObjective a :Objective ;
    dcterms:title "Ensure persistent todo list state" ;
    dcterms:description "Guarantee that the user's todo list state is saved every interaction, per agent instruction." .

:endStep a :EndStep ;
    :stepOrder 6 ;
    rdfs:label "End/loop back" ;
    rdfs:comment "End of the cycle; the workflow loops back to presenting the list for further interaction." .

################################################################################
# Produced/Stored working memory (resource instances with template)
################################################################################

:workingMemoryInstance a beam:Instance ;
    dcterms:title "Working memory instance (todo list content)" ;
    dcterms:description """The working memory representation that the agent is expected to produce and save in every response inside <working_memory> blocks. Initially seeded with the template below (exact string taken from source memory configuration):

# Todo List
## Active Items
- Example (Due: Feb 7 3028, Started: Feb 7 2025)
  - Description: This is an example task - replace with whatever the user needs

## Completed Items
- None yet
""" .

################################################################################
# Link tasks to objectives and capabilities (clarify semantic relationships)
################################################################################

:initFirstChatTask :contributesToObjective :persistenceObjective .
:initReturnChatTask :contributesToObjective :persistenceObjective .
:presentListTask :contributesToObjective :persistenceObjective .
:updateListTask :contributesToObjective :persistenceObjective .
:saveWorkingMemoryTask :requiresResource :workingMemoryInstance .

################################################################################
# Tool usage and relationships (agent uses the language model as a tool)
################################################################################

:todoAgent :hasToolConfig :todoLangModelConfig .
:todoLangModelConfig a :Config ;
    :configKey "model.name" ;
    :configValue "gpt-4o-mini" ;
    dcterms:description "Configuration reference to the LM used by the agent. Mirrors the model selection in source code (openai('gpt-4o-mini'))." .

################################################################################
# Miscellaneous: explicitly note streaming and masking concerns as descriptive annotations
################################################################################

:streaming_and_masking_notes a :Context ;
    dcterms:title "Streaming and mask notes" ;
    dcterms:description """The source code uses streaming for agent responses and applies a masking step to tag or capture working memory sections (maskStreamTags(..., 'working_memory')). This behavior is recorded here as descriptive context because ontology lacks streaming/callback constructs. The agent code also resumes stdin after streaming and presents an interactive loop for user input.""" .

################################################################################
# Provenance / source mapping (semantic metadata)
################################################################################

:sourceMapping a :Context ;
    dcterms:title "Source mapping" ;
    dcterms:description """This model encodes semantics extracted from:
- src/mastra/agents/index.ts (Agent configuration, instructions, memory)
- src/index.ts (session/thread logic, streaming, system prompts)
- src/mastra/index.ts (agent registration within the Mastra runtime)

Implementation-specific code and constructs (JS/TS, SDK calls) are intentionally excluded; only semantic elements (prompts, memory, model, tasks, workflow) are modelled here to enable reconstruction of agent behavior in another framework.""" .