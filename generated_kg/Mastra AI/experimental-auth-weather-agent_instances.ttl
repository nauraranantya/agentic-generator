# Execution time: 119.79 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - The ontology does not provide a native way to model rich JSON schemas or typed input/output schemas; these are represented as literal strings in Config individuals.
# - Streaming behavior (agent.stream and incremental text streaming) cannot be expressed directly; it is described in task descriptions and Prompt text literals.
# - Runtime / implementation details (environment variables, error handling, asynchronous execution flow, specific SDK calls) are intentionally omitted because the ontology does not model code-level constructs.
# - The code creates an Agent instance in two places (agents/index.ts and workflows/index.ts) with the same logical id. For fidelity the ontology models a single LLMAgent (same logical agent) and attaches both sets of instruction prompts: (1) the general assistant instructions and (2) the strict activity-planning system prompt used by the workflow.
# - Schema cannot express function/logic of helper functions like getWeatherCondition; the mapping from weather codes to descriptions is preserved as literal text in the relevant Prompt and Tool descriptions.
# - Authentication provider selection logic (getAuthProvider) is represented as a system Config literal; the ontology cannot model code switch/branch logic.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@base <http://www.w3id.org/agentic-ai/onto#> .

#################################################################
# Instances describing the Mastra weather agent solution
#################################################################

### Language model used by agents
:gpt4o-model a :LanguageModel ;
    rdfs:label "gpt-4o" ;
    dcterms:description "OpenAI model identifier used by the agent in code (openai('gpt-4o'))." ;
    <http://purl.org/dc/terms/reference> "openai:gpt-4o" .

### Capabilities
:http-fetch-capability a :Capability ;
    rdfs:label "HTTP fetch" ;
    dcterms:description "Capability to perform HTTP requests to external APIs (used by the weather tool)." .

:nlp-generation-capability a :Capability ;
    rdfs:label "Text generation (LLM, streaming)" ;
    dcterms:description "Capability to generate natural language text and stream responses from a language model." .

:get-weather-capability a :Capability ;
    rdfs:label "Get weather data" ;
    dcterms:description "Capability to retrieve, parse and normalize weather information for a given location." .

### External resources (APIs)
:open-meteo-geocoding-api a beam:Resource ;
    rdfs:label "open-meteo geocoding API" ;
    dcterms:description "Geocoding API used to resolve city name to latitude/longitude." ;
    <http://purl.org/dc/terms/reference> "https://geocoding-api.open-meteo.com/v1/search?name={name}&count=1" .

:open-meteo-weather-api a beam:Resource ;
    rdfs:label "open-meteo weather API" ;
    dcterms:description "Open-Meteo weather endpoint used to fetch current/forecast weather and hourly data." ;
    <http://purl.org/dc/terms/reference> "https://api.open-meteo.com/v1/forecast?latitude={lat}&longitude={lon}&current=...&hourly=..." .

### Tool: get-weather
:weather-tool a :Tool ;
    rdfs:label "get-weather" ;
    dcterms:description """
Get current weather for a location.

Behavior summary:
- Input: { location: string } (city name)
- Execution:
  1. Call geocoding API to resolve location -> latitude, longitude, name.
  2. Call weather API with latitude & longitude to get current and hourly weather.
  3. Map numeric weather_code to human-readable condition (mapping preserved in description).
  4. Return normalized object with keys: temperature, feelsLike, humidity, windSpeed, windGust, conditions, location.
- Errors: throws when location not found.
""" ;
    :hasToolConfig :weatherTool_inputSchema , :weatherTool_outputSchema ;
    :hasCapability :get-weather-capability ;
    :resourceUsage :open-meteo-geocoding-api , :open-meteo-weather-api .

:weatherTool_inputSchema a :Config ;
    :configKey "inputSchema" ;
    :configValue "{\"location\": \"string (city name)\"}" ;
    dcterms:description "Tool input schema serialized as JSON string." .

:weatherTool_outputSchema a :Config ;
    :configKey "outputSchema" ;
    :configValue "{\"temperature\": \"number\", \"feelsLike\": \"number\", \"humidity\": \"number\", \"windSpeed\": \"number\", \"windGust\": \"number\", \"conditions\": \"string\", \"location\": \"string\"}" ;
    dcterms:description "Tool output schema serialized as JSON string." .

### Resources produced/consumed within workflow
:weather-forecast-resource a beam:Resource ;
    rdfs:label "weather forecast" ;
    dcterms:description """
Forecast object produced by fetch-weather step with structure:
{
  date: ISO string,
  maxTemp: number,
  minTemp: number,
  condition: string,
  precipitationChance: number,
  location: string
}
This resource is the normalized forecast that is passed to the activity planning step.
""" .

:activities-text-resource a beam:Resource ;
    rdfs:label "planned activities (text)" ;
    dcterms:description """
A single string containing activity suggestions (may contain multiple day entries).
Format should follow the activity-planning system prompt (emoji and section headers) and includes: WEATHER SUMMARY, MORNING ACTIVITIES, AFTERNOON ACTIVITIES, INDOOR ALTERNATIVES, SPECIAL CONSIDERATIONS.
""" .

### Prompts

# General agent prompt (from src/mastra/agents/index.ts)
:weather-agent-instructions-general a :Prompt ;
    rdfs:label "Weather Agent - general instructions" ;
    :promptInstruction """
You are a helpful weather assistant that provides accurate weather information.

Your primary function is to help users get weather details for specific locations. When responding:
- Always ask for a location if none is provided
- If the location name isn't in English, please translate it
- If giving a location with multiple parts (e.g. "New York, NY"), use the most relevant part (e.g. "New York")
- Include relevant details like humidity, wind conditions, and precipitation
- Keep responses concise but informative

Use the weatherTool to fetch current weather data.
""" ;
    dcterms:description "System prompt / instructions attached to the agent for general conversational use." .

# Activity-planning system prompt (from workflows/index.ts agent 'instructions' string)
:weather-agent-instructions-planner a :Prompt ;
    rdfs:label "Weather Agent - planner system prompt" ;
    :promptInstruction """
You are a local activities and travel expert who excels at weather-based planning. Analyze the weather data and provide practical activity recommendations.

For each day in the forecast, structure your response exactly as follows:

ðŸ“… [Day, Month Date, Year]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸŒ¡ï¸ WEATHER SUMMARY
â€¢ Conditions: [brief description]
â€¢ Temperature: [XÂ°C/YÂ°F to AÂ°C/BÂ°F]
â€¢ Precipitation: [X% chance]

ðŸŒ… MORNING ACTIVITIES
Outdoor:
â€¢ [Activity Name] - [Brief description including specific location/route]
  Best timing: [specific time range]
  Note: [relevant weather consideration]

ðŸŒž AFTERNOON ACTIVITIES
Outdoor:
â€¢ [Activity Name] - [Brief description including specific location/route]
  Best timing: [specific time range]
  Note: [relevant weather consideration]

ðŸ  INDOOR ALTERNATIVES
â€¢ [Activity Name] - [Brief description including specific venue]
  Ideal for: [weather condition that would trigger this alternative]

âš ï¸ SPECIAL CONSIDERATIONS
â€¢ [Any relevant weather warnings, UV index, wind conditions, etc.]

Guidelines:
- Suggest 2-3 time-specific outdoor activities per day
- Include 1-2 indoor backup options
- For precipitation >50%, lead with indoor activities
- All activities must be specific to the location
- Include specific venues, trails, or locations
- Consider activity intensity based on temperature
- Keep descriptions concise but informative

Maintain this exact formatting for consistency, using the emoji and section headers as shown.
""" ;
    dcterms:description "Strict system-level instructions used by the planner agent to ensure output format and content constraints." .

# The user-level prompt template used in planActivities step
:planActivities_user_prompt a :Prompt ;
    rdfs:label "Plan activities - user prompt template" ;
    :promptInstruction """
Based on the following weather forecast for {location}, suggest appropriate activities:
{forecast_json}
""" ;
    :promptInputData "Template expects the forecast JSON object (fields: date, maxTemp, minTemp, precipitationChance, condition, location)." ;
    :promptOutputIndicator "A single string containing planned activities formatted according to the activity-planning system prompt (includes emoji and section headers)." ;
    dcterms:description "Runtime prompt template: at execution the forecast JSON is interpolated into this prompt and submitted to the planner agent." .

### LLMAgent (single logical agent used across code)
:weather-agent a :LLMAgent ;
    rdfs:label "Weather Agent" ;
    <http://purl.org/dc/terms/title> "Weather Agent" ;
    :agentID "weather-agent" ;
    :agentRole "Weather Assistant" ;
    :agentPrompt :weather-agent-instructions-general , :weather-agent-instructions-planner ;
    :hasAgentConfig :weather-agent-config ;
    :agentToolUsage :weather-tool ;
    :useLanguageModel :gpt4o-model ;
    dcterms:description "Agent responsible for both direct weather conversational assistance and for generating activity recommendations based on forecast data." .

:weather-agent-config a :Config ;
    :configKey "model" ;
    :configValue "gpt-4o" ;
    dcterms:description "Agent-level configuration storing the target LLM identifier." .

### Workflow (Plan) and its steps
:weather-workflow a :WorkflowPattern ;
    rdfs:label "weather-workflow" ;
    dcterms:description "Workflow that (1) fetches weather for a city and (2) generates activity recommendations based on the forecast." ;
    :hasWorkflowStep :fetch-weather-step , :plan-activities-step ;
    :hasAgentMember :weather-agent ;
    :hasWorkflowStep :fetch-weather-step, :plan-activities-step ;
    :hasConfig :weather-workflow_inputSchema, :weather-workflow_outputSchema .

:weather-workflow_inputSchema a :Config ;
    :configKey "inputSchema" ;
    :configValue "{\"city\": \"string (the city to get the weather for)\"}" ;
    dcterms:description "Workflow input expects a single property 'city' (string)." .

:weather-workflow_outputSchema a :Config ;
    :configKey "outputSchema" ;
    :configValue "{\"activities\": \"string (generated activities text)\"}" ;
    dcterms:description "Workflow output is a string containing the generated activities text." .

# Steps as WorkflowStep instances with associated Task
:fetch-weather-step a :StartStep ;
    rdfs:label "fetch-weather step" ;
    :stepOrder 1 ;
    :hasAssociatedTask :fetch-weather-task ;
    dcterms:description "Start step: resolves city -> coordinates, fetches weather and computes forecast object." .

:plan-activities-step a :EndStep ;
    rdfs:label "plan-activities step" ;
    :stepOrder 2 ;
    :hasAssociatedTask :plan-activities-task ;
    dcterms:description "End step: uses forecast to produce activity planning text following a strict format." .

### Tasks and relationships to tools/agents/resources

# Task: fetch-weather
:fetch-weather-task a :Task ;
    rdfs:label "fetch-weather" ;
    dcterms:description """
Fetches weather forecast for a given city.

Implementation summary preserved semantically:
- Input: { city: string }
- Process:
  * Call geocoding API to get latitude, longitude, canonical name.
  * Call weather API with current & hourly parameters.
  * Compute forecast object:
    { date: now, maxTemp: max(hourly.temperature_2m), minTemp: min(hourly.temperature_2m),
      condition: map(weathercode), precipitationChance: max(hourly.precipitation_probability), location: <city name> }
- Output: forecast object (see weather-forecast resource).
""" ;
    :performedBy :weather-tool ;
    :producedResource :weather-forecast-resource ;
    :requiresResource :open-meteo-geocoding-api , :open-meteo-weather-api ;
    :requiresCapability :http-fetch-capability ;
    dcterms:description "Semantic description of the data flows and outputs. Exceptions (e.g., location not found) are part of runtime behavior." .

# Task: plan-activities
:plan-activities-task a :Task ;
    rdfs:label "plan-activities" ;
    dcterms:description """
Suggests activities based on the normalized weather forecast.

Semantic summary:
- Input: forecast object (weather-forecast-resource)
- Behavior:
  * Construct a user prompt by interpolating the forecast JSON into a template prompt (planActivities_user_prompt).
  * Submit prompts to the planner agent which has a strict system prompt (weather-agent-instructions-planner).
  * Receive a streamed text response and aggregate into a single activities string.
- Output: activities-text-resource (string).
Constraints:
- Output must follow the planner system prompt format (emoji sections, headers, specific fields).
""" ;
    :performedByAgent :weather-agent ;
    :taskPrompt :planActivities_user_prompt ;
    :requiresResource :weather-forecast-resource ;
    :producedResource :activities-text-resource ;
    :requiresCapability :nlp-generation-capability .

### Agent / Team / System configuration (server auth)
:mastra-system a :Team ;
    rdfs:label "Mastra server/system" ;
    dcterms:description "Represents the hosting Mastra system configuration for this agent/workflow deployment." ;
    :hasAgentMember :weather-agent ;
    :hasSystemConfig :mastra-auth-config .

:mastra-auth-config a :Config ;
    :configKey "authProviders" ;
    :configValue "supported: auth0, firebase, supabase, workos, clerk, jwt; selection based on environment variable AUTH_PROVIDER (default: jwt)" ;
    dcterms:description "Semantic description of the configured auth providers and selection logic derived from getAuthProvider() in code. Stored as configuration literal rather than code." .

#################################################################
# Additional mapping and annotations
#################################################################

# Relationship: agent uses tool (explicit)
:weather-agent :agentToolUsage :weather-tool .

# Tool accesses external resources (already linked via resourceUsage)
:weather-tool :resourceUsage :open-meteo-geocoding-api , :open-meteo-weather-api .

# Task relationships already set: steps -> tasks, tasks -> resources/tools/agents

# Mapping of weather code mapping (preserved for fidelity inside a prompt/tool description)
:weather-code-mapping a :KnowledgeBase ;
    rdfs:label "weather code to condition mapping" ;
    dcterms:description """
Mapping of numeric weather_code to human-readable conditions used by the weather tool and preserved in prompt/tool descriptions:
0: Clear sky
1: Mainly clear
2: Partly cloudy
3: Overcast
45: Foggy
48: Depositing rime fog
51: Light drizzle
53: Moderate drizzle
55: Dense drizzle
56: Light freezing drizzle
57: Dense freezing drizzle
61: Slight rain
63: Moderate rain
65: Heavy rain
66: Light freezing rain
67: Heavy freezing rain
71: Slight snow fall
73: Moderate snow fall
75: Heavy snow fall
77: Snow grains
80: Slight rain showers
81: Moderate rain showers
82: Violent rain showers
85: Slight snow showers
86: Heavy snow showers
95: Thunderstorm
96: Thunderstorm with slight hail
99: Thunderstorm with heavy hail
""" ;
    :containsResource :open-meteo-weather-api .

# Link forecast resource to the knowledge mapping used to interpret codes (informational)
:weather-forecast-resource :hasKnowledge :weather-code-mapping .

# Note: produced resources are semantically linked to tasks above
# End of instance data.