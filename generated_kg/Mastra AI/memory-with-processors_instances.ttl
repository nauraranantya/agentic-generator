# Execution time: 90.02 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - The ontology does not define a class for "MemoryProcessor" or specialized processor types (TokenLimiter, ToolCallFilter, ForgetfulProcessor). These are represented here as Config individuals attached to Memory instances (using hasConfig) with descriptive configValue literals capturing their logic and parameters.
# - The ontology lacks properties and classes to explicitly model execution code, callbacks, or functions (e.g., the "execute" implementation of tools or JS logic). Execution behavior is preserved as descriptive literals on Config or Prompt individuals (configValue / promptInstruction).
# - There is no explicit class/property for "Agent orchestration instance" (Mastra) or runtime thread/session. A Team (beam:System subclass) individual is used to represent the orchestrator and contains agent membership and a system config.
# - There are no classes for "Memory options" or "processor parameters" beyond Config; those options (lastMessages, semanticRecall, token limits) are encoded as Config individuals using configKey/configValue.
# - Low-level SDK and language-specific constructs (imports, types, event handlers, console usage) are not modeled; only the semantic meaning (agents, tools, memory behavior, prompts, models, and workflows) is represented.
# - No new ontology classes or properties were added; only existing ontology terms were used.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix rdfs: <http://www.w3id.org/agentic-ai/onto#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .

################################################################################
# Orchestrator / System
################################################################################

:mastra_system rdf:type :Team ;
    rdfs:label "Mastra Orchestrator" ;
    dct:description "Logical orchestration/system instance that groups and manages the agent instances defined in the project." ;
    :hasAgentMember :token_test_agent , :technical_support_demo_agent , :forgetful_job_interviewer_demo , :support_agent_repo_interviewer ;

# System-level configuration summarizing the Mastra instantiation and included agents
:mastra_system_config rdf:type :Config ;
    :configKey "mastra_agents" ;
    :configValue "token-test-agent, technical-support (demo), forgetful-job-interviewer, supportAgent (repo)" .
:mastra_system :hasSystemConfig :mastra_system_config .

################################################################################
# Language Models (statistical models used by agents)
################################################################################

:gpt_4o rdf:type :LanguageModel ;
    rdfs:label "gpt-4o" ;
    dct:description "Model identifier used by some agents (openai('gpt-4o'))." .

:gpt_4o_mini rdf:type :LanguageModel ;
    rdfs:label "gpt-4o-mini" ;
    dct:description "Model identifier used by some agents (openai('gpt-4o-mini'))." .

################################################################################
# Tools (Tool instances and their metadata)
################################################################################

:read_file_tool rdf:type :Tool ;
    rdfs:label "read-file" ;
    dct:description "Read a large file to test token limits; attempts several file system locations and otherwise generates a large mock file, returning a truncated 20K-character string." ;
    :hasToolConfig :read_file_tool_execute_config ;
    :resourceUsage :large_file_resource .

:read_file_tool_execute_config rdf:type :Config ;
    :configKey "execute" ;
    :configValue """Implementation semantics (preserved as descriptive text):
- Try multiple possible paths to locate a pnpm-lock.yaml file (project root fallback).
- If found, read content and return first 20K characters as a string.
- If not found, generate a mock YAML-like file ~20K characters composed of repeated package entries.
- In case of read error, return an error message plus generated mock content.
- Purpose: produce extremely large tool responses to demonstrate TokenLimiter behavior and token trimming in memory.
""" .

:search_tool rdf:type :Tool ;
    rdfs:label "web-search" ;
    dct:description "Search the web for information. Input schema expects a 'query' string." ;
    :hasToolConfig :search_tool_schema_config , :search_tool_execute_simulation ;
    :resourceUsage :web_search_results .

:search_tool_schema_config rdf:type :Config ;
    :configKey "inputSchema" ;
    :configValue "{ query: string } (zod schema description)" .

:search_tool_execute_simulation rdf:type :Config ;
    :configKey "execute" ;
    :configValue """Implementation semantics (preserved as descriptive text):
- Given input.query, returns a text block listing simulated search results e.g.:
  Search results for "QUERY":
    1. Top result with important information
    2. Secondary information related to the query
    3. Additional context that might be helpful
- In utils.ts variant, the tool returns a fixed string: 'Not much found unfortunately. You'll probably have to turn it off an on again.'
""" .

:large_file_resource rdf:type beam:Resource ;
    dct:title "Large file content (tool output)" ;
    dct:description "Represents the large textual content that the read-file tool returns (truncated to 20K chars or generated mock content)." .

:web_search_results rdf:type beam:Resource ;
    dct:title "Web search results (tool output)" ;
    dct:description "Represents textual results returned by web-search tool (simulated search output)." .

################################################################################
# Memory and Processor Configurations (modeled as Configs attached to Memory)
################################################################################

# Memory for token-test agent (processor-example.ts uses TokenLimiter(1000) and lastMessages=50)
:token_test_memory rdf:type :Memory ;
    rdfs:label "Token Test Memory" ;
    dct:description "Memory with TokenLimiter to demonstrate pruning of large tool responses." ;
    :hasConfig :token_test_memory_token_limiter , :token_test_memory_option_lastMessages .

:token_test_memory_token_limiter rdf:type :Config ;
    :configKey "TokenLimiter" ;
    :configValue "1000" ;
    dct:description "Limits memory to approximately 1000 tokens by pruning older messages; used to demonstrate token limiting with large tool outputs." .

:token_test_memory_option_lastMessages rdf:type :Config ;
    :configKey "lastMessages" ;
    :configValue "50" ;
    dct:description "Memory option: keep up to 50 last messages (approx.) for context preservation." .

# Memory for technical-support demo (support-agent.ts uses TokenLimiter(500) in demo)
:tech_support_memory_demo rdf:type :Memory ;
    rdfs:label "Technical Support Demo Memory" ;
    :hasConfig :tech_support_memory_token_limiter_500 , :tech_support_memory_options_demo .

:tech_support_memory_token_limiter_500 rdf:type :Config ;
    :configKey "TokenLimiter" ;
    :configValue "500" ;
    dct:description "Demonstration TokenLimiter set to 500 tokens to force more aggressive pruning." .

:tech_support_memory_options_demo rdf:type :Config ;
    :configKey "options" ;
    :configValue "lastMessages=50; semanticRecall=true" ;
    dct:description "Memory options used in demo: keep last messages and enable semanticRecall." .

# Memory used in repository agent (mastra/agents supportAgent uses TokenLimiter(2000))
:support_agent_memory_repo rdf:type :Memory ;
    rdfs:label "Support Agent Repository Memory" ;
    :hasConfig :support_agent_memory_token_limiter_2000 , :support_agent_memory_options_repo .

:support_agent_memory_token_limiter_2000 rdf:type :Config ;
    :configKey "TokenLimiter" ;
    :configValue "2000" ;
    dct:description "Repository example TokenLimiter configured to approximately 2000 tokens." .

:support_agent_memory_options_repo rdf:type :Config ;
    :configKey "options" ;
    :configValue "lastMessages=50; semanticRecall=false" ;
    dct:description "Memory options used in repository support agent (no semanticRecall)." .

# Interviewer memory processors: ToolCallFilter and ForgetfulProcessor
:interview_memory_repo rdf:type :Memory ;
    rdfs:label "Interviewer Memory (repo)" ;
    :hasConfig :tool_call_filter_config_repo , :forgetful_processor_config_repo , :interview_memory_options_repo .

:tool_call_filter_config_repo rdf:type :Config ;
    :configKey "ToolCallFilter" ;
    :configValue "filters out all tool calls from stored memory (removes tool-call events from conversation history)" ;
    dct:description "Used to keep conversation history focused (tool calls excluded)." .

:forgetful_processor_config_repo rdf:type :Config ;
    :configKey "ForgetfulProcessor" ;
    :configValue """keywords = ['name']
Processor behavior (preserved as descriptive text):
- For messages with role 'assistant' or 'user', inspect content.
- If the content contains any of the keywords (case-insensitive), replace the message with a single assistant message containing <forgotten> wrapper text indicating forgetting.
- Purpose: demo a processor that purposely forgets specific sensitive keywords (e.g., 'name').
""" .

:interview_memory_options_repo rdf:type :Config ;
    :configKey "options" ;
    :configValue "lastMessages=30; semanticRecall=false" .

# Memory used in interactive forgetful-interviewer.ts (custom forgetful only)
:forgetful_demo_memory rdf:type :Memory ;
    rdfs:label "Forgetful Interviewer Demo Memory" ;
    :hasConfig :forgetful_processor_config_demo , :forgetful_demo_memory_options .

:forgetful_processor_config_demo rdf:type :Config ;
    :configKey "ForgetfulProcessor" ;
    :configValue """keywords = ['name']
Processor behavior (preserved as descriptive text):
- Same behavior as repo variant but used for the interactive demo.
- When a message contains any keyword, it is replaced with an assistant message: '<forgotten>I'm getting forgetful ...</forgotten>'.
""" .

:forgetful_demo_memory_options rdf:type :Config ;
    :configKey "options" ;
    :configValue "lastMessages=30; semanticRecall=false" .

################################################################################
# Agents (LLMAgent individuals and their prompts, configs, models, and tools)
################################################################################

# Token test agent (processor-example.ts)
:token_test_agent rdf:type :LLMAgent ;
    rdfs:label "Token Test Agent" ;
    :agentID "token-test-agent" ;
    dct:description "Agent used to test the TokenLimiter processor by calling a tool that returns very large outputs." ;
    :agentPrompt :token_test_agent_instructions_prompt ;
    :useLanguageModel :gpt_4o_mini ;
    :hasKnowledge :token_test_memory ;
    :agentToolUsage :read_file_tool .

:token_test_agent_instructions_prompt rdf:type :Prompt ;
    rdfs:label "Token Test Agent Instructions" ;
    :promptInstruction "You help test token limiting by calling tools that return large amounts of data." ;
    :promptContext "Used as agent instructions to guide agent behavior in the Token Limiter demonstration." .

# Technical support (demo) agent (src/support-agent.ts demonstration)
:technical_support_demo_agent rdf:type :LLMAgent ;
    rdfs:label "Technical Support (demo)" ;
    :agentID "technical-support" ;
    dct:description "Technical Support agent used in demo with TokenLimiter(500) and web-search tool." ;
    :agentPrompt :technical_support_demo_instructions ;
    :useLanguageModel :gpt_4o_mini ;
    :hasKnowledge :tech_support_memory_demo ;
    :agentToolUsage :search_tool ;
    :hasAgentConfig :technical_support_demo_agent_config .

:technical_support_demo_instructions rdf:type :Prompt ;
    rdfs:label "Technical Support Instructions (demo)" ;
    :promptInstruction "You are a technical support agent who helps users solve software problems. You provide concise, short, instructions and ask clarifying questions when needed. You remember details from earlier in the conversation. Your goal is to efficiently resolve user issues. Make sure you provide concise responses without tons of text" ;
    :promptContext "Agent system instructions controlling behavior and style (support-agent.ts)." .

:technical_support_demo_agent_config rdf:type :Config ;
    :configKey "demo_token_history_tracking" ;
    :configValue "Tracks total token usage across a run (console output). threadId and resourceId used per call: threadId='token-test-thread' resourceId='demo-user' in demo." .

# Support agent from repository (mastra/agents)
:support_agent_repo_interviewer rdf:type :LLMAgent ;
    rdfs:label "Support Agent (repo example)" ;
    :agentID "technical-support-repo" ;
    dct:description "Repository example of a support agent with TokenLimiter(2000) and web-search tool." ;
    :agentPrompt :support_agent_repo_instructions ;
    :useLanguageModel :gpt_4o_mini ;
    :hasKnowledge :support_agent_memory_repo ;
    :agentToolUsage :search_tool .

:support_agent_repo_instructions rdf:type :Prompt ;
    rdfs:label "Support Agent Repo Instructions" ;
    :promptInstruction "You are a technical support agent who helps users solve software problems. You provide clear, step-by-step instructions and ask clarifying questions when needed. You remember details from earlier in the conversation. Your goal is to efficiently resolve user issues." .

# Forgetful job interviewer (interactive demo)
:forgetful_job_interviewer_demo rdf:type :LLMAgent ;
    rdfs:label "Forgetful Job Interviewer (interactive demo)" ;
    :agentID "forgetful-job-interviewer" ;
    dct:description "An interviewer agent that occasionally forgets specified keywords (e.g., user 'name') via a custom ForgetfulProcessor attached to memory." ;
    :agentPrompt :forgetful_job_interviewer_instructions ;
    :useLanguageModel :gpt_4o ;
    :hasKnowledge :forgetful_demo_memory ;
    :hasAgentConfig :forgetful_job_interviewer_demo_config .

:forgetful_job_interviewer_instructions rdf:type :Prompt ;
    rdfs:label "Forgetful Interviewer Instructions (interactive demo)" ;
    :promptInstruction """You are a professional job interviewer for a technology company. Conduct insightful interviews by asking relevant questions about skills, experience, and problem-solving abilities. Respond to candidate answers and ask follow-up questions. Keep the interview professional and engaging. Remember details the candidate shares earlier in the conversation. Sometimes you forget things by accident. The system will show you if you forgot. Don't be embarrassed, you can admit when you forget something, you'll know when you do because there will be a message wrapped in <forgetten> tags. Don't refer to the user by their name, it comes across as too eager""" ;
    :promptContext "System instructions used during the interactive interviewer demo." .

:forgetful_job_interviewer_demo_config rdf:type :Config ;
    :configKey "interactive_mode" ;
    :configValue "Uses stdin/stdout loop; 'exit' or 'quit' to stop; initial system message: 'Interview starting now. Ask the candidate to introduce themselves and their background.'" .

# Interviewer agent from repository (mastra/agents index) - includes ToolCallFilter + ForgetfulProcessor
:interviewer_agent_repo rdf:type :LLMAgent ;
    rdfs:label "Forgetful Job Interviewer (repo)" ;
    :agentID "forgetful-job-interviewer-repo" ;
    dct:description "Repository interviewer agent example which filters out tool calls and uses a ForgetfulProcessor (keywords=['name'])." ;
    :agentPrompt :interviewer_agent_repo_instructions ;
    :useLanguageModel :gpt_4o ;
    :hasKnowledge :interview_memory_repo ;
    :hasAgentConfig :interviewer_agent_repo_config .

:interviewer_agent_repo_instructions rdf:type :Prompt ;
    rdfs:label "Interviewer Agent Repo Instructions" ;
    :promptInstruction """You are a professional job interviewer for a technology company. Conduct insightful interviews by asking relevant questions about skills, experience, and problem-solving abilities. Respond to candidate answers and ask follow-up questions. Keep the interview professional and engaging. Remember details the candidate shares earlier in the conversation. Sometimes you forget things by accident. The system will show you if you forgot. Don't be embarrassed, you can admit when you forget something, you'll know when you do because there will be a message wrapped in <forgetten> tags. Don't refer to the user by their name, it comes across as too eager""" ;
    :promptContext "System instructions used in repository example (mastra/agents)." .

:interviewer_agent_repo_config rdf:type :Config ;
    :configKey "repo_agent_notes" ;
    :configValue "This agent's memory uses ToolCallFilter to remove tool-call events from history and a ForgetfulProcessor to redact messages containing keywords like 'name'." .

################################################################################
# Tasks and Workflow Patterns (high-level behavior flows captured as Tasks/Prompts)
################################################################################

# Token Limiter demo task (processor-example.ts)
:task_token_limiter_demo rdf:type :Task ;
    rdfs:label "TokenLimiter Processor Demo Task" ;
    dct:description "Demonstrate TokenLimiter by having agent call read-file tool to produce a large response, then query the agent to show forgetting/pruning behavior." ;
    :taskPrompt :task_token_limiter_demo_prompts ;
    :requiresResource :large_file_resource ;
    :producedResource :large_file_resource ;
    :contributesToObjective :goal_demo_token_limiter .

:task_token_limiter_demo_prompts rdf:type :Prompt ;
    rdfs:label "Token Limiter Demo Prompts (sequence)" ;
    :promptInstruction """Sequence of user messages used in demo:
1. 'Hello! I'd like to test the token limiting functionality.'
2. 'Please use the read-file tool to read the large file. After you do, I'll ask you to summarize what you found.'
3. 'Now, can you tell me what was in the file you just read? And do you remember what I asked in my first message?'
4. 'Let's see how the token limiter is working. Do you remember the exact contents at the beginning of the file?'
""" ;
    :promptContext "Used to exercise token limiting and demonstrate memory pruning of large tool results." .

:goal_demo_token_limiter rdf:type :Goal ;
    rdfs:label "Demonstrate TokenLimiter Behavior" ;
    dct:description "Goal to illustrate that TokenLimiter ensures conversation memory stays within token limits while preserving recent context." .

# Forgetful interviewer demo task
:task_forgetful_interviewer_demo rdf:type :Task ;
    rdfs:label "Forgetful Interviewer Demo Task" ;
    dct:description "Interactive interviewer scenario where the agent may forget information that contains configured keywords (e.g., 'name')." ;
    :taskPrompt :task_forgetful_prompts ;
    :contributesToObjective :goal_demo_forgetting .

:task_forgetful_prompts rdf:type :Prompt ;
    rdfs:label "Forgetful Interviewer Prompts" ;
    :promptInstruction "Initial system message: 'Interview starting now. Ask the candidate to introduce themselves and their background.' Followed by interactive user replies; agent processes messages and may replace messages containing 'name' with <forgotten> wrapper." .

:goal_demo_forgetting rdf:type :Goal ;
    rdfs:label "Demonstrate Memory Processor-based Forgetting" ;
    dct:description "Goal to show custom memory processors can filter or redact content based on keywords or types (e.g., tool calls)." .

# Technical support demo task (support-agent.ts)
:task_technical_support_demo rdf:type :Task ;
    rdfs:label "Technical Support Demo Task" ;
    dct:description "Support dialogue where user describes laptop overheating and agent uses web-search tool; memory TokenLimiter demonstrates retention/pruning." ;
    :taskPrompt :task_technical_support_prompts ;
    :contributesToObjective :goal_demo_support_agent ;
    :requiresResource :web_search_results .

:task_technical_support_prompts rdf:type :Prompt ;
    rdfs:label "Technical Support Demo Prompts (sequence)" ;
    :promptInstruction """Sequence of user messages used in support demo:
1. 'I'm having trouble with my laptop. It keeps shutting down randomly after about 30 minutes of use...'
2. 'Can you search for common causes of laptop overheating?'
3. 'Can you search again?'
4. Additional context: Dell XPS 15, Windows 11, many tabs, Visual Studio Code, CPU reaches 90Â°C before shutdown, etc.
5. Follow-ups: cleaning fans, thermal paste, limiting CPU usage, cooling pad, reminder of first suggestion.
""" ;
    :promptContext "Used by the Technical Support agent demo to elicit tool calls and memory behavior." .

:goal_demo_support_agent rdf:type :Goal ;
    rdfs:label "Demonstrate Support Agent with TokenLimiter" ;
    dct:description "Goal to validate that the support agent can use tools, recall recent context, and that TokenLimiter prunes older content when exceeding token limits." .

################################################################################
# Relationships: which agents use which tools, knowledge, and prompts
################################################################################

# Explicitly link tools to the agents that use them (tool usage)
:token_test_agent :agentToolUsage :read_file_tool .
:technical_support_demo_agent :agentToolUsage :search_tool .
:support_agent_repo_interviewer :agentToolUsage :search_tool .
:interviewer_agent_repo :agentToolUsage :search_tool .

# Agents' knowledge bases (memories) already linked via :hasKnowledge above; add human-readable descriptions
:token_test_memory dct:description "Memory configured to demonstrate TokenLimiter(1000) and track total token usage for the demo run." .
:tech_support_memory_demo dct:description "Memory configured with TokenLimiter(500) and semanticRecall=true for support demo." .
:support_agent_memory_repo dct:description "Memory configured with TokenLimiter(2000) for repository support agent example." .
:interview_memory_repo dct:description "Memory configured to filter tool calls and forget keywords (repo example)." .
:forgetful_demo_memory dct:description "Memory configured with a custom ForgetfulProcessor to redact messages containing keywords like 'name'." .

################################################################################
# Additional metadata/captures of runtime parameters and conventions
################################################################################

:runtime_convention_threadid rdf:type :Config ;
    :configKey "threadId_convention" ;
    :configValue "Examples use random UUID per send in utils.makeSend or explicit threadId values like 'token-test-thread'." ;
    dct:description "Describes threadId usage pattern in examples." .

:runtime_convention_resourceid rdf:type :Config ;
    :configKey "resourceId_convention" ;
    :configValue "Examples use resourceId like 'DEMO_USER_1' or 'demo-user' to represent an external user resource." ;
    dct:description "Describes resourceId usage pattern for tool/agent calls." .

################################################################################
# End of individuals
################################################################################

# Note: This instance graph intentionally preserves instructions, prompts, tool behaviors,
# memory processor semantics, and token-limit values as literals on Prompt and Config individuals
# so that another system or LLM can reconstruct agent behaviors and test scenarios.