# Execution time: 101.96 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - The ontology does not have a property to represent runtime identifiers such as "threadId" or "resourceId" as first-class typed fields. These are recorded as configuration key/value pairs (Config instances) to preserve the information.
# - Streaming behaviors (e.g., maskStreamTags, streaming tokens, or spinner UI behavior) and SDK/framework specifics (ora, Readline, randomUUID, @mastra/core APIs) cannot be represented by the current schema. They are described as Task descriptions or Constraints where appropriate.
# - There is no explicit property to represent "agent name" except general metadata properties; dcterms:title is used to capture the agent's declared name.
# - The ontology lacks a structured key->value pair object type for configs (only Config class with configKey/configValue properties). To preserve each configuration entry unambiguously, each key/value was represented as a distinct Config individual.
# - The conditional logic (isFirstChat check via memory.getThreadById) and dynamic templating (timestamp insertion) are represented as a Constraint individual describing the behavior, because control-flow constructs are not modeled in the ontology.
# - Runtime-generated sample values (e.g., example threadId) are recorded as example config values; they are not meant to imply the ontology supports runtime generation semantics.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@base <http://www.w3id.org/agentic-ai/onto#> .

################################################################################
# Individuals describing the agent-based solution (Memory Agent / Mastra)
################################################################################

# Language model used by the agent
:lm_gpt4o_mini a :LanguageModel ;
    dcterms:title "gpt-4o-mini" ;
    <http://purl.org/dc/terms/description> "OpenAI model identifier used in the agent configuration (openai('gpt-4o-mini'))." .

# Knowledge base: Memory instance with its configuration items
:memory_kb a :Memory ;
    dcterms:title "Memory component (Memory instance for Memory Agent)" ;
    <http://purl.org/dc/terms/description> "Memory configured with lastMessages, semanticRecall and workingMemory options as in source code." ;
    :hasConfig :cfg_lastMessages,
                :cfg_semantic_topK,
                :cfg_semantic_messageRange,
                :cfg_workingMemory_enabled .

# Each config entry for the Memory is represented as an individual Config (preserves key/value)
:cfg_lastMessages a :Config ;
    :configKey "lastMessages" ;
    :configValue "4" .

:cfg_semantic_topK a :Config ;
    :configKey "semanticRecall.topK" ;
    :configValue "1" .

:cfg_semantic_messageRange a :Config ;
    :configKey "semanticRecall.messageRange" ;
    :configValue "0" .

:cfg_workingMemory_enabled a :Config ;
    :configKey "workingMemory.enabled" ;
    :configValue "true" .

# Agent instance (LLM Agent)
:memoryAgent a :LLMAgent ;
    :agentID "memory-agent" ;
    dcterms:title "Memory Agent" ;
    <http://purl.org/dc/terms/description> "An LLM-based agent constructed with a Memory component and configured model; corresponds to the 'memoryAgent' defined in source code." ;
    :useLanguageModel :lm_gpt4o_mini ;
    :hasKnowledge :memory_kb ;
    :hasAgentConfig :cfg_agent_memory_integration ;
    :agentPrompt :prompt_instructions ;
    :agentRole "assistant" .

# Agent <-> Memory integration config recorded as an agent-specific Config
:cfg_agent_memory_integration a :Config ;
    :configKey "memoryComponent" ;
    :configValue "memory_kb (Memory instance attached to agent)" .

# Prompt that encodes the Agent "instructions" parameter from the agent constructor
:prompt_instructions a :Prompt ;
    :promptInstruction "You are a helpful AI agent, looking to assist however you can." ;
    :promptContext "This prompt is supplied as the 'instructions' argument when creating the Agent instance in source code." ;
    <http://purl.org/dc/terms/description> "Agent-level instruction prompt configured at agent construction (Agent.instructions)." .

# The run-time chat task that captures the interactive loop between a user and the agent
:task_interactive_chat a :Task ;
    dcterms:title "Interactive chat session task" ;
    <http://purl.org/dc/terms/description> "Represents the continuous interactive chat loop. Behavior: on start, an initial system message is sent (template varies depending on whether isFirstChat is true). Then user messages are read and the agent produces streaming responses. The agent uses memory.getThreadById to detect returning users and modifies the initial system prompt accordingly." ;
    :hasPrompt :prompt_system_firstChat, :prompt_system_returningChat ;
    :performedByAgent :memoryAgent ;
    :requiresResource :resource_user_instance ;
    :producedResource :resource_chat_stream_output .

# Resource that represents the user identifier used as resourceId in the code
:resource_user_instance a beam:Instance ;
    dcterms:title "SOME_USER_ID" ;
    <http://purl.org/dc/terms/description> "Represents the external user resource identifier passed as resourceId to the agent.stream calls in the code (literal in source: 'SOME_USER_ID')." .

# Resource representing the text stream produced by the agent during the session
:resource_chat_stream_output a beam:Instance ;
    dcterms:title "agent_response_stream" ;
    <http://purl.org/dc/terms/description> "A textual stream produced by the agent.stream operation; in implementation this is masked/filtered for 'think' and 'working_memory' tags and presented to the console." .

# System prompts used for session start (two templates from source code)
:prompt_system_firstChat a :Prompt ;
    :promptInstruction "Chat with user started now {{ISO_TIMESTAMP}}." ;
    :promptContext "Used as the system message when isFirstChat is true. The code inserts the current Date().toISOString() in place of {{ISO_TIMESTAMP}}." ;
    <http://purl.org/dc/terms/description> "Template for the initial system message for a new chat session." ;
    :promptOutputIndicator "Do not reveal the system-internal timestamp insertion." .

:prompt_system_returningChat a :Prompt ;
    :promptInstruction "Chat with user started now {{ISO_TIMESTAMP}}. Don't mention this message. This means some time has passed between this message and the one before. The user left and came back again. Say something to start the conversation up again." ;
    :promptContext "Used as the system message when isFirstChat is false (returning user). The code inserts the current Date().toISOString() in place of {{ISO_TIMESTAMP}}." ;
    <http://purl.org/dc/terms/description> "Template for re-engaging an existing session; includes instruction not to reveal the system note about elapsed time." .

# Constraint capturing the isFirstChat logic (memory lookup)
:constraint_isFirstChatCheck a :Constraint ;
    dcterms:title "isFirstChat check via memory.getThreadById" ;
    <http://purl.org/dc/terms/description> "Behavioral rule: The program calls memory.getThreadById({ threadId }) and sets isFirstChat to true when no thread exists (Boolean(...) === false). This affects which system prompt template is used (prompt_system_firstChat vs prompt_system_returningChat)." ;
    rdfs:comment "This is a logical/behavioral constraint stored in the KnowledgeBase (Constraint subclass) because control-flow cannot be modeled directly in the ontology." .

# Workflow pattern representing the chat interaction loop (high-level)
:workflow_chat_pattern a :WorkflowPattern ;
    dcterms:title "Chat interactive workflow pattern" ;
    <http://purl.org/dc/terms/description> "A workflow pattern that models the interactive chat loop: Start -> Receive user input -> Agent generate streaming response -> Repeat -> End" ;
    :hasWorkflowStep :ws_start_chat, :ws_receive_user_input, :ws_agent_generate_response, :ws_end_chat .

:ws_start_chat a :StartStep ;
    :stepOrder 1 ;
    rdfs:label "Start Chat" ;
    :hasAssociatedTask :task_initial_system_message ;
    :nextStep :ws_receive_user_input .

:task_initial_system_message a :Task ;
    dcterms:title "Send initial system prompt" ;
    <http://purl.org/dc/terms/description> "On session start the program sends a system-role message; uses prompt_system_firstChat if isFirstChat, otherwise prompt_system_returningChat. The timestamp is inserted at runtime." ;
    :performedByAgent :memoryAgent ;
    :hasPrompt :prompt_system_firstChat, :prompt_system_returningChat .

:ws_receive_user_input a :WorkflowStep ;
    :stepOrder 2 ;
    rdfs:label "Receive user input" ;
    :hasAssociatedTask :task_receive_user_input ;
    :nextStep :ws_agent_generate_response .

:task_receive_user_input a :Task ;
    dcterms:title "Read user message" ;
    <http://purl.org/dc/terms/description> "A blocking read from a human input channel; in code this is achieved by Readline and awaiting user's input, then the input is forwarded to the agent.stream call." ;
    :requiresResource :resource_user_instance ;
    :performedByAgent :memoryAgent .

:ws_agent_generate_response a :WorkflowStep ;
    :stepOrder 3 ;
    rdfs:label "Agent generates streaming response" ;
    :hasAssociatedTask :task_agent_stream_response ;
    :nextStep :ws_receive_user_input .

:task_agent_stream_response a :Task ;
    dcterms:title "Agent.stream producing masked output" ;
    <http://purl.org/dc/terms/description> "Agent processes the user's message, streams text output. During streaming the implementation masks two tag sections: 'think' (internal chain-of-thought-like output) and 'working_memory' (memory saving operations). Spinners (status indicators) are displayed while sections stream; upon end spinners succeed and input reading resumes. The stream also interacts with the Memory component for saving/retrieving conversation context." ;
    :performedByAgent :memoryAgent ;
    :producedResource :resource_chat_stream_output .

:ws_end_chat a :EndStep ;
    :stepOrder 4 ;
    rdfs:label "End Chat" ;
    rdfs:comment "End step included for completeness; the implementation loop is infinite until process termination." .

# Tasks linking to prompts for clarity
:task_interactive_chat :hasPrompt :prompt_instructions .

# Team representing the Mastra container that registers the agent
:mastra_system a :Team ;
    dcterms:title "Mastra system (agent registry)" ;
    <http://purl.org/dc/terms/description> "Represents the Mastra container in the source code that registers and exposes the 'memoryAgent' instance." ;
    :hasAgentMember :memoryAgent .

# A small descriptive Task capturing the instantiation of the agent with constructor parameters
:task_agent_instantiation a :Task ;
    dcterms:title "Agent instantiation / configuration" ;
    <http://purl.org/dc/terms/description> "Describes Agent constructor parameters used in source: id='memory-agent', name='Memory Agent', instructions (see prompt_instructions), model=openai('gpt-4o-mini'), memory configured (memory_kb)." ;
    :performedByAgent :memoryAgent ;
    :requiresResource :memory_kb .

# Example configuration entries documenting runtime wiring (threadId and resourceId usage recorded as config)
:cfg_runtime_threadId_behaviour a :Config ;
    :configKey "threadId.runtime" ;
    :configValue "Random UUID per session (e.g., randomUUID()). Example in source: a random threadId is generated; sometimes a fixed example threadId is present in comments." .

:cfg_runtime_resourceId_example a :Config ;
    :configKey "resourceId.example" ;
    :configValue "SOME_USER_ID (literal used in source code to represent external user identifier passed to agent.stream)" .

################################################################################
# Additional descriptive metadata linking pieces together
################################################################################

# Link agent to the memory-related constraint for clarity
:memoryAgent :hasKnowledge :constraint_isFirstChatCheck .

# Mark produced resource as contained in an environment-like context (text stream as a resource)
:resource_chat_stream_output a beam:Instance ;
    :envType "console_stream" .

# End of individuals describing the system.