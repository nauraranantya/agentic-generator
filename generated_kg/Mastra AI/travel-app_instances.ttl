# Execution time: 134.81 seconds
# Model used: gpt-5-mini

#################################################################
# Issues / Assumptions:
# - Missing direct properties for representing tool input/output schemas and step selection constraints; used :hasToolConfig and :hasConfig with JSON string values to preserve schema and parameters.
# - No explicit property to represent agent "instructions" vs "prompts" other than :agentPrompt and :hasPrompt. We store instruction texts in :agentPrompt for agents and also preserve step/tool messages as :Prompt individuals.
# - No property to represent tool execution examples or code; those implementation details are omitted and represented as literals in descriptions or in Config instances.
# - No property to represent "memory backend" specifics (LibSQLStore) beyond a generic :hasKnowledge linking to a :Memory individual. Storage connection details are saved in a Config literal.
# - No property to represent branching logic or conditional expressions in workflows (e.g., hotel vs airbnb). Branching is represented by workflow sub-pattern link (:hasSubPattern) and step comments in prompts.
# - No property to represent API endpoints or secrets securely; API host/URI values are preserved in Configs as non-sensitive strings, but secrets (RAPID_API_KEY) are not provided.
# - No classes for "schema definitions" (Zod schemas); they are preserved as JSON strings in Config instances of type :Config and attached via :hasToolConfig or :hasAgentConfig.
# - No property to represent UI elements, front-end components, or React structure. These are intentionally excluded per instructions.
# - No issues detected regarding agent, tool, workflow, prompt, and task mapping; modeled with available classes and properties where possible.
#################################################################

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@base <http://www.w3id.org/agentic-ai/onto#> .

### Team / System ###
:TravelSystem rdf:type :Team ;
  rdfs:label "TravelAI System (Mastra example app)" ;
  rdfs:comment "Overall system coordinating agentic travel planning workflows and agents." ;
  :hasAgentMember :TravelAgent , :TravelAnalyzer ;
  :hasWorkflowPattern :TravelSubmissionWorkflow ;
  :hasSystemConfig :MastraSystemConfig .

:MastraSystemConfig rdf:type :Config ;
  rdfs:label "Mastra System Configuration" ;
  :configKey "workflows" ;
  :configValue "{\"workflows\": [\"syncCsvDataWorkflow\",\"travel-submission\"]}" ;
  :configKey "storage" ;
  :configValue "{\"store\":\"LibSQLStore\",\"id\":\"travel-app-storage\",\"url\":\"file:mastra.db\"}" ;
  :configKey "logger" ;
  :configValue "{\"logger\":\"PinoLogger\",\"level\":\"info\"}" .

#################################################################
# Language Models
#################################################################
:OpenAI_GPT_4_1 rdf:type :LanguageModel ;
  rdfs:label "openai/gpt-4.1" ;
  rdfs:comment "Named model used by agents in the code: 'openai/gpt-4.1'." .

:Anthropic_Claude_Example rdf:type :LanguageModel ;
  rdfs:label "anthropic/claude-3-5-sonnet-20240620" ;
  rdfs:comment "Example model string referenced in documentation/examples (UI). Not used by runtime agents in code." .

#################################################################
# Agents
#################################################################
:TravelAgent rdf:type :LLMAgent ;
  rdfs:label "travel-agent" ;
  rdfs:comment "Primary agent that searches for flights, hotels/airbnbs, and attractions using enabled tools and formulates results." ;
  :agentID "travel-agent" ;
  :hasAgentConfig :TravelAgentConfig ;
  :hasAgentCapability :FindFlightsCapability , :FindHotelsCapability , :FindAttractionsCapability , :SearchAirbnbCapability ;
  :agentPrompt :TravelAgent_Instructions ;
  :hasKnowledge :TravelMemory ;
  :useLanguageModel :OpenAI_GPT_4_1 ;
  :agentToolUsage :SearchFlightsTool , :SearchHotelsTool , :SearchAttractionsTool , :SearchAirbnbLocationTool , :SearchAirbnbTool ;
  :hasAgentGoal :PlanTripGoal .

:TravelAnalyzer rdf:type :LLMAgent ;
  rdfs:label "travel-analyzer" ;
  rdfs:comment "Analyzer agent that receives agent outputs and formats them according to the travel schema for application consumption." ;
  :agentID "travel-analyzer" ;
  :hasAgentConfig :TravelAnalyzerConfig ;
  :hasAgentCapability :AnalyzeTravelResultsCapability ;
  :agentPrompt :TravelAnalyzer_Instructions ;
  :hasKnowledge :TravelMemory ;
  :useLanguageModel :OpenAI_GPT_4_1 ;
  :hasAgentGoal :FormatOutputGoal .

### Agent Configs (store key configuration and model selection, memory) ###
:TravelAgentConfig rdf:type :Config ;
  rdfs:label "travel-agent config" ;
  :configKey "model" ;
  :configValue "openai/gpt-4.1" ;
  :configKey "instructions" ;
  :configValue "You are an expert travel agent responsible for finding a flight, hotel, and three attractions for a user. You will be given a set of user preferences along with some tools and you will need to find the best options for them. Be as concise as possible with your response." ;
  :configKey "enabledTools" ;
  :configValue "{\"searchFlights\":true,\"searchHotels\":true,\"searchAttractions\":true,\"searchAirbnbLocation\":true,\"searchAirbnb\":true}" .

:TravelAnalyzerConfig rdf:type :Config ;
  rdfs:label "travel-analyzer config" ;
  :configKey "model" ;
  :configValue "openai/gpt-4.1" ;
  :configKey "instructions" ;
  :configValue "You are an expert travel agent responsible for finding a flight, hotel, and three attractions for a user. You will be given a set of user preferences along with some data to find the best options for them." .

#################################################################
# Capabilities
#################################################################
:FindFlightsCapability rdf:type :Capability ;
  rdfs:label "Find Flights" ;
  rdfs:comment "Capability to search and select flight options." .

:FindHotelsCapability rdf:type :Capability ;
  rdfs:label "Find Hotels" ;
  rdfs:comment "Capability to search and select hotels." .

:FindAttractionsCapability rdf:type :Capability ;
  rdfs:label "Find Attractions" ;
  rdfs:comment "Capability to search and select attractions." .

:SearchAirbnbCapability rdf:type :Capability ;
  rdfs:label "Search Airbnb" ;
  rdfs:comment "Capability to search airbnb locations and listings." .

:AnalyzeTravelResultsCapability rdf:type :Capability ;
  rdfs:label "Analyze Travel Results" ;
  rdfs:comment "Capability to analyze raw agent search outputs and reformat into application schema." .

#################################################################
# Memory / Knowledge
#################################################################
:TravelMemory rdf:type :Memory ;
  rdfs:label "TravelAgent Memory" ;
  rdfs:comment "Agent memory using LibSQL storage; used by both agents for context & conversation memory." .

:CityDataKnowledgeBase rdf:type :KnowledgeBase ;
  rdfs:label "City Data CSV" ;
  rdfs:comment "Representative CSV file src/data/city-data.csv used to resolve city IDs and attraction IDs; contains airport and city mappings." ;
  <http://purl.org/dc/terms/reference> "src/data/city-data.csv" .

:BookingIntegration rdf:type :Instance ;
  rdfs:label "Booking Integration (Booking API wrapper)" ;
  rdfs:comment "Represents the Booking integration that fetches flights, hotels, attractions, and Airbnb data from external APIs. Implementation details omitted; endpoints and behaviors preserved in tool configs." ;
  <http://purl.org/dc/terms/reference> "https://booking-com15.p.rapidapi.com (api/v1) - used by tools to fetch flights, hotels, attractions, and Airbnb data" .

:TravelAgent rdf:type :LLMAgent ;
  :hasKnowledge :CityDataKnowledgeBase , :BookingIntegration .

#################################################################
# Prompts
#################################################################
:TravelAgent_Instructions rdf:type :Prompt ;
  rdfs:label "Travel Agent Instructions (agent-level)" ;
  :promptInstruction """You are an expert travel agent responsible for finding a flight, hotel, and three attractions for a user. You will be given a set of user preferences along with some tools and you will need to find the best options for them. Be as concise as possible with your response.""" ;
  :promptContext "Agent-level instruction used on agent initialization" .

:TravelAgent_RunMessage rdf:type :Prompt ;
  rdfs:label "Run Agent message (form submission context)" ;
  :promptInstruction """You are a travel agent and have been given the following information about a customer's trip requirements.

- Find the best flight option for the customer (use departureLocation and arrivalLocation from formObject)
- Find the best accommodation option for the customer (use arrivalCityId from formObject)
- Find three activities and attractions for the customer based on their interests (use arrivalAttractionId from formObject)
- Find the best flight option for the customer to return home (use departureLocation and arrivalLocation from formObject)
- Find the best Airbnb option for the customer to stay (use arrivalCityId from formObject) and pass it in to the searchAirbnbLocation tool
- After you have found the Airbnb location, call the searchAirbnb tool (use the id from the searchAirbnbLocation tool, and use typeOfPlace, startDate and endDate from formObject)

Other Notes:
- make sure to add layover information if it exists, if not, ignore it
- make sure to add images for the hotels and accommodations
- flightPriority is a value between 0 and 100 where 0 means the prioritize price the most and 100 means
prioritize convenience the most (shortest trip and matching time).
- ALWAYS pass entire date timestamps back for departureTime and arrivalTime.
- ALWAYS pass the entire flight object back for the outbound and return flights.
- You must not call the searchAirbnbLocation and searchAirbnb tools if the accommodationType is hotel.
- You must not call the searchHotels tool if the accommodationType is Airbnb.

Here is the information about the customer's trip requirements:
Departure Location: <departureLocation>
Arrival Location: <arrivalLocation>
Trip Goals: <tripGoals>
Preferred Flight Times: <preferredFlightTimes>
Flight Priority: <flightPriority>
Accommodation Type: <accommodationType>
Hotel Price Range: <hotelPriceRange>
Interests: <interests>
Start Date: <startDate>
End Date: <endDate>
Departure City ID: <departureCityId>
Arrival City ID: <arrivalCityId>
Arrival Attraction ID: <arrivalAttractionId>
Type of Place: <typeOfPlace>""" ;
  :promptContext "Prompt message given to travel-agent when runAgent is invoked; includes placeholders substituted with form data." .

:TravelAnalyzer_Instructions rdf:type :Prompt ;
  rdfs:label "Travel Analyzer Instructions (agent-level)" ;
  :promptInstruction "You are an expert travel agent responsible for finding a flight, hotel, and three attractions for a user. You will be given a set of user preferences along with some data to find the best options for them." ;
  :promptContext "Analyzer agent base instructions." .

:TravelAnalyzer_FormatMessage rdf:type :Prompt ;
  rdfs:label "Travel Analyzer formatting message" ;
  :promptInstruction """You are a travel agent and after doing your research you have found the following information for the customer's trip.

Use this information to format the response in the correct output schema so it can be used by your travel planner application.

IMPORTANT: For hotel ratings:
- IGNORE the reviewScore property
- Instead, find and extract the numeric rating from the description or accessibilityLabel field
- The rating will be in the format "X.X out of 5 stars" or "X out of 5 stars"
- Extract ONLY the first number (before "out of")
- The extracted rating must be less than or equal to 5
- Add layover information in the legs

Example:
If description contains "4.5 out of 5 stars" → return rating: 4.5
If description contains "3 out of 5 stars" → return rating: 3

IMPORTANT: for <UKNOWN> values:
- make sure to replace all instances of <UNKNOWN> with empty strings
<agent outputs JSON array or steps data placeholder>""" ;
  :promptContext "Prompt given to travelAnalyzer to transform agent output into travelSchema format" .

#################################################################
# Tools (as Tool individuals) and their configuration
#################################################################
:SearchFlightsTool rdf:type :Tool ;
  rdfs:label "Get Flight Info (searchFlights)" ;
  <http://purl.org/dc/terms/description> """Fetches flight information for a given date range, origin and destination. Origin and Destination are Airport codes like DFW.AIRPORT or SEA.AIRPORT""" ;
  :hasToolConfig :SearchFlightsTool_Config ;
  :hasCapability :FindFlightsCapability .

:SearchFlightsTool_Config rdf:type :Config ;
  rdfs:label "searchFlights input schema (zod JSON)" ;
  :configKey "inputSchema" ;
  :configValue """{ "startDate": "string", "endDate": "string", "origin": "string", "destination": "string" }""" ;
  :configKey "description" ;
  :configValue "Used by travel agent to fetch flight offers (booking API). Returns array of Flight domain objects." .

:SearchHotelsTool rdf:type :Tool ;
  rdfs:label "Search Hotels (searchHotels)" ;
  <http://purl.org/dc/terms/description> "Searches for hotels in a specified location. Destination is a cityId like 20015732 for 20015733" ;
  :hasToolConfig :SearchHotelsTool_Config ;
  :hasCapability :FindHotelsCapability .

:SearchHotelsTool_Config rdf:type :Config ;
  rdfs:label "searchHotels input schema (zod JSON)" ;
  :configKey "inputSchema" ;
  :configValue """{ "startDate": "string", "endDate": "string", "destination": "string" }""" ;
  :configKey "description" ;
  :configValue "Returns hotels as Hotel domain objects. Uses Booking integration getHotels." .

:SearchAttractionsTool rdf:type :Tool ;
  rdfs:label "Search Attractions (searchAttractions)" ;
  <http://purl.org/dc/terms/description> "Searches for attractions in a specified location. Destination is a cityId like 20015732 for 20015733" ;
  :hasToolConfig :SearchAttractionsTool_Config ;
  :hasCapability :FindAttractionsCapability .

:SearchAttractionsTool_Config rdf:type :Config ;
  rdfs:label "searchAttractions input schema (zod JSON)" ;
  :configKey "inputSchema" ;
  :configValue """{ "destination": "string" }""" ;
  :configKey "description" ;
  :configValue "Returns attraction items mapped to Attraction domain (id, name, description, price, imageUrl, duration, rating)." .

:SearchAirbnbLocationTool rdf:type :Tool ;
  rdfs:label "Search Airbnb Location (searchAirbnbLocation)" ;
  <http://purl.org/dc/terms/description> "Searches for Airbnb places in a specified location. Place is a city name like New York, NY" ;
  :hasToolConfig :SearchAirbnbLocationTool_Config ;
  :hasCapability :SearchAirbnbCapability .

:SearchAirbnbLocationTool_Config rdf:type :Config ;
  rdfs:label "searchAirbnbLocation input/output schema (zod JSON)" ;
  :configKey "inputSchema" ;
  :configValue """{ "place": "string" }""" ;
  :configKey "outputSchema" ;
  :configValue """{ "id":"string","location_name":"string","terms":[{"offset":"number","value":"string"}],"country_code":"string","display_name":"string","display_style":"string"}""" ;
  :configKey "description" ;
  :configValue "Searches Airbnb searchDestination endpoints; returns AirbnbLocation." .

:SearchAirbnbTool rdf:type :Tool ;
  rdfs:label "Search Airbnb (searchAirbnb)" ;
  <http://purl.org/dc/terms/description> "Searches for Airbnb in a specified location. Place is a cityId like 20015732 for 20015733" ;
  :hasToolConfig :SearchAirbnbTool_Config ;
  :hasCapability :SearchAirbnbCapability .

:SearchAirbnbTool_Config rdf:type :Config ;
  rdfs:label "searchAirbnb input/output schema (zod JSON)" ;
  :configKey "inputSchema" ;
  :configValue """{ "placeId":"string","startDate":"string","endDate":"string","typeOfPlace":"string" }""" ;
  :configKey "outputSchema" ;
  :configValue """{ "adults": "number","avgRating":"number","bathrooms":"number","bedrooms":"number","beds":"number","city":"string","images":["string"],"price":"string","roomType":"string","summary":"string","title":"string","url":"string" }""" ;
  :configKey "description" ;
  :configValue "Searches Airbnb property endpoints; returns list of AirbnbPlace domain objects." .

#################################################################
# Tasks (abstract tasks performed by agents/tools)
#################################################################
:FindOutboundFlightTask rdf:type :Task ;
  rdfs:label "Find Outbound Flight" ;
  rdfs:comment "Task to find and return the outbound flight offer (entire flight object) using searchFlights tool." ;
  :taskPrompt :FindOutboundFlight_Prompt ;
  :performedByAgent :TravelAgent ;
  :performedBy :SearchFlightsTool ;
  :contributesToObjective :PlanTripObjective ;
  :producedResource :OutboundFlightResource ;
  :requiresResource :CityDataKnowledgeBase .

:FindOutboundFlight_Prompt rdf:type :Prompt ;
  rdfs:label "Find Outbound Flight Prompt" ;
  :promptInstruction "Select 1 outbound flight for the given departureLocation -> arrivalLocation and date range. Return entire flight object including legs and timestamps. Consider flightPriority to trade off price vs convenience." ;
  :promptContext "Executed within travel-agent run; includes travel form values: departureLocation, arrivalLocation, startDate, endDate, flightPriority." .

:FindReturnFlightTask rdf:type :Task ;
  rdfs:label "Find Return Flight" ;
  rdfs:comment "Task to find and return the return flight offer using searchFlights tool." ;
  :taskPrompt :FindReturnFlight_Prompt ;
  :performedBy :SearchFlightsTool ;
  :contributesToObjective :PlanTripObjective ;
  :producedResource :ReturnFlightResource ;
  :requiresResource :CityDataKnowledgeBase .

:FindReturnFlight_Prompt rdf:type :Prompt ;
  rdfs:label "Find Return Flight Prompt" ;
  :promptInstruction "Select 1 return flight for the given arrivalLocation -> departureLocation and date range. Return entire flight object including legs and timestamps." .

:FindAccommodationTask rdf:type :Task ;
  rdfs:label "Find Accommodation (Hotel or Airbnb)" ;
  rdfs:comment "Task to find accommodation. Behavior branches by accommodationType: if hotel -> call searchHotels; if airbnb -> call searchAirbnbLocation then searchAirbnb." ;
  :taskPrompt :FindAccommodation_Prompt ;
  :contributesToObjective :PlanTripObjective ;
  :producedResource :AccommodationResource .

:FindAccommodation_Prompt rdf:type :Prompt ;
  rdfs:label "Find Accommodation Prompt" ;
  :promptInstruction """If accommodationType is 'hotel' call Search Hotels tool using arrivalCityId. If accommodationType is 'airbnb', first call Search Airbnb Location tool to get place id and then call Search Airbnb tool using that id, typeOfPlace, startDate, endDate. Do NOT call Airbnb tools if accommodationType is hotel. Do NOT call searchHotels if accommodationType is airbnb.""" ;
  :promptContext "Task logic (branching) preserved as instruction string." .

:FindAttractionsTask rdf:type :Task ;
  rdfs:label "Find Attractions" ;
  rdfs:comment "Task to find three activities and attractions based on user's interests using Search Attractions tool." ;
  :taskPrompt :FindAttractions_Prompt ;
  :performedBy :SearchAttractionsTool ;
  :contributesToObjective :PlanTripObjective ;
  :producedResource :AttractionsResource .

:FindAttractions_Prompt rdf:type :Prompt ;
  rdfs:label "Find Attractions Prompt" ;
  :promptInstruction "Find three activities and attractions for the customer based on interests and arrivalAttractionId; return id, name, description, rating, price, imageUrl, location." .

:AnalyzeAndFormatTask rdf:type :Task ;
  rdfs:label "Analyze and Format Results" ;
  rdfs:comment "Task executed by travelAnalyzer to map agent raw outputs into the travelSchema (zod) expected by the application." ;
  :taskPrompt :AnalyzeAndFormat_Prompt ;
  :performedByAgent :TravelAnalyzer ;
  :producedResource :TravelPlanResource ;
  :contributesToObjective :PlanTripObjective .

:AnalyzeAndFormat_Prompt rdf:type :Prompt ;
  rdfs:label "Analyze and Format Prompt" ;
  :promptInstruction "Take the travel agent's research outputs and format them precisely into the travelSchema: flights {outbound, return}, accommodation, attractions. Extract numeric hotel ratings from description text; replace '<UNKNOWN>' with empty strings; include layover legs. Return JSON matching schema." .

#################################################################
# Workflow patterns and steps
#################################################################
:TravelSubmissionWorkflow rdf:type :WorkflowPattern ;
  rdfs:label "travel-submission" ;
  rdfs:comment "Workflow that triggers on travel form submission; parallelizes flight searches, branches for accommodation type, arranges attractions, and returns a structured selection set." ;
  :hasWorkflowStep :OutboundFlightStep , :ReturnFlightStep , :AccommodationStep , :AirbnbLocationStep , :ArrangeAttractionsStep ;
  :hasSubPattern :AirbnbFlowPattern .

:OutboundFlightStep rdf:type :WorkflowStep ;
  rdfs:label "outboundFlight" ;
  rdfs:comment "Step that searches for outbound flights (choiceCount=1) using booking.getFlights and then asks travelAnalyzer agent to choose 1 id." ;
  :hasAssociatedTask :FindOutboundFlightTask ;
  :stepOrder 1 ;
  :nextStep :ReturnFlightStep .

:ReturnFlightStep rdf:type :WorkflowStep ;
  rdfs:label "returnFlight" ;
  rdfs:comment "Step that searches for return flights (choiceCount=1) using booking.getFlights and then asks travelAnalyzer to choose 1 id." ;
  :hasAssociatedTask :FindReturnFlightTask ;
  :stepOrder 2 ;
  :nextStep :AccommodationStep .

:AccommodationStep rdf:type :WorkflowStep ;
  rdfs:label "accommodation" ;
  rdfs:comment "Branch step: for 'hotel' runs arrangeHotels; for 'airbnb' runs airbnb-flow (airbnbLocation + arrangeAirbnb)." ;
  :hasAssociatedTask :FindAccommodationTask ;
  :stepOrder 3 ;
  :nextStep :ArrangeAttractionsStep .

:AirbnbLocationStep rdf:type :WorkflowStep ;
  rdfs:label "airbnbLocation" ;
  rdfs:comment "Step to search for Airbnb locations (choiceCount=3) using booking.getAirbnbSearchPlaces; used only when accommodationType is 'airbnb'." ;
  :hasAssociatedTask :FindAccommodationTask ;
  :stepOrder 3 ;
  :nextStep :AccommodationStep .

:ArrangeAttractionsStep rdf:type :WorkflowStep ;
  rdfs:label "attraction" ;
  rdfs:comment "Step that queries attractions (choiceCount=3) and then asks travelAnalyzer to select 3." ;
  :hasAssociatedTask :FindAttractionsTask ;
  :stepOrder 4 .

:AirbnbFlowPattern rdf:type :WorkflowPattern ;
  rdfs:label "airbnb-flow" ;
  rdfs:comment "Sub-workflow executed when accommodationType is 'airbnb'; performs airbnbLocation then arrangeAirbnb." ;
  :hasWorkflowStep :AirbnbLocationStep , :AccommodationStep .

#################################################################
# Resources (produced/required)
#################################################################
:OutboundFlightResource rdf:type beam:Resource ;
  rdfs:label "outboundFlight (Flight object)" ;
  <http://purl.org/dc/terms/description> "Domain Flight object produced by searchFlights: includes airline, flightNumber, departure/arrival airports/cities/times, duration, price, legs." .

:ReturnFlightResource rdf:type beam:Resource ;
  rdfs:label "returnFlight (Flight object)" ;
  <http://purl.org/dc/terms/description> "Return flight object (same structure as outbound)." .

:AccommodationResource rdf:type beam:Resource ;
  rdfs:label "accommodation (Hotel or Airbnb listing)" ;
  <http://purl.org/dc/terms/description> "Hotel or Airbnb domain object with fields: name, rating, pricePerNight or price, images, location, address, description, amenities." .

:AttractionsResource rdf:type beam:Resource ;
  rdfs:label "attractions (list of Attraction)" ;
  <http://purl.org/dc/terms/description> "Array of Attraction items recommended for trip." .

:TravelPlanResource rdf:type beam:Resource ;
  rdfs:label "Formatted travel plan (travelSchema)" ;
  <http://purl.org/dc/terms/description> "Final application JSON matching travelSchema with flights.outbound, flights.return, accommodation, attractions." .

#################################################################
# Goals and Objectives
#################################################################
:PlanTripGoal rdf:type :Goal ;
  rdfs:label "Plan Trip" ;
  rdfs:comment "Top-level goal for agents to plan user's trip (assemble flights, accommodation, attractions)." .

:PlanTripObjective rdf:type :Objective ;
  rdfs:label "Assemble trip components" ;
  rdfs:comment "Objective to gather flight options, accommodation and activities." ;
  :contributesToGoal :PlanTripGoal .

:FormatOutputGoal rdf:type :Goal ;
  rdfs:label "Format Output" ;
  rdfs:comment "Ensure output matches application schema for frontend consumption." .

#################################################################
# Data Schemas / App-level knowledge (travel schema)
#################################################################
:TravelSchema rdf:type :KnowledgeBase ;
  rdfs:label "travelSchema (zod)" ;
  rdfs:comment "The output schema (zod) expected by the application representing flights, accommodation, attractions." ;
  <http://purl.org/dc/terms/description> """travelSchema fields:
- flights: { outbound: flightSchema, return: flightSchema }
- accommodation: { name, rating, pricePerNight, location, address, description, amenities, imageUrl, reviewScore }
- attractions: array of { name, description, rating, price, imageUrl, location }""" ;
  :resourceUsage :CityDataKnowledgeBase .

#################################################################
# Storage and sync workflow
#################################################################
:SyncCsvWorkflow rdf:type :WorkflowPattern ;
  rdfs:label "syncCsvData" ;
  rdfs:comment "Workflow to read src/data/city-data.csv and produce records of city mappings." ;
  :hasWorkflowStep :SyncCsvStep .

:SyncCsvStep rdf:type :WorkflowStep ;
  rdfs:label "sync-csv-data-step" ;
  rdfs:comment "Step that reads CSV file and outputs records: {data, externalId}." ;
  :hasAssociatedTask :SyncCsvTask ;
  :stepOrder 1 .

:SyncCsvTask rdf:type :Task ;
  rdfs:label "Sync CSV Data Task" ;
  rdfs:comment "Reads city-data.csv and returns city records including cityId and attractionId. Used to populate lookup for arrivalCityId, departureCityId." ;
  :producedResource :CityDataKnowledgeBase .

#################################################################
# Examples of specific preserved strings and schemas
#################################################################
:TravelForm_Schema_Config rdf:type :Config ;
  rdfs:label "travel form schema (zod JSON)" ;
  :configKey "travelSchema" ;
  :configValue """{ "flights": { "outbound": "flightSchema", "return": "flightSchema" }, "accommodation": "accommodationSchema", "attractions": "attractionsSchema" }""" ;
  <http://purl.org/dc/terms/description> "Represents the Zod travelSchema used for travelAnalyzer output validation" .

:Flight_Schema_Config rdf:type :Config ;
  rdfs:label "flightSchema (zod JSON)" ;
  :configKey "flightSchema" ;
  :configValue """{ "airline":"string","flightNumber":"string","departureTime":"string","departureAirport":"string","departureCity":"string","arrivalTime":"string","arrivalAirport":"string","arrivalCity":"string","duration":"string","price":"number","stops":"number","layover": "object|null" }""" ;
  <http://purl.org/dc/terms/description> "Zod flight schema used to validate flight objects returned to UI" .

#################################################################
# Interaction links and high-level mapping
#################################################################
:TravelSystem :hasWorkflowPattern :TravelSubmissionWorkflow .

# Agents participate in the main workflow (implicitly)
:TravelAgent :hasAgentGoal :PlanTripGoal .
:TravelAnalyzer :hasAgentGoal :FormatOutputGoal .

# Tools are used by travel agent
:TravelAgent :agentToolUsage :SearchFlightsTool , :SearchHotelsTool , :SearchAttractionsTool , :SearchAirbnbLocationTool , :SearchAirbnbTool .

# Tasks are linked to workflow steps
:OutboundFlightStep :hasAssociatedTask :FindOutboundFlightTask .
:ReturnFlightStep :hasAssociatedTask :FindReturnFlightTask .
:AccommodationStep :hasAssociatedTask :FindAccommodationTask .
:ArrangeAttractionsStep :hasAssociatedTask :FindAttractionsTask .
:SyncCsvStep :hasAssociatedTask :SyncCsvTask .

#################################################################
# Produced sample mapping relationships (semantic links preserving logic)
#################################################################
:FindOutboundFlightTask :producedResource :OutboundFlightResource .
:FindReturnFlightTask :producedResource :ReturnFlightResource .
:FindAccommodationTask :producedResource :AccommodationResource .
:FindAttractionsTask :producedResource :AttractionsResource .
:AnalyzeAndFormatTask :producedResource :TravelPlanResource .

#################################################################
# Additional descriptive literals preserved from code (examples & notes)
#################################################################
:BookingIntegration :hasConfig :BookingIntegration_Config .

:BookingIntegration_Config rdf:type :Config ;
  rdfs:label "Booking integration config" ;
  :configKey "baseUri" ;
  :configValue "https://booking-com15.p.rapidapi.com/api/v1" ;
  :configKey "notes" ;
  :configValue "This integration is used by tools to fetch flights, hotels, attractions and airbnb data. API host and endpoints are preserved in tool configs. RapidAPI key referenced in code via environment variable RAPID_API_KEY." .

# Example: runAgent message stored for fidelity
:RunAgentMessageLiteral rdf:type :Prompt ;
  rdfs:label "runAgent message literal (from actions.runAgent)" ;
  :promptInstruction """You are a travel agent and have been given the following information about a customer's trip requirements.

- Find the best flight option for the customer (use departureLocation and arrivalLocation from formObject)
- Find the best accommodation option for the customer (use arrivalCityId from formObject)
- Find three activities and attractions for the customer based on their interests (use arrivalAttractionId from formObject)
- Find the best flight option for the customer to return home (use departureLocation and arrivalLocation from formObject)
- Find the best Airbnb option for the customer to stay (use arrivalCityId from formObject) and pass it in to the searchAirbnbLocation tool
- After you have found the Airbnb location, call the searchAirbnb tool (use the id from the searchAirbnbLocation tool, and use typeOfPlace, startDate and endDate from formObject)

Other Notes:
- make sure to add layover information if it exists, if not, ignore it
- make sure to add images for the hotels and accommodations
- flightPriority is a value between 0 and 100 where 0 means the prioritize price the most and 100 means
prioritize convenience the most (shortest trip and matching time).
- ALWAYS pass entire date timestamps back for departureTime and arrivalTime.
- ALWAYS pass the entire flight object back for the outbound and return flights.
- You must not call the searchAirbnbLocation and searchAirbnb tools if the accommodationType is hotel.
- You must not call the searchHotels tool if the accommodationType is Airbnb.

Here is the information about the customer's trip requirements:

Departure Location: ${formObject.departureLocation}
Arrival Location: ${formObject.arrivalLocation}
Trip Goals: ${formObject.tripGoals}
Preferred Flight Times: ${formObject.preferredFlightTimes}
Flight Priority: ${formObject.flightPriority}
Accommodation Type: ${formObject.accommodationType}
Hotel Price Range: ${formObject.hotelPriceRange}
Interests: ${formObject.interests}
Start Date: ${formObject.startDate}
End Date: ${formObject.endDate}
Departure City ID: ${formObject.departureCityId}
Arrival City ID: ${formObject.arrivalCityId}
Arrival Attraction ID: ${formObject.arrivalAttractionId}
Type of Place: ${formObject.typeOfPlace}""" ;
  :promptContext "Exact runAgent message used in server action; placeholders shown as in code." .

#################################################################
# Provenance / Participation (high-level)
#################################################################
:TravelAgentParticipation rdf:type :Task ;
  rdfs:label "Travel agent participates in planning tasks" ;
  rdfs:comment "Logical grouping to indicate the travelAgent participates in outbound/return/accommodation/attractions tasks." ;
  :humanParticipatedIn :FindOutboundFlightTask , :FindReturnFlightTask ;
  beam:participatedIn :FindAttractionsTask .

#################################################################
# End of individuals
#################################################################