# Execution time: 106.70 seconds
# Model used: gpt-5-mini

#################################################################
# Issues / Assumptions:
# - Missing concept: There is no schema class for "Tool input/output JSON Schema" or "Data Schema". I modelled input/output schemas as :Config individuals (hasToolConfig) with configKey "inputSchema"/"outputSchema" and configValue storing the textual schema representation. This preserves fidelity but is an approximation.
# - Missing concept: There is no dedicated class for "Integration" or "External API client". I modelled integrations (GitHub, Firecrawl) as :Tool individuals to reuse existing properties (toolUsage, hasToolConfig). This is a pragmatic mapping.
# - Missing concept: There is no class to represent "Logger" or "Transport" objects. I modelled logger and transport configuration entries as :Config individuals attached via hasSystemConfig.
# - Missing concept: There is no property to represent "agent produces tool calls or uses an agent API directly" beyond toolUsage; I used toolUsage and agentToolUsage for relationships where tools call agents and tools use integrations.
# - Missing concept: There is no class for "WorkflowRun" or runtime "Step state". I modelled the workflow structure (steps, tasks, resources) but not transient runtime state. Logs returned by workflows are modeled as produced resources meta-information only where relevant.
# - UI and code structure (React components, CSS, fonts) are intentionally not modelled; only agentic semantics, tools, workflows, prompts, configs, and resources are modelled.
# - No changes were made to the ontology schema (classes/properties). Instances are represented using existing classes/properties only.
#################################################################

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

#################################################################
# System / Team
#################################################################

:MastraSystem a :Team ;
    rdfs:label "Mastra System" ;
    dcterms:description "The deployed Mastra system that coordinates agents, tools and workflows for generating OpenAPI specs and creating PRs." ;
    :hasSystemConfig :MastraLoggerConfig , :MastraUpstashConfig ;
    :hasWorkflowPattern :OpenApiSpecGenWorkflowPattern , :MakePRWorkflowPattern ;
    :hasAgentMember :OpenAPISpecAgent ;
    :hasGoal :Goal_GenerateOpenAPISpec .

:MastraLoggerConfig a :Config ;
    :configKey "logger.name" ;
    :configValue "OPENAPI_SPEC_WRITER" ;
    dcterms:description "Logger configuration for Mastra: Pino logger name and level." .

:MastraLoggerLevelConfig a :Config ;
    :configKey "logger.level" ;
    :configValue "debug" ;
    dcterms:description "Logger level used by Mastra (PinoLogger)" .

:MastraUpstashConfig a :Config ;
    :configKey "upstash.transport" ;
    :configValue "UpstashTransport - expects UPSTASH_API_KEY and UPSTASH_URL environment variables" ;
    dcterms:description "Upstash transport config for Mastra logging transport (env vars referenced in runtime)." .

#################################################################
# Language model & Agent
#################################################################

:GPT35Turbo a :LanguageModel ;
    rdfs:label "gpt-3.5-turbo" ;
    dcterms:description "Language model used by the OpenAPI spec generator agent (runtime: openai gpt-3.5-turbo)." .

:OpenAPISpecAgent a :LLMAgent ;
    rdfs:label "OpenAPI Spec Generator Agent" ;
    :agentID "openapi-spec-gen-agent" ;
    :agentRole "OpenAPI spec writer agent" ;
    dcterms:description "An LLM-based agent configured to convert markdown docs into OpenAPI specs and merge them." ;
    :useLanguageModel :GPT35Turbo ;
    :hasAgentConfig :OpenAPISpecAgentConfig ;
    :hasAgentCapability :Capability_ConvertMarkdownToOpenAPISpec , :Capability_MergeOpenAPISpecs , :Capability_FormatYaml ;
    :agentPrompt :AgentInstructionPrompt ;
    :hasAgentGoal :Goal_GenerateOpenAPISpec ;
    :agentResourceUsage :OpenAPISpecAgentMemory .

:OpenAPISpecAgentConfig a :Config ;
    :configKey "model" ;
    :configValue "openai(gpt-3.5-turbo)" ;
    dcterms:description "Agent runtime model config." .

:AgentInstructionPrompt a :Prompt ;
    dcterms:description "Instruction prompt for the OpenAPI Spec Generator Agent (agent-level instructions)." ;
    :promptInstruction "You are an expert Open API spec writer. You can take markdown documentation and extract all the information you can to generate an amazing Open API spec. You are also able to merge multiple fragmented Open API specs from the same source into a single compliant spec." ;
    :promptOutputIndicator "Generate valid OpenAPI spec fragments or merged complete YAML/JSON spec." .

:OpenAPISpecAgentMemory a :Memory ;
    rdfs:label "Agent memory placeholder" ;
    dcterms:description "Memory/knowledge base placeholder for agent (used at runtime to fetch context, e.g. crawled pages)." .

#################################################################
# Capabilities
#################################################################

:Capability_ConvertMarkdownToOpenAPISpec a :Capability ;
    rdfs:label "Convert markdown to OpenAPI spec" ;
    rdfs:comment "Extract endpoints, parameters, responses and models from markdown documentation and produce an OpenAPI fragment." .

:Capability_MergeOpenAPISpecs a :Capability ;
    rdfs:label "Merge OpenAPI fragments" ;
    rdfs:comment "Merge multiple OpenAPI fragments into a single valid OpenAPI spec (resolve conflicts, unify components)." .

:Capability_FormatYaml a :Capability ;
    rdfs:label "Format spec as YAML" ;
    rdfs:comment "Produce a properly formatted YAML spec from textual content." .

#################################################################
# Tools (Tool definitions and integration endpoints)
#################################################################

:SiteCrawlTool a :Tool ;
    rdfs:label "Site Crawl" ;
    dcterms:description "Crawl a website and extract the markdown content" ;
    :hasToolConfig :SiteCrawlTool_InputSchema , :SiteCrawlTool_OutputSchema , :SiteCrawlTool_DescConfig ;
    :toolUsage :FirecrawlIntegration ;
    :resourceUsage :CrawledDataResource .

:SiteCrawlTool_InputSchema a :Config ;
    :configKey "inputSchema" ;
    :configValue """z.object({
  url: z.string(),
  pathRegex: z.string(),
  limit: z.number(),
})""" ;
    dcterms:description "Input schema for site-crawl tool (fields: url, pathRegex, limit)." .

:SiteCrawlTool_OutputSchema a :Config ;
    :configKey "outputSchema" ;
    :configValue """z.object({
  success: z.boolean(),
  crawlData: z.array(
    z.object({
      markdown: z.string(),
      metadata: z.object({
        sourceURL: z.string(),
      }),
    })
  ),
  entityType: z.string(),
})""" ;
    dcterms:description "Output schema for site-crawl tool: crawlData provides markdown pages and metadata." .

:SiteCrawlTool_DescConfig a :Config ;
    :configKey "description" ;
    :configValue "Crawl a website and extract the markdown content (uses Firecrawl integration and returns crawlData array with markdown and metadata)." .

:FirecrawlIntegration a :Tool ;
    rdfs:label "Firecrawl Integration" ;
    dcterms:description "Integration client used to crawl websites (Firecrawl API key supplied at runtime)." ;
    :hasToolConfig :FirecrawlConfig ;
    :resourceUsage :CrawledDataResource .

:FirecrawlConfig a :Config ;
    :configKey "API_KEY" ;
    :configValue "env: FIRECRAWL_API_KEY (runtime)" ;
    dcterms:description "API key config for Firecrawl integration; referenced at runtime." .

:GenerateSpecTool a :Tool ;
    rdfs:label "Generate Spec" ;
    dcterms:description "Generate an OpenAPI spec from crawled website markdown; uses the OpenAPI agent to convert pages and merge them." ;
    :hasToolConfig :GenerateSpecTool_InputSchema , :GenerateSpecTool_OutputSchema , :GenerateSpecTool_DescConfig ;
    :toolUsage :OpenAPISpecAgent ;
    :requiresResource :CrawledDataResource ;
    :producedResource :MergedOpenApiSpecResource .

:GenerateSpecTool_InputSchema a :Config ;
    :configKey "inputSchema" ;
    :configValue """z.object({
  mastra_entity_type: z.string(),
})""" ;
    dcterms:description "Input schema for generate-spec tool: references the entity type produced by the site crawl." .

:GenerateSpecTool_OutputSchema a :Config ;
    :configKey "outputSchema" ;
    :configValue """z.object({
  success: z.boolean(),
  mergedSpec: z.string(),
})""" ;
    dcterms:description "Output schema for generate-spec tool: returns mergedSpec (string YAML)." .

:GenerateSpecTool_DescConfig a :Config ;
    :configKey "description" ;
    :configValue "Generate a spec from a website by calling the OpenAPISpec agent for each crawled page, then asking the agent to merge the fragments into one spec." .

:AddToGitHubTool a :Tool ;
    rdfs:label "Add to Git" ;
    dcterms:description "Commit the spec to GitHub: formats YAML via the agent, creates branch, commits files and opens a pull request." ;
    :hasToolConfig :AddToGitHub_InputSchema , :AddToGitHub_OutputSchema , :AddToGitHub_DescConfig ;
    :toolUsage :GitHubIntegration ;
    :requiresResource :MergedOpenApiSpecResource ;
    :producedResource :GitHubPRResource .

:AddToGitHub_InputSchema a :Config ;
    :configKey "inputSchema" ;
    :configValue """z.object({
  yaml: z.string(),
  integration_name: z.string(),
  owner: z.string(),
  repo: z.string(),
  site_url: z.string(),
})""" ;
    dcterms:description "Input schema for add-to-github tool: supply YAML, integration_name, owner, repo and site_url." .

:AddToGitHub_OutputSchema a :Config ;
    :configKey "outputSchema" ;
    :configValue """z.object({
  success: z.boolean(),
  pr_url: z.string().optional(),
})""" ;
    dcterms:description "Output schema for add-to-github tool: optionally returns pr_url on success." .

:AddToGitHub_DescConfig a :Config ;
    :configKey "description" ;
    :configValue "Formats YAML via the OpenAPI agent, writes files to a new branch and opens a pull request using GitHub integration." .

:GitHubIntegration a :Tool ;
    rdfs:label "GitHub Integration" ;
    dcterms:description "GitHub integration client that performs git ref, file write and pull request operations (requires PERSONAL_ACCESS_TOKEN)." ;
    :hasToolConfig :GitHubConfig .

:GitHubConfig a :Config ;
    :configKey "PERSONAL_ACCESS_TOKEN" ;
    :configValue "env: GITHUB_API_KEY (runtime)" ;
    dcterms:description "GitHub Personal Access Token config for integration." .

#################################################################
# Resources (produced/consumed)
#################################################################

:CrawledDataResource a beam:Resource ;
    rdfs:label "Crawled data (markdown pages)" ;
    dcterms:description "Resource produced by site-crawl tool: an array of objects containing markdown text and metadata with sourceURL. Used as input for generate-spec tool." .

:MergedOpenApiSpecResource a beam:Resource ;
    rdfs:label "Merged OpenAPI spec (yaml string)" ;
    dcterms:description "The merged OpenAPI specification produced by the generate-spec tool (string YAML). This resource is consumed by the add-to-github tool." .

:GitHubPRResource a beam:Resource ;
    rdfs:label "Pull Request URL / result" ;
    dcterms:description "The PR created on GitHub as a result of add-to-github tool (pr_url if created)." .

#################################################################
# Prompts used during task execution
#################################################################

:ToolPrompt_ConvertPageToSpec a :Prompt ;
    rdfs:label "Prompt: Convert page to OpenAPI spec" ;
    :promptInstruction "I wrote another page of docs, turn this into an Open API spec: ${d.data.markdown}" ;
    :promptContext "This prompt is used by generate-spec tool: for each crawled page, the OpenAPISpecAgent is asked to convert the page markdown into an OpenAPI fragment." ;
    :promptOutputIndicator "OpenAPI spec fragment (yaml or json) representing endpoints, parameters, responses, schemas extracted from the provided markdown." .

:ToolPrompt_MergeSpecs a :Prompt ;
    rdfs:label "Prompt: Merge OpenAPI fragments" ;
    :promptInstruction "I have generated the following Open API specs: ${openapiResponses} - merge them into a single spec," ;
    :promptContext "After converting multiple pages to spec fragments, ask the agent to merge them into a single unified OpenAPI spec." ;
    :promptOutputIndicator "Single merged OpenAPI spec (YAML/JSON) without code fence markers." .

:ToolPrompt_FormatYaml a :Prompt ;
    rdfs:label "Prompt: Format blob into YAML" ;
    :promptInstruction "Can you take this text blob and format it into proper YAML? ${content}" ;
    :promptContext "Used by add-to-github tool: the agent is asked to format a textual blob into valid YAML before committing to repository." ;
    :promptOutputIndicator "Properly formatted YAML (no code fences), ready to write to file." .

#################################################################
# Workflow patterns and steps
#################################################################

:OpenApiSpecGenWorkflowPattern a :WorkflowPattern ;
    rdfs:label "openApiSpecGenWorkflow" ;
    dcterms:description "Workflow that crawls a URL and generates an OpenAPI spec from crawled documentation." ;
    :hasWorkflowStep :SiteCrawlWorkflowStep , :GenerateSpecWorkflowStep .

:SiteCrawlWorkflowStep a :WorkflowStep ;
    rdfs:label "site-crawl-sync-step" ;
    :stepOrder 1 ;
    dcterms:description "Step that executes a site crawl and returns crawlData and entityType." ;
    :hasAssociatedTask :SiteCrawlTask .

:GenerateSpecWorkflowStep a :WorkflowStep ;
    rdfs:label "generate-spec-step" ;
    :stepOrder 2 ;
    dcterms:description "Step that generates a merged OpenAPI spec from crawled data using an agent." ;
    :hasAssociatedTask :GenerateSpecTask .

:MakePRWorkflowPattern a :WorkflowPattern ;
    rdfs:label "makePRToMastra" ;
    dcterms:description "Workflow that creates a PR to the mastra repository given a YAML OpenAPI spec." ;
    :hasWorkflowStep :AddToGitHubWorkflowStep .

:AddToGitHubWorkflowStep a :WorkflowStep ;
    rdfs:label "add-to-github-step" ;
    :stepOrder 1 ;
    dcterms:description "Step that calls a tool to commit spec files and open a PR on GitHub." ;
    :hasAssociatedTask :AddToGitHubTask .

#################################################################
# Tasks (mapping to tool usage or agent actions)
#################################################################

:SiteCrawlTask a :Task ;
    rdfs:label "site-crawl-sync-step:task" ;
    dcterms:description "Task executed by the workflow step site-crawl-sync-step. It runs the SiteCrawlTool (Firecrawl client) to extract markdown pages." ;
    :performedBy :SiteCrawlTool ;
    :producedResource :CrawledDataResource ;
    :taskPrompt :SiteCrawlTool_DescConfig .

:GenerateSpecTask a :Task ;
    rdfs:label "generate-spec:task" ;
    dcterms:description "Task executed by the generate-spec step: this task iterates crawled pages, calls the agent to produce OpenAPI fragments, and then asks the agent to merge them." ;
    :requiresResource :CrawledDataResource ;
    :performedBy :GenerateSpecTool ;
    :taskPrompt :ToolPrompt_ConvertPageToSpec , :ToolPrompt_MergeSpecs ;
    :producedResource :MergedOpenApiSpecResource .

:AddToGitHubTask a :Task ;
    rdfs:label "add-to-github:task" ;
    dcterms:description "Task executed by makePRToMastra workflow: formats YAML via agent and writes files to GitHub then creates a PR." ;
    :requiresResource :MergedOpenApiSpecResource ;
    :performedBy :AddToGitHubTool ;
    :taskPrompt :ToolPrompt_FormatYaml ;
    :producedResource :GitHubPRResource .

#################################################################
# Task <-> Tool/Agent relations and toolUsage
#################################################################

# generate-spec tool uses the OpenAPISpecAgent to call agent.generate for page conversion and merging
:GenerateSpecTool :toolUsage :OpenAPISpecAgent .

# add-to-github uses the GitHub integration
:AddToGitHubTool :toolUsage :GitHubIntegration ;
    dcterms:description "Calls GitHub client (gitGetRef, gitCreateRef, reposCreateOrUpdateFileContents, pullsCreate) via integration." .

# site-crawl uses Firecrawl integration
:SiteCrawlTool :toolUsage :FirecrawlIntegration .

#################################################################
# Goals / Objectives
#################################################################

:Goal_GenerateOpenAPISpec a :Goal ;
    rdfs:label "Generate OpenAPI spec from docs" ;
    dcterms:description "Produce a merged OpenAPI specification from website documentation and optionally open a PR with the spec in a repository." .

#################################################################
# Workflow <-> Team mapping
#################################################################

:MastraSystem :hasWorkflowPattern :OpenApiSpecGenWorkflowPattern , :MakePRWorkflowPattern .

#################################################################
# Samples of preserved prompt text and examples (for fidelity)
#################################################################

:Example_Prompt_ConvertPageToSpec a :Prompt ;
    rdfs:label "Example: convert page to spec literal sample" ;
    :promptInstruction "I wrote another page of docs, turn this into an Open API spec: ${d.data.markdown}" ;
    :promptContext "Used programmatically inside generate-spec tool: for-each crawled page, call agent.generate with the page's markdown." .

:Example_Prompt_MergeSpecs a :Prompt ;
    rdfs:label "Example: merge specs literal sample" ;
    :promptInstruction "I have generated the following Open API specs: ${openapiResponses.map((r) => r).join('\\n\\n')} - merge them into a single spec," ;
    :promptContext "In program: agent.generate called with aggregated openapi responses then clean code-fence markers from answer." .

:Example_Prompt_FormatYaml a :Prompt ;
    rdfs:label "Example: format to YAML literal sample" ;
    :promptInstruction "Can you take this text blob and format it into proper YAML? ${content}" ;
    :promptContext "In program: the agent formats the YAML blob, then the tool base64-encodes and writes files to the repo." .

#################################################################
# Notes about runtime interactions (stored as descriptive config)
#################################################################

:RunBehaviorConfig a :Config ;
    :configKey "generateSpec.flow" ;
    :configValue """Behavior summary:
1) site-crawl tool crawls the provided URL (pathRegex optional) and returns crawlData (markdown pages) and entityType.
2) generate-spec tool iterates crawled pages and for each page invokes the OpenAPISpecAgent with prompt 'I wrote another page of docs, turn this into an Open API spec: ...' to obtain an OpenAPI fragment.
3) generate-spec tool then invokes the agent with a merging prompt containing all fragments to produce a merged spec, strips code fences, and returns mergedSpec (yaml string).
4) The makePR workflow's add-to-github tool can call the agent to format YAML, create a branch, write openapi.yaml and README.md, and open a PR.
Logging is performed to Upstash transport (env-provided)." """ ;
    dcterms:description "Human-readable summary of the runtime flow and behaviors preserved from the source." .

#################################################################
# End of instances
#################################################################