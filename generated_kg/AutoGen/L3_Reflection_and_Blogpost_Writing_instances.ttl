# Execution time: 93.98 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - API keys / secrets found in the source have been redacted in configs for safety. Original notebook contained an API key literal; it is represented here as "<REDACTED_API_KEY>".
# - The ontology lacks first-class constructs for:
#   - representing executable functions/code (e.g., the termination lambda `is_termination_msg`, the Python function `reflection_message`, or `register_nested_chats` runtime behavior). These are modeled as Configs or Prompt templates with textual descriptions.
#   - representing runtime chat history retrieval semantics like `recipient.chat_messages_for_summary(sender)[-1]['content']`. This dynamic behavior is preserved as a prompt template literal but cannot be enforced or expressed as executable semantics in the ontology.
#   - representing "trigger" for nested chats (e.g., trigger=writer) as an explicit property; modeled as a Config on the workflow step instead.
#   - representing structured "summary_method" or "max_turns" as dedicated properties; modeled via Config individuals (configKey/configValue).
# - No new classes or properties were created; missing concepts were encoded as literals in Config or Prompt individuals as the closest fit.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@base <http://www.w3id.org/agentic-ai/onto#> .

#################################################################
# Instances extracted from L3_Reflection_and_Blogpost_Writing.ipynb
#################################################################

### Language models used
:LM_gpt4o_mini a :LanguageModel ;
    <http://purl.org/dc/terms/title> "gpt-4o-mini" ;
    <http://purl.org/dc/terms/description> "Language model configured via OpenAIChatCompletionClient in the notebook and used by Writer and Critic (client model parameter 'gpt-4o-mini')." .

:LM_gpt3_5_turbo a :LanguageModel ;
    <http://purl.org/dc/terms/title> "gpt-3.5-turbo" ;
    <http://purl.org/dc/terms/description> "Default LLM config used by nested reviewers (llm_config = {\"model\": \"gpt-3.5-turbo\"})." .

#################################################################
# Agents
#################################################################

:Agent_Writer a :LLMAgent ;
    :agentID "writer-1" ;
    :agentRole "Writer" ;
    :useLanguageModel :LM_gpt4o_mini ;
    :hasAgentConfig :Config_Writer_Client, :Config_Writer_SystemPrompt ;
    :hasPrompt :Prompt_Writer_System .
    
:Agent_Critic a :LLMAgent ;
    :agentID "critic-1" ;
    :agentRole "Critic" ;
    :useLanguageModel :LM_gpt4o_mini ;
    :hasAgentConfig :Config_Critic_Client, :Config_Critic_Initiate ;
    :hasPrompt :Prompt_Critic_System .

:Agent_SEO_Reviewer a :LLMAgent ;
    :agentID "seo-reviewer-1" ;
    :agentRole "SEO Reviewer" ;
    :useLanguageModel :LM_gpt3_5_turbo ;
    :hasAgentConfig :Config_SEO_LLM ;
    :hasPrompt :Prompt_SEO_System .

:Agent_Legal_Reviewer a :LLMAgent ;
    :agentID "legal-reviewer-1" ;
    :agentRole "Legal Reviewer" ;
    :useLanguageModel :LM_gpt3_5_turbo ;
    :hasAgentConfig :Config_Legal_LLM ;
    :hasPrompt :Prompt_Legal_System .

:Agent_Ethics_Reviewer a :LLMAgent ;
    :agentID "ethics-reviewer-1" ;
    :agentRole "Ethics Reviewer" ;
    :useLanguageModel :LM_gpt3_5_turbo ;
    :hasAgentConfig :Config_Ethics_LLM ;
    :hasPrompt :Prompt_Ethics_System .

:Agent_Meta_Reviewer a :LLMAgent ;
    :agentID "meta-reviewer-1" ;
    :agentRole "Meta Reviewer" ;
    :useLanguageModel :LM_gpt3_5_turbo ;
    :hasAgentConfig :Config_Meta_LLM ;
    :hasPrompt :Prompt_Meta_System .

#################################################################
# Team and goal
#################################################################

:Team_Blogpost_Crew a :Team ;
    :hasAgentMember :Agent_Writer, :Agent_Critic, :Agent_SEO_Reviewer, :Agent_Legal_Reviewer, :Agent_Ethics_Reviewer, :Agent_Meta_Reviewer ;
    :hasWorkflowPattern :Workflow_Reflection_Blogpost ;
    :hasTeamGoal :Goal_Blogpost .

:Goal_Blogpost a :Goal ;
    <http://purl.org/dc/terms/title> "Produce concise engaging blogpost about DeepLearning.AI with reviews/reflection" ;
    <http://purl.org/dc/terms/description> "Goal: create a concise (within 100 words) blogpost about DeepLearning.AI and refine it via a reflection process with multiple reviewers." .

#################################################################
# Task: Blogpost generation (writer)
#################################################################

:Task_Blogpost a :Task ;
    <http://purl.org/dc/terms/title> "Write blogpost - DeepLearning.AI" ;
    <http://purl.org/dc/terms/description> "Task instructs the Writer to produce a concise but engaging blogpost about DeepLearning.AI within 100 words." ;
    :taskPrompt :Prompt_Task_Blogpost ;
    :performedByAgent :Agent_Writer ;
    :producedResource :Resource_BlogpostDraft ;
    :contributesToObjective :Objective_Blogpost .

:Objective_Blogpost a :Objective ;
    <http://purl.org/dc/terms/description> "Objective: produce initial blogpost draft to be reviewed and refined." .

:Resource_BlogpostDraft a beam:Instance ;
    <http://purl.org/dc/terms/title> "Blogpost Draft (initial)" ;
    <http://purl.org/dc/terms/description> "Expected output: concise engaging blogpost (with title) about DeepLearning.AI, within 100 words." .

#################################################################
# Prompts (system messages and task prompts)
#################################################################

# Task prompt (the user-level task text)
:Prompt_Task_Blogpost a :Prompt ;
    :promptInstruction "Write a concise but engaging blogpost about\nDeepLearning.AI. Make sure the blogpost is\nwithin 100 words." ;
    :promptContext "User task provided to the Writer agent (variable 'task' in notebook)." ;
    :promptOutputIndicator "A concise blogpost (with title) within 100 words." .

# Writer system prompt (system_message in AssistantAgent creation)
:Prompt_Writer_System a :Prompt ;
    :promptInstruction "You are a writer. You write engaging and concise blogposts (with title) on given topics. You must polish your writing based on feedback and return a refined version." ;
    :promptContext "System message provided when creating the Writer assistant agent." .

# Critic system prompt
:Prompt_Critic_System a :Prompt ;
    :promptInstruction "You are a critic. You review the work of the writer and provide constructive feedback to help improve the quality of the content." ;
    :promptContext "Critic agent has a termination behavior: messages containing the substring 'TERMINATE' are treated as termination signal (implementation detail captured in config). The original code used a lambda; runtime behavior is documented in Config_Critic_Initiate." .

# SEO reviewer system prompt
:Prompt_SEO_System a :Prompt ;
    :promptInstruction "You are an SEO reviewer, known for your ability to optimize content for search engines, ensuring that it ranks well and attracts organic traffic. Make sure your suggestion is concise (within 3 bullet points), concrete and to the point. Begin the review by stating your role." ;
    :promptContext "System message for the SEO Reviewer." .

# Legal reviewer system prompt
:Prompt_Legal_System a :Prompt ;
    :promptInstruction "You are a legal reviewer, known for your ability to ensure that content is legally compliant and free from any potential legal issues. Make sure your suggestion is concise (within 3 bullet points), concrete and to the point. Begin the review by stating your role." ;
    :promptContext "System message for the Legal Reviewer." .

# Ethics reviewer system prompt
:Prompt_Ethics_System a :Prompt ;
    :promptInstruction "You are an ethics reviewer, known for your ability to ensure that content is ethically sound and free from any potential ethical issues. Make sure your suggestion is concise (within 3 bullet points), concrete and to the point. Begin the review by stating your role." ;
    :promptContext "System message for the Ethics Reviewer." .

# Meta reviewer system prompt
:Prompt_Meta_System a :Prompt ;
    :promptInstruction "You are a meta reviewer, you aggregate and review the work of other reviewers and give a final suggestion on the content." ;
    :promptContext "System message for the Meta Reviewer." .

# Reflection message template used by nested reviewers (captures the dynamic selection of the writer's last message)
:Prompt_Reflection_Template a :Prompt ;
    :promptInstruction "Review the following content.\n\n{DYNAMIC: the last message content from the Writer to be inserted here at runtime; original code uses recipient.chat_messages_for_summary(sender)[-1]['content']}." ;
    :promptContext "Template used to construct reviewer messages that reflect on the writer's most recent output (captured as a literal description of runtime behavior)." .

#################################################################
# Tasks for reviewers (nested chat tasks)
#################################################################

:Task_SEO_Review a :Task ;
    <http://purl.org/dc/terms/title> "SEO Review of blogpost" ;
    :taskPrompt :Prompt_SEO_Reflection ;
    :performedByAgent :Agent_SEO_Reviewer ;
    :producedResource :Resource_SEO_Review ;
    :contributesToObjective :Objective_Blogpost .

:Prompt_SEO_Reflection a :Prompt ;
    :promptInstruction "Review the following content. Return review into as JSON object only: {'Reviewer': '', 'Review': ''}. Here Reviewer should be your role." ;
    :promptContext "Reflection message template + summary instruction for SEO Reviewer." ;
    :promptOutputIndicator "JSON object only. Fields: Reviewer, Review." .

:Resource_SEO_Review a beam:Instance ;
    <http://purl.org/dc/terms/title> "SEO Review (JSON)" ;
    <http://purl.org/dc/terms/description> "JSON object with reviewer role and review text (as requested by summary prompt)." .

:Task_Legal_Review a :Task ;
    <http://purl.org/dc/terms/title> "Legal Review of blogpost" ;
    :taskPrompt :Prompt_Legal_Reflection ;
    :performedByAgent :Agent_Legal_Reviewer ;
    :producedResource :Resource_Legal_Review ;
    :contributesToObjective :Objective_Blogpost .

:Prompt_Legal_Reflection a :Prompt ;
    :promptInstruction "Review the following content. Return review into as JSON object only: {'Reviewer': '', 'Review': ''}." ;
    :promptContext "Reflection message template + summary instruction for Legal Reviewer." ;
    :promptOutputIndicator "JSON object only. Fields: Reviewer, Review." .

:Resource_Legal_Review a beam:Instance ;
    <http://purl.org/dc/terms/title> "Legal Review (JSON)" ;
    <http://purl.org/dc/terms/description> "JSON object with reviewer role and review text." .

:Task_Ethics_Review a :Task ;
    <http://purl.org/dc/terms/title> "Ethics Review of blogpost" ;
    :taskPrompt :Prompt_Ethics_Reflection ;
    :performedByAgent :Agent_Ethics_Reviewer ;
    :producedResource :Resource_Ethics_Review ;
    :contributesToObjective :Objective_Blogpost .

:Prompt_Ethics_Reflection a :Prompt ;
    :promptInstruction "Review the following content. Return review into as JSON object only: {'reviewer': '', 'review': ''}." ;
    :promptContext "Reflection message template + summary instruction for Ethics Reviewer (note lowercase keys in the original notebook)." ;
    :promptOutputIndicator "JSON object only. Fields: reviewer, review." .

:Resource_Ethics_Review a beam:Instance ;
    <http://purl.org/dc/terms/title> "Ethics Review (JSON)" ;
    <http://purl.org/dc/terms/description> "JSON object with reviewer role and review text." .

:Task_Meta_Aggregation a :Task ;
    <http://purl.org/dc/terms/title> "Meta aggregation of reviews" ;
    :taskPrompt :Prompt_Meta_Aggregation ;
    :performedByAgent :Agent_Meta_Reviewer ;
    :producedResource :Resource_Meta_Suggestion ;
    :contributesToObjective :Objective_Blogpost .

:Prompt_Meta_Aggregation a :Prompt ;
    :promptInstruction "Aggregate feedback from all reviewers and give final suggestions on the writing." ;
    :promptContext "Meta reviewer receives outputs of SEO, Legal, and Ethics reviewers and provides consolidated suggestions." ;
    :promptOutputIndicator "Consolidated suggestions and a final recommendation for the Writer." .

:Resource_Meta_Suggestion a beam:Instance ;
    <http://purl.org/dc/terms/title> "Meta Reviewer Suggestions" ;
    <http://purl.org/dc/terms/description> "Aggregate review and final suggestion to improve the blogpost." .

#################################################################
# Workflow pattern and steps
#################################################################

:Workflow_Reflection_Blogpost a :WorkflowPattern ;
    <http://purl.org/dc/terms/title> "Reflection and Blogpost Writing Pattern" ;
    <http://purl.org/dc/terms/description> "Workflow that generates a blogpost draft, then uses a critic and nested reviewers (SEO, Legal, Ethics) with a meta reviewer to aggregate suggestions and refine the draft." ;
    :hasWorkflowStep :Step_GenerateDraft, :Step_ReflectionAndReviews, :Step_Meta_Aggregation, :Step_End .

:Step_GenerateDraft a :StartStep ;
    rdfs:label "Generate Draft" ;
    :hasAssociatedTask :Task_Blogpost ;
    :stepOrder 1 ;
    :nextStep :Step_ReflectionAndReviews .

:Step_ReflectionAndReviews a :WorkflowStep ;
    rdfs:label "Reflection and Parallel Reviews" ;
    :hasAssociatedTask :Task_SEO_Review, :Task_Legal_Review, :Task_Ethics_Review ;
    :stepOrder 2 ;
    :nextStep :Step_Meta_Aggregation ;
    :hasConfig :Config_NestedChats_Registration .

:Step_Meta_Aggregation a :WorkflowStep ;
    rdfs:label "Meta Aggregation" ;
    :hasAssociatedTask :Task_Meta_Aggregation ;
    :stepOrder 3 ;
    :nextStep :Step_End .

:Step_End a :EndStep ;
    rdfs:label "End: Refine and finish" ;
    :hasAssociatedTask :Task_Blogpost ; # final polish by writer per system behavior
    :stepOrder 4 .

#################################################################
# Configurations (modeled with Config class and configKey/configValue)
#################################################################

# Writer client config (OpenAIChatCompletionClient creation)
:Config_Writer_Client a :Config ;
    :configKey "model" ;
    :configValue "gpt-4o-mini" ;
    <http://purl.org/dc/terms/description> "Client used in notebook: OpenAIChatCompletionClient(model='gpt-4o-mini', api_key='<REDACTED_API_KEY>'). API key redacted in this artifact." .

# Writer system prompt stored separately as config (duplicate of Prompt_Writer_System for quick lookup)
:Config_Writer_System a :Config ;
    :configKey "system_message" ;
    :configValue "You are a writer. You write engaging and concise blogposts (with title) on given topics. You must polish your writing based on feedback and return a refined version." .

# Critic client config (shares same client model as writer in notebook)
:Config_Critic_Client a :Config ;
    :configKey "model" ;
    :configValue "gpt-4o-mini" ;
    <http://purl.org/dc/terms/description> "Critic uses same client model instance as Writer in the notebook example." .

# Critic initiate call configuration (initiate_chat)
:Config_Critic_Initiate a :Config ;
    :configKey "initiate_chat_params" ;
    :configValue "max_turns=2; summary_method='last_msg'; trigger=writer (registered nested chats will be invoked when writer produces output)." ;
    <http://purl.org/dc/terms/description> "Represents parameters passed to critic.initiate_chat in the notebook (max_turns and summary method). The termination lambda for the Critic was encoded as a runtime function; see Config_Critic_Termination for documentation." .

:Config_Critic_Termination a :Config ;
    :configKey "termination_condition" ;
    :configValue "is_termination_msg: messages whose 'content' contains substring 'TERMINATE' are termination messages (the notebook used a lambda for this behavior)." .

# LLM default used by nested reviewers
:Config_SEO_LLM a :Config ;
    :configKey "model" ;
    :configValue "gpt-3.5-turbo" ;
    <http://purl.org/dc/terms/description> "This reflects llm_config = {\"model\": \"gpt-3.5-turbo\"} used by SEO reviewer in notebook." .

:Config_Legal_LLM a :Config ;
    :configKey "model" ;
    :configValue "gpt-3.5-turbo" .

:Config_Ethics_LLM a :Config ;
    :configKey "model" ;
    :configValue "gpt-3.5-turbo" .

:Config_Meta_LLM a :Config ;
    :configKey "model" ;
    :configValue "gpt-3.5-turbo" .

# Nested chat registration config that was passed to critic.register_nested_chats
:Config_NestedChats_Registration a :Config ;
    :configKey "nested_chats_registration" ;
    :configValue "List of reviewer entries (recipient, message template or text, summary_method, summary_args.summary_prompt, max_turns). Trigger: writer. Registered on Critic via register_nested_chats." ;
    <http://purl.org/dc/terms/description> "Original notebook structure (review_chats list) captured as a configuration literal. Each list element was a mapping consumed by the register_nested_chats call; see individual reviewer configs for extracted details." .

# Individual nested chat configs (extracting summary_method, summary_prompt, max_turns)
:Config_SEO_ReviewEntry a :Config ;
    :configKey "nested_entry" ;
    :configValue "recipient=SEO Reviewer; message=reflection_message(recipient, messages, sender, config); summary_method=reflection_with_llm; summary_args.summary_prompt=\"Return review into as JSON object only:{'Reviewer': '', 'Review': ''}. Here Reviewer should be your role\"; max_turns=1" .

:Config_Legal_ReviewEntry a :Config ;
    :configKey "nested_entry" ;
    :configValue "recipient=Legal Reviewer; message=reflection_message(...); summary_method=reflection_with_llm; summary_args.summary_prompt=\"Return review into as JSON object only:{'Reviewer': '', 'Review': ''}.\"; max_turns=1" .

:Config_Ethics_ReviewEntry a :Config ;
    :configKey "nested_entry" ;
    :configValue "recipient=Ethics Reviewer; message=reflection_message(...); summary_method=reflection_with_llm; summary_args.summary_prompt=\"Return review into as JSON object only:{'reviewer': '', 'review': ''}\"; max_turns=1" .

:Config_Meta_ReviewEntry a :Config ;
    :configKey "nested_entry" ;
    :configValue "recipient=Meta Reviewer; message='Aggregate feedback from all reviewers and give final suggestions on the writing.'; max_turns=1" .

#################################################################
# Links between workflow and agents/configs (semantics captured)
#################################################################

# The Critic registers nested chats to be invoked when writer produces content.
# This is captured by associating the registration config with the workflow step and describing the trigger in the config literal.
:Agent_Critic :hasConfig :Config_NestedChats_Registration .

# The nested reviewer tasks use the reflection template to obtain the writer's most recent content
:Task_SEO_Review :hasPrompt :Prompt_Reflection_Template, :Prompt_SEO_Reflection .
:Task_Legal_Review :hasPrompt :Prompt_Reflection_Template, :Prompt_Legal_Reflection .
:Task_Ethics_Review :hasPrompt :Prompt_Reflection_Template, :Prompt_Ethics_Reflection .

# The meta reviewer aggregates reviewer outputs (semantic link)
:Task_Meta_Aggregation :hasPrompt :Prompt_Meta_Aggregation ;
    <http://purl.org/dc/terms/description> "This task consumes JSON outputs from SEO, Legal, and Ethics reviewers and produces a consolidated suggestion object (the notebook orchestrates this via the Critic.register_nested_chats and nested chat flow)." .

#################################################################
# Provenance-style annotations and labels for readability
#################################################################

:Agent_Writer rdfs:label "Writer (LLM agent)" .
:Agent_Critic rdfs:label "Critic (LLM agent)" .
:Agent_SEO_Reviewer rdfs:label "SEO Reviewer (LLM agent)" .
:Agent_Legal_Reviewer rdfs:label "Legal Reviewer (LLM agent)" .
:Agent_Ethics_Reviewer rdfs:label "Ethics Reviewer (LLM agent)" .
:Agent_Meta_Reviewer rdfs:label "Meta Reviewer (LLM agent)" .
:Workflow_Reflection_Blogpost rdfs:label "Reflection and Blogpost Writing Workflow Pattern" .
:Task_Blogpost rdfs:label "Blogpost generation task" .
:Task_SEO_Review rdfs:label "SEO review task" .
:Task_Legal_Review rdfs:label "Legal review task" .
:Task_Ethics_Review rdfs:label "Ethics review task" .
:Task_Meta_Aggregation rdfs:label "Meta aggregation task" .
:Resource_BlogpostDraft rdfs:label "Blogpost Draft (resource)" .
:Resource_SEO_Review rdfs:label "SEO Review (resource)" .
:Resource_Legal_Review rdfs:label "Legal Review (resource)" .
:Resource_Ethics_Review rdfs:label "Ethics Review (resource)" .
:Resource_Meta_Suggestion rdfs:label "Meta Reviewer Suggestion (resource)" .

#################################################################
# End of instance population
#################################################################