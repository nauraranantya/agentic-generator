# Execution time: 97.04 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - Missing concept: "GroupChat" / "GroupChatManager" as first-class entities (represented here using Team and WorkflowPattern).
# - Missing concept: "ConversableAgent" and distinctions between human-operated proxies vs. programmatic agent instances. Human proxy modeled as HumanAgent; LLM-run agents modeled as LLMAgent.
# - Missing structured datatype for config objects (e.g., code_execution_config with nested keys). Configs are modeled as flat key/value pairs (multiple Config individuals) using existing Config, configKey, configValue.
# - Missing explicit representation of "human_input_mode" and "max_round" (chat control parameters). Modeled as config key/value literals on relevant Config individuals.
# - Missing explicit modeling for "GroupChat messages", "message sequencing", and "SDK-specific execution details". These are encoded as Prompt/Resource descriptions and WorkflowStep ordering only.
# - Missing explicit representation for "system_message" vs. "description" separation beyond using Prompt properties (promptInstruction / promptContext / promptOutputIndicator / promptInputData) and dcterms:title.
# - No new classes or properties were added. Where fine-grained constructs were not available, the information is preserved verbatim in prompt or config literals, or as resource descriptions.
@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .

# Language model used across LLM agents
:GPT4Turbo rdf:type :LanguageModel ;
    dcterms:title "gpt-4-turbo" ;
    dcterms:description "Statistical language model configured as llm_config={\"model\": \"gpt-4-turbo\"} in the source notebook." .

#################################################################
# Agents (individuals)
#################################################################

# Human admin / user proxy
:Admin rdf:type :HumanAgent ;
    dcterms:title "Admin" ;
    dcterms:description "User_proxy or Admin: allows the user to comment on the report and ask the writer to refine it. Created with human_input_mode=ALWAYS in the source configuration." .

# Planner (LLM agent)
:PlannerAgent rdf:type :LLMAgent ;
    dcterms:title "Planner" ;
    :agentRole "Planner" ;
    :useLanguageModel :GPT4Turbo ;
    :agentPrompt :PlannerPrompt ;
    :hasAgentConfig :PlannerConfig_Model ;
    :hasAgentGoal :WriteBlogGoal ;
    dcterms:description "Planner: determine information needed to complete the task, instruct remaining steps and handle failures/workarounds. System message and description preserved in associated prompt." .

# Engineer (LLM assistant agent that writes code)
:EngineerAgent rdf:type :LLMAgent ;
    dcterms:title "Engineer" ;
    :agentRole "Engineer" ;
    :useLanguageModel :GPT4Turbo ;
    :agentPrompt :EngineerPrompt ;
    :hasAgentConfig :EngineerConfig_Model ;
    :hasAgentGoal :WriteBlogGoal ;
    dcterms:description "Engineer: writes code based on planner's plan. Implemented as AssistantAgent in source; represented here semantically as an LLM agent that produces code artifacts." .

# Executor (LLM agent configured to execute code)
:ExecutorAgent rdf:type :LLMAgent ;
    dcterms:title "Executor" ;
    :agentRole "Executor" ;
    :useLanguageModel :GPT4Turbo ;
    :agentPrompt :ExecutorPrompt ;
    :hasAgentConfig :ExecutorConfig_Model ;
    :hasAgentConfig :ExecutorConfig_Execution ;
    :hasAgentGoal :WriteBlogGoal ;
    dcterms:description "Executor: execute the code written by the engineer and report the result. Configured with code_execution_config (last_n_messages=3, work_dir='coding', use_docker=False) and human_input_mode=NEVER in source." .

# Writer (LLM agent that composes the blog post)
:WriterAgent rdf:type :LLMAgent ;
    dcterms:title "Writer" ;
    :agentRole "Writer" ;
    :useLanguageModel :GPT4Turbo ;
    :agentPrompt :WriterPrompt ;
    :hasAgentConfig :WriterConfig_Model ;
    :hasAgentGoal :WriteBlogGoal ;
    dcterms:description "Writer: write the blog in markdown format, place content inside a pseudo ```md``` code block, and accept feedback from admin to refine the blog." .

#################################################################
# Prompts associated to agents and task
#################################################################

# Planner prompt (system_message + description)
:PlannerPrompt rdf:type :Prompt ;
    :promptInstruction """Given a task, please determine what information is needed to complete the task. Please note that the information will all be retrieved using Python code. Please only suggest information that can be retrieved using Python code. After each step is done by others, check the progress and instruct the remaining steps. If a step fails, try to workaround""" ;
    :promptContext "Planner. Given a task, determine what information is needed to complete the task. After each step is done by others, check the progress and instruct the remaining steps" ;
    dcterms:description "System message used when creating the Planner ConversableAgent in the source notebook." .

# Engineer prompt / description
:EngineerPrompt rdf:type :Prompt ;
    :promptInstruction "An engineer that writes code based on the plan provided by the planner." ;
    :promptContext "Engineer: writes code per planner's plan" ;
    dcterms:description "Agent type AssistantAgent in source: responsible for writing Python code to retrieve data and process results." .

# Executor system message
:ExecutorPrompt rdf:type :Prompt ;
    :promptInstruction "Execute the code written by the engineer and report the result." ;
    :promptContext "Executor: execute code and return execution results (no human input)." ;
    dcterms:description "Configured in source as ConversableAgent with human_input_mode=NEVER and a code_execution_config specifying last_n_messages, work_dir, and use_docker." .

# Writer system message and writing instructions
:WriterPrompt rdf:type :Prompt ;
    :promptInstruction """Writer.
Please write blogs in markdown format (with relevant titles) and put the content in pseudo ```md``` code block. You take feedback from the admin and refine your blog.""" ;
    :promptContext "Writer: write blogs based on the code execution results and take feedback from the admin to refine the blog." ;
    dcterms:description "System message and description used when creating the Writer ConversableAgent in source." .

# Task prompt (the user-provided task input)
:MainTaskPrompt rdf:type :Prompt ;
    :promptInstruction "Write a blogpost about the stock price performance of Nvidia in the past month. Today's date is 2024-04-23." ;
    :promptContext "User task message provided by the Admin/user proxy when initiating the group chat." ;
    dcterms:description "Task message passed to user_proxy.initiate_chat(manager, message=task) in the source notebook." .

#################################################################
# Configurations (as Config instances)
#################################################################

:PlannerConfig_Model rdf:type :Config ;
    :configKey "llm_config" ;
    :configValue "{\"model\": \"gpt-4-turbo\"}" ;
    dcterms:description "Planner LLM configuration (model selection) copied verbatim from source." .

:EngineerConfig_Model rdf:type :Config ;
    :configKey "llm_config" ;
    :configValue "{\"model\": \"gpt-4-turbo\"}" ;
    dcterms:description "Engineer LLM configuration." .

:ExecutorConfig_Model rdf:type :Config ;
    :configKey "llm_config" ;
    :configValue "{\"model\": \"gpt-4-turbo\"}" ;
    dcterms:description "Executor LLM configuration." .

:ExecutorConfig_Execution rdf:type :Config ;
    :configKey "code_execution_config" ;
    :configValue "{\"last_n_messages\": 3, \"work_dir\": \"coding\", \"use_docker\": false}" ;
    dcterms:description "Executor run-time execution configuration as provided in source (preserved as string)." .

:WriterConfig_Model rdf:type :Config ;
    :configKey "llm_config" ;
    :configValue "{\"model\": \"gpt-4-turbo\"}" ;
    dcterms:description "Writer LLM configuration." .

# Admin represented config to capture human input mode semantics (mode recorded as config on Admin proxy for traceability)
:AdminConfig_Interface rdf:type :Config ;
    :configKey "human_input_mode" ;
    :configValue "ALWAYS" ;
    dcterms:description "Admin/user proxy configuration indicating that human input is always required as per source." .

#################################################################
# Team (Group Chat) and Workflow Pattern
#################################################################

:GroupChatTeam rdf:type :Team ;
    dcterms:title "Stock Report Generation Group Chat" ;
    :hasAgentMember :Admin , :PlannerAgent , :EngineerAgent , :ExecutorAgent , :WriterAgent ;
    :hasWorkflowPattern :StockReportGenerationPattern ;
    :hasSystemConfig :GroupChatConfig ;
    dcterms:description "Represents the group chat coordinating agents: Admin (user proxy), Planner, Engineer, Executor, Writer. Modeled as a Team for lack of a dedicated GroupChat class in the ontology." .

:GroupChatConfig rdf:type :Config ;
    :configKey "max_round" ;
    :configValue "10" ;
    dcterms:description "Maximum rounds parameter used when constructing GroupChat(groupchat, max_round=10) in source." .

# Workflow pattern describing the flow of work among agents
:StockReportGenerationPattern rdf:type :WorkflowPattern ;
    dcterms:title "Stock Report Generation Pattern" ;
    :hasWorkflowStep :Step_Start ,
                     :Step_Planner ,
                     :Step_Engineer ,
                     :Step_Executor ,
                     :Step_Writer ,
                     :Step_AdminFeedback ,
                     :Step_End ;
    dcterms:description "Workflow pattern that structures the following steps: start -> planner determines information -> engineer writes code -> executor runs code -> writer writes blog -> admin feedback -> end." .

#################################################################
# Workflow Steps and associated Tasks
#################################################################

:Step_Start rdf:type :StartStep ;
    :stepOrder 1 ;
    dcterms:title "Start" ;
    rdfs:comment "Initial step: receive task from Admin and create MainTask." .

:PlanInformationTask rdf:type :Task ;
    dcterms:title "Plan Information Retrieval" ;
    :taskPrompt :PlannerPrompt ;
    :performedByAgent :PlannerAgent ;
    :contributesToObjective :StockReportObjective ;
    dcterms:description "Planner determines which information (stock prices, date range, sources, computation methods) is needed and specifies steps for retrieving it using Python code." .

:Step_Planner rdf:type :WorkflowStep ;
    :stepOrder 2 ;
    :hasAssociatedTask :PlanInformationTask ;
    dcterms:title "Planner Step" ;
    rdfs:comment "Planner defines plan and remaining steps, monitors progress and provides workarounds if steps fail." .

:WriteCodeTask rdf:type :Task ;
    dcterms:title "Engineer Write Code" ;
    :taskPrompt :EngineerPrompt ;
    :performedByAgent :EngineerAgent ;
    :requiresResource :StockDataResource ;
    :producedResource :CodeArtifact ;
    :contributesToObjective :StockReportObjective ;
    dcterms:description "Engineer implements Python code to retrieve stock data, compute required metrics, and produce artifacts for the writer. Code artifact contains instructions like 'retrieve historic prices, compute performance over last month, format data for report'." .

:Step_Engineer rdf:type :WorkflowStep ;
    :stepOrder 3 ;
    :hasAssociatedTask :WriteCodeTask ;
    dcterms:title "Engineer Step" .

:ExecuteCodeTask rdf:type :Task ;
    dcterms:title "Execute Code" ;
    :taskPrompt :ExecutorPrompt ;
    :performedByAgent :ExecutorAgent ;
    :requiresResource :CodeArtifact ;
    :producedResource :ExecutionResult ;
    :contributesToObjective :StockReportObjective ;
    dcterms:description "Executor runs the code produced by the Engineer in a specified working directory and returns execution outputs (e.g., numerical results, csv, figures). Execution config preserved on ExecutorConfig_Execution." .

:Step_Executor rdf:type :WorkflowStep ;
    :stepOrder 4 ;
    :hasAssociatedTask :ExecuteCodeTask ;
    dcterms:title "Executor Step" .

:WriteReportTask rdf:type :Task ;
    dcterms:title "Writer Compose Blog Post" ;
    :taskPrompt :WriterPrompt ;
    :performedByAgent :WriterAgent ;
    :requiresResource :ExecutionResult ;
    :producedResource :BlogDraft ;
    :contributesToObjective :StockReportObjective ;
    dcterms:description "Writer composes the blog post using execution results; writes in markdown format with relevant titles and places content inside a pseudo ```md``` code block. The writer should accept feedback from Admin and refine the blog." .

:Step_Writer rdf:type :WorkflowStep ;
    :stepOrder 5 ;
    :hasAssociatedTask :WriteReportTask ;
    dcterms:title "Writer Step" .

:AdminFeedbackTask rdf:type :Task ;
    dcterms:title "Admin Review & Feedback" ;
    :performedBy :Admin ;
    :contributesToObjective :StockReportObjective ;
    :requiresResource :BlogDraft ;
    :producedResource :BlogDraft_Refined ;
    dcterms:description "Admin (user_proxy) reviews the blog draft and provides feedback; the Writer will refine the blog accordingly. Modeled as a Task performed by a HumanAgent." .

:Step_AdminFeedback rdf:type :WorkflowStep ;
    :stepOrder 6 ;
    :hasAssociatedTask :AdminFeedbackTask ;
    dcterms:title "Admin Feedback Step" .

:Step_End rdf:type :EndStep ;
    :stepOrder 7 ;
    dcterms:title "End" ;
    rdfs:comment "Final step: blog finalized and process complete." .

#################################################################
# Objectives and Goals
#################################################################

:StockReportObjective rdf:type :Objective ;
    dcterms:title "Produce stock report content and artifacts" ;
    rdfs:comment "Collective objective: generate the data and draft necessary for the blog post." .

:WriteBlogGoal rdf:type :Goal ;
    dcterms:title "Write blogpost about Nvidia monthly performance (2024-04-23)" ;
    rdfs:comment "Goal assigned to agents/team: produce a final blog post about Nvidia's past-month stock performance given the task date 2024-04-23." .

#################################################################
# Resources (beam:Resource instances)
#################################################################

:StockDataResource rdf:type beam:Resource ;
    dcterms:title "Stock time-series data for NVDA" ;
    dcterms:description "Historic prices and metadata for Nvidia (NVDA) covering the past month. Intended to be retrieved via Python code. Source and retrieval instructions preserved in CodeArtifact description." .

:CodeArtifact rdf:type beam:Resource ;
    dcterms:title "Python code artifact for data retrieval and report generation" ;
    dcterms:description """Artifact produced by Engineer: Python scripts to retrieve NVDA historic prices, compute monthly performance metrics, and produce serialized outputs (csv, json, plots). Implementation details intentionally captured as a high-level description (no SDK-specific code insertion in ontology).""" .

:ExecutionResult rdf:type beam:Resource ;
    dcterms:title "Execution results (numerical metrics, plots, CSVs)" ;
    dcterms:description "Results produced by Executor after running CodeArtifact: computed performance metrics, figures, and any data files used by Writer to compose the blog." .

:BlogDraft rdf:type beam:Resource ;
    dcterms:title "Initial blog draft (markdown)" ;
    dcterms:description "Draft blog post in markdown format produced by Writer based on execution results. Contains title, textual analysis of stock performance, and optionally code-derived figures. Writer instructed to use pseudo ```md``` code block for content." .

:BlogDraft_Refined rdf:type beam:Resource ;
    dcterms:title "Refined blog draft after Admin feedback" ;
    dcterms:description "Blog draft refined by Writer after Admin (user_proxy) provides comments. Final deliverable of workflow." .

#################################################################
# Tool(s)
#################################################################

:CodingEnvironmentTool rdf:type :Tool ;
    dcterms:title "Coding/Execution Environment (conceptual)" ;
    :hasToolConfig :CodingEnvConfig ;
    :resourceUsage :CodeArtifact ;
    dcterms:description "Conceptual tool representing the environment used by Executor to run code. Config captured as key/value on Config individual." .

:CodingEnvConfig rdf:type :Config ;
    :configKey "executor_run_config" ;
    :configValue "{\"last_n_messages\": 3, \"work_dir\": \"coding\", \"use_docker\": false}" ;
    dcterms:description "Mirror of the Executor's code_execution_config. Stored as string to preserve full configuration semantics." .

#################################################################
# Links between Tasks, Resources, Tools, and Agents
#################################################################

# Who performs what tasks
:PlanInformationTask :performedByAgent :PlannerAgent .
:WriteCodeTask :performedByAgent :EngineerAgent .
:ExecuteCodeTask :performedByAgent :ExecutorAgent .
:WriteReportTask :performedByAgent :WriterAgent .
# AdminFeedbackTask is performed by a HumanAgent (Admin). There's no performedByAgent property for human; use beam:participatedIn subproperty humanParticipatedIn exists: use it to link Admin to the AdminFeedbackTask
:Admin rdf:type :HumanAgent ;
    :humanParticipatedIn :AdminFeedbackTask .

# Resource usage / production
:PlannerAgent :agentResourceUsage :StockDataResource .
:EngineerAgent :agentResourceUsage :CodeArtifact .
:ExecutorAgent :agentResourceUsage :ExecutionResult .
:WriterAgent :agentResourceUsage :BlogDraft .
:WriterAgent :agentToolUsage :CodingEnvironmentTool .
:ExecuteCodeTask :performedBy :CodingEnvironmentTool .
:ExecuteCodeTask :producedResource :ExecutionResult .
:WriteCodeTask :producedResource :CodeArtifact .
:WriteReportTask :producedResource :BlogDraft .
:AdminFeedbackTask :producedResource :BlogDraft_Refined .

# Task to objective mapping
:PlanInformationTask :contributesToObjective :StockReportObjective .
:WriteCodeTask :contributesToObjective :StockReportObjective .
:ExecuteCodeTask :contributesToObjective :StockReportObjective .
:WriteReportTask :contributesToObjective :StockReportObjective .
:AdminFeedbackTask :contributesToObjective :StockReportObjective .

#################################################################
# Relationships among agents
#################################################################

:PlannerAgent :interactsWith :EngineerAgent , :ExecutorAgent , :WriterAgent .
:EngineerAgent :interactsWith :ExecutorAgent .
:ExecutorAgent :interactsWith :WriterAgent .
:WriterAgent :interactsWith :Admin .

#################################################################
# Task-level prompt linking
#################################################################

:MainTask rdf:type :Task ;
    dcterms:title "Main user task: blogpost about NVDA" ;
    :taskPrompt :MainTaskPrompt ;
    :contributesToObjective :StockReportObjective ;
    dcterms:description "Top-level task given by Admin that initiates the workflow. Text preserved in MainTaskPrompt." .

# Link workflow steps to tasks
:Step_Start :hasAssociatedTask :MainTask .
:Step_Planner :hasAssociatedTask :PlanInformationTask .
:Step_Engineer :hasAssociatedTask :WriteCodeTask .
:Step_Executor :hasAssociatedTask :ExecuteCodeTask .
:Step_Writer :hasAssociatedTask :WriteReportTask .
:Step_AdminFeedback :hasAssociatedTask :AdminFeedbackTask .

#################################################################
# Misc metadata and titles for clarity
#################################################################

:StockReportGenerationPattern dcterms:description "Pattern created from the notebook 'L6-Planning_and_Stock_Report_Generation.ipynb'. Captures the sequence of roles (Admin/Planner/Engineer/Executor/Writer), their responsibilities, and the artifacts exchanged." .

:GroupChatTeam dcterms:description "Team modeled for the notebook group chat. Preserves the mapping of agent roles and workflow pattern." .