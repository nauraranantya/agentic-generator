# Execution time: 82.46 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - ConversableAgent and AssistantAgent classes used in the source are not defined in the ontology. They are represented here as instances of :LLMAgent (ontology contains :LLMAgent). No new classes/properties were created.
# - The runtime system message content for code_writer_agent (retrieved as code_writer_agent.system_message and printed) is not present in the notebook source. A Prompt instance is created to record that the system message existed but its exact content is unknown.
# - The notebook computes "today" at runtime. The prompt stored here preserves the prompt template with the placeholder "{today}" to indicate runtime insertion. The ontology cannot model the runtime substitution operation; the prompt literal records the template text.
# - Low-level implementation details (Python-specific constructs, SDK calls, code blocks, cell execution order, etc.) are intentionally not modeled. Only semantic entities, configurations, interactions, prompts, tasks, resources, and workflow steps are modeled.
# - Some configuration key/value pairs are represented in Config individuals using repeated :configKey and :configValue properties (the ontology models Config as key/value string pairs only). Pairing between keys and values are represented by making atomic Config individuals when pairing clarity is needed (e.g., executor tool's timeout and work_dir).
# - The chat session result variable (chat_result) is modeled as a Resource instance (beam:Instance) with description rather than preserving serialized message exchange contents (none were provided).
# - No new properties were invented to represent "human_input_mode" or "default_auto_reply"; those are stored in :Config individuals as key/value literals because the ontology does not contain dedicated properties for these runtime settings.
# - No source code content is embedded; instructions and important textual literals (prompts, file names, model id) are preserved as prompt strings, config values, labels, and descriptions.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@base <http://www.w3id.org/agentic-ai/onto#> .

#################################################################
# Individuals describing the "L5_Coding_and_Financial_Analysis.ipynb" solution
#################################################################

### Agents (mapped to ontology :LLMAgent)
:code_executor_agent rdf:type :LLMAgent ;
    :agentID "code_executor_agent" ;
    :agentRole "conversable code executor" ;
    rdfs:label "code_executor_agent" ;
    :hasAgentConfig :code_executor_agent_config ;
    :agentToolUsage :local_cmd_executor_tool ;
    :interactsWith :code_writer_agent ;
    beam:participatedIn :stock_analysis_task ;
    rdfs:comment "Agent that initiates chats, can execute code via a local command-line executor. Created with human_input_mode='ALWAYS' in source." .

:code_writer_agent rdf:type :LLMAgent ;
    :agentID "code_writer_agent" ;
    :agentRole "assistant code writer" ;
    rdfs:label "code_writer_agent" ;
    :hasAgentConfig :code_writer_agent_config ;
    :useLanguageModel :gpt4_turbo_model ;
    :agentPrompt :code_writer_agent_system_prompt ;
    :interactsWith :code_executor_agent ;
    beam:participatedIn :stock_analysis_task ;
    rdfs:comment "Agent used to write code. Created with llm_config={'model':'gpt-4-turbo'} and human_input_mode='NEVER' in source." .

#################################################################
# Tools and Models
#################################################################

:local_cmd_executor_tool rdf:type :Tool ;
    rdfs:label "LocalCommandLineCodeExecutor" ;
    rdfs:comment "Local command-line code executor used to run code with timeout and working directory." ;
    :hasToolConfig :local_cmd_executor_config_timeout , :local_cmd_executor_config_workdir .

:local_cmd_executor_config_timeout rdf:type :Config ;
    :configKey "timeout" ;
    :configValue "60" ;
    rdfs:comment "Timeout (seconds) configuration for LocalCommandLineCodeExecutor." .

:local_cmd_executor_config_workdir rdf:type :Config ;
    :configKey "work_dir" ;
    :configValue "coding" ;
    rdfs:comment "Working directory configuration for LocalCommandLineCodeExecutor." .

:gpt4_turbo_model rdf:type :LanguageModel ;
    rdfs:label "gpt-4-turbo" ;
    rdfs:comment "Language model referenced in llm_config for code_writer_agent (llm_config = {\"model\": \"gpt-4-turbo\"})." .

#################################################################
# Configuration attached to agents
#################################################################

:code_executor_agent_config rdf:type :Config ;
    :configKey "llm_config" ;
    :configValue "False" ;
    :configKey "code_execution_config" ;
    :configValue "executor: LocalCommandLineCodeExecutor" ;
    :configKey "human_input_mode" ;
    :configValue "ALWAYS" ;
    :configKey "default_auto_reply" ;
    :configValue "Please continue. If everything is done, reply 'TERMINATE'." ;
    rdfs:comment "Agent-level configuration captured from the notebook: llm_config=False, code_execution_config includes executor reference, human_input_mode=ALWAYS, default_auto_reply set." .

:code_writer_agent_config rdf:type :Config ;
    :configKey "llm_config" ;
    :configValue "{\"model\": \"gpt-4-turbo\"}" ;
    :configKey "code_execution_config" ;
    :configValue "False" ;
    :configKey "human_input_mode" ;
    :configValue "NEVER" ;
    rdfs:comment "Agent-level configuration captured from the notebook for the code_writer_agent." .

#################################################################
# Prompts and messages
#################################################################

:stock_analysis_prompt rdf:type :Prompt ;
    :promptInstruction "Today is {today}. Create a plot showing stock gain YTD for NVDA and TLSA. Make sure the code is in markdown code block and save the figure to a file ytd_stock_gains.png." ;
    :promptInputData "NVDA, TLSA" ;
    :promptOutputIndicator "A markdown code block containing runnable code and a saved image file ytd_stock_gains.png" ;
    :promptContext "Message constructed at runtime in notebook using f-string with today's date inserted at runtime (placeholder {today} preserved here)." ;
    rdfs:label "Stock analysis task prompt" .

:code_writer_agent_system_prompt rdf:type :Prompt ;
    rdfs:label "code_writer_agent system message (runtime)" ;
    :promptInstruction "System message generated by code_writer_agent at creation time. Content not present in the notebook source; retrieved at runtime and printed in the notebook." ;
    :promptContext "The source obtains code_writer_agent.system_message and prints it; exact content is not available in the provided artifact." .

#################################################################
# Task, Artifacts, and Chat session
#################################################################

:stock_analysis_task rdf:type :Task ;
    rdfs:label "Stock Analysis: YTD Stock Gain Plot" ;
    :taskPrompt :stock_analysis_prompt ;
    :performedByAgent :code_writer_agent , :code_executor_agent ;
    :performedBy :local_cmd_executor_tool ;
    :producedResource :ytd_stock_gains_png , :chat_session_1 ;
    :contributesToObjective :produce_stock_plot_objective ;
    rdfs:comment "A task requesting generating a YTD stock gains plot for NVDA and TLSA. The code_writer_agent composes the code and the code_executor_agent executes it using the LocalCommandLineCodeExecutor." .

:ytd_stock_gains_png rdf:type beam:Instance ;
    rdfs:label "ytd_stock_gains.png" ;
    <http://purl.org/dc/terms/description> "PNG image file saved by the code executor containing the YTD stock gain plot for NVDA and TLSA. Filename specified in prompt." .

:chat_session_1 rdf:type beam:Instance ;
    rdfs:label "chat_result (chat session artifact)" ;
    <http://purl.org/dc/terms/description> "Result of initiating chat: chat_result = code_executor_agent.initiate_chat(code_writer_agent, message=message). Represents the chat session/response resource created by the notebook run (content not captured here)." .

#################################################################
# Workflow pattern and steps (two-step interaction)
#################################################################

:l5_coding_financial_analysis_pattern rdf:type :WorkflowPattern ;
    rdfs:label "L5 Coding and Financial Analysis Pattern" ;
    rdfs:comment "Workflow pattern used in the notebook: an initiating agent requests code generation from a code-writing agent, then a code-executor agent runs the code and saves outputs." ;
    :hasWorkflowStep :step1_write_code , :step2_execute_code .

:step1_write_code rdf:type :StartStep ;
    rdfs:label "Step 1: Write Code" ;
    :stepOrder "1"^^xsd:integer ;
    :hasAssociatedTask :stock_analysis_task ;
    :nextStep :step2_execute_code ;
    rdfs:comment "The code_writer_agent composes code in response to the task prompt. The notebook instructs that the code must be in a markdown code block." .

:step2_execute_code rdf:type :EndStep ;
    rdfs:label "Step 2: Execute Code" ;
    :stepOrder "2"^^xsd:integer ;
    :hasAssociatedTask :stock_analysis_task ;
    rdfs:comment "The code_executor_agent runs the code using LocalCommandLineCodeExecutor, producing the image file ytd_stock_gains.png and chat session artifact." .

#################################################################
# Objectives and goals
#################################################################

:produce_stock_plot_objective rdf:type :Objective ;
    rdfs:label "Produce stock gain YTD plot objective" ;
    :contributesToGoal :lesson_goal ;
    rdfs:comment "Objective that maps to the notebook task: produce a saved plot file showing YTD gains for given tickers." .

:lesson_goal rdf:type :Goal ;
    rdfs:label "Lesson 5: Coding and Financial Analysis Goal" ;
    rdfs:comment "Higher-level goal for the notebook lesson: demonstrate code generation and execution for a financial analysis task." .

#################################################################
# Participation and relationships
#################################################################

# Agents participated in the task
:code_executor_agent beam:participatedIn :stock_analysis_task .
:code_writer_agent beam:participatedIn :stock_analysis_task .

# Agent-tool relationships
:code_executor_agent :agentToolUsage :local_cmd_executor_tool .
:local_cmd_executor_tool :hasToolConfig :local_cmd_executor_config_timeout , :local_cmd_executor_config_workdir .

# Link produced artifacts to task
:stock_analysis_task :producedResource :ytd_stock_gains_png , :chat_session_1 .

#################################################################
# End of instance data for the notebook
#################################################################