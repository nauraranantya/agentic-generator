# Execution time: 94.68 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - The ontology has no explicit property to record the "executor" relationship between a registered tool function and the agent that executes it (i.e., the register_function caller vs. executor mapping). I represented the executor by typing the executor as a :Tool and linking the Task to that executor via :performedBy (domain Task, range Tool) and by describing registration details in Config literals on the calling agents.
# - Nested chat registration (triggering of nested chats, chat queues and summary_method) is not directly representable with existing classes/properties. I encoded nested-chat configuration as :Config literals attached to each agent (via :hasAgentConfig) preserving the exact parameters used in the source code.
# - There is no property for representing function signatures or parameter types. I preserved function names, parameter descriptions and behavioral summaries as rdfs:comment on the corresponding Tool and Task individuals and as :Config literals.
# - There is no property for capturing the runtime "made_move" termination predicate or how it is registered (is_termination_msg). I encoded its semantics and config value as a literal in a :Config attached to the Board Proxy tool.
# - The ontology does not include an explicit "chat" or "nested chat" class. Those aspects have been captured as configuration strings on the relevant agents.
# - The ontology does not include temporal/turn-taking semantics or an explicit property for "initiates chat". I represented the initial message as a Task with a prompt and included the literal message text.
# - No classes/properties were added or changed; all modeling uses existing classes/properties only.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@base <http://www.w3id.org/agentic-ai/onto#> .

#################################################################
# Language model(s)
#################################################################

:LM_gpt_4_turbo a :LanguageModel ;
    rdfs:label "gpt-4-turbo (language model)" ;
    rdfs:comment "Language model used by player agents. Configured in agent llm_config as model: gpt-4-turbo." .

#################################################################
# Resources / Environment / Board State
#################################################################

:ChessEnvironment a :Environment ;
    rdfs:label "Chess Environment" ;
    rdfs:comment "Environment containing the chess board resource." ;
    :containsResource :ChessBoard .

:ChessBoard a beam:Instance ;
    rdfs:label "Chess board (initial state)" ;
    rdfs:comment "A chess.Board instance representing the current game state. Initially set to the standard chess starting position. This resource is read and updated by board-executed tools (get_legal_moves, make_move)." .

:LegalMovesList a beam:Instance ;
    rdfs:label "Legal moves list (UCI format)" ;
    rdfs:comment "A derived resource containing a comma-separated list of legal moves in UCI format as returned by the get_legal_moves tool." .

#################################################################
# Capabilities
#################################################################

:Capability_Play_Chess a :Capability ;
    rdfs:label "Play chess" ;
    rdfs:comment "General capability to select and execute chess moves." .

:Capability_Request_Legal_Moves a :Capability ;
    rdfs:label "Request legal moves" ;
    rdfs:comment "Capability to request the current legal moves from the board." .

:Capability_Make_Move a :Capability ;
    rdfs:label "Make move" ;
    rdfs:comment "Capability to request the board to apply a move in UCI format and update the board state." .

#################################################################
# Agents
#################################################################

:Player_White a :LLMAgent ;
    rdfs:label "Player White (LLM agent)" ;
    :agentID "player_white" ;
    :agentRole "white" ;
    :agentPrompt :Prompt_Player_White_SystemMessage ;
    :hasAgentConfig :Config_Player_White_Model ,
                    :Config_Player_White_Tools ,
                    :Config_Player_White_NestedChats ;
    :hasAgentCapability :Capability_Play_Chess ,
                        :Capability_Request_Legal_Moves ,
                        :Capability_Make_Move ;
    beam:participatedIn :Task_Initiate_Chat_By_Black ,
                        :Task_GetLegalMoves ,
                        :Task_MakeMove ;
    :useLanguageModel :LM_gpt_4_turbo .

:Player_Black a :LLMAgent ;
    rdfs:label "Player Black (LLM agent)" ;
    :agentID "player_black" ;
    :agentRole "black" ;
    :agentPrompt :Prompt_Player_Black_SystemMessage ;
    :hasAgentConfig :Config_Player_Black_Model ,
                    :Config_Player_Black_Tools ,
                    :Config_Player_Black_NestedChats ;
    :hasAgentCapability :Capability_Play_Chess ,
                        :Capability_Request_Legal_Moves ,
                        :Capability_Make_Move ;
    beam:participatedIn :Task_Initiate_Chat_By_Black ,
                        :Task_GetLegalMoves ,
                        :Task_MakeMove ;
    :useLanguageModel :LM_gpt_4_turbo .

#################################################################
# Board Proxy (executor of tool-functions) as Agent + Tool
#################################################################

:BoardProxy a :Tool , <http://www.w3.org/ns/prov#Agent> ;
    rdfs:label "Board Proxy (executor agent/tool)" ;
    rdfs:comment "A conversational proxy agent that executes board-related tools (get_legal_moves, make_move). Created with llm_config=False in code; it receives tool execution requests and applies them to the ChessBoard resource." ;
    :hasToolConfig :Config_BoardProxy_llm_config ,
                   :Config_BoardProxy_is_termination_msg ,
                   :Config_BoardProxy_default_auto_reply ,
                   :Config_BoardProxy_human_input_mode ;
    :resourceUsage :ChessBoard .

#################################################################
# Prompts (system messages and initial messages)
#################################################################

:Prompt_Player_White_SystemMessage a :Prompt ;
    rdfs:label "Player White system message" ;
    :promptInstruction "You are a chess player and you play as white. First call get_legal_moves(), to get a list of legal moves. Then call make_move(move) to make a move." ;
    rdfs:comment "System message passed to Player White agent. This instructs the agent to first call the get_legal_moves tool and then call make_move(move) to make a move." .

:Prompt_Player_Black_SystemMessage a :Prompt ;
    rdfs:label "Player Black system message" ;
    :promptInstruction "You are a chess player and you play as black. First call get_legal_moves(), to get a list of legal moves. Then call make_move(move) to make a move." ;
    rdfs:comment "System message passed to Player Black agent. This instructs the agent to first call the get_legal_moves tool and then call make_move(move) to make a move." .

:Prompt_Initiate_Chat_Message a :Prompt ;
    rdfs:label "Initial chat message from Black to White" ;
    :promptInstruction "Let's play chess! Your move." ;
    rdfs:comment "This is the initiating message sent by Player Black to Player White at the start of the game (player_black.initiate_chat(player_white, message=\"Let's play chess! Your move.\"))." .

#################################################################
# Tools (registered functions)
#################################################################

# Note: tools are modeled as :Tool individuals; actual executor is BoardProxy (a :Tool and prov:Agent).
:Tool_get_legal_moves a :Tool ;
    rdfs:label "get_legal_moves (tool)" ;
    rdfs:comment "Registered tool name: 'get_legal_moves'. Description: Get legal moves. Returns a comma-separated list of legal moves in UCI format. In code, returns: 'Possible moves are: ' + ','.join([str(move) for move in board.legal_moves]). This tool reads the ChessBoard resource and produces a LegalMovesList resource." ;
    :hasToolConfig :Config_Tool_get_legal_moves_Description ;
    :hasCapability :Capability_Request_Legal_Moves ;
    :resourceUsage :ChessBoard .

:Tool_make_move a :Tool ;
    rdfs:label "make_move (tool)" ;
    rdfs:comment "Registered tool name: 'make_move'. Description: apply a move in UCI format to the ChessBoard. Parameters: move (string, UCI). Behavior summary preserved: (1) convert the provided string to a chess.Move, push the move to the board state, set a made_move flag to True, display the board (SVG), identify the moved piece and return a human-readable message 'Moved <PieceName> (<PieceSymbol>) from <from_square> to <to_square>.' This tool reads and updates the ChessBoard resource and causes a termination predicate (is_termination_msg) to become true for nested chat closing." ;
    :hasToolConfig :Config_Tool_make_move_Description ;
    :hasCapability :Capability_Make_Move ;
    :resourceUsage :ChessBoard ;
    :producedResource :ChessBoard .

#################################################################
# Tasks (activities)
#################################################################

:Task_GetLegalMoves a :Task ;
    rdfs:label "Task: Get legal moves" ;
    rdfs:comment "Task corresponding to a call to the get_legal_moves tool. Caller: a player agent (player_white or player_black). Executor: BoardProxy (tool/agent). Outputs a LegalMovesList resource containing legal moves in UCI format." ;
    :requiresResource :ChessBoard ;
    :performedBy :BoardProxy ;
    :producedResource :LegalMovesList ;
    :taskPrompt :Prompt_GetLegalMoves_Instructions .

:Task_MakeMove a :Task ;
    rdfs:label "Task: Make move" ;
    rdfs:comment "Task corresponding to a call to the make_move tool. Caller: a player agent (player_white or player_black). Parameters: move (UCI string). Executor: BoardProxy (tool/agent). Behavior: update the ChessBoard resource and return a textual summary describing the moved piece, its symbol, and squares." ;
    :requiresResource :ChessBoard ;
    :performedBy :BoardProxy ;
    :producedResource :ChessBoard ;
    :taskPrompt :Prompt_MakeMove_Instructions .

:Task_Initiate_Chat_By_Black a :Task ;
    rdfs:label "Task: Initiate chat (black -> white)" ;
    rdfs:comment "Task representing the initial action of player_black initiating the chat with player_white. In code invoked via player_black.initiate_chat(player_white, message=\"Let's play chess! Your move.\")." ;
    :performedBy :Player_Black ;
    :producedResource :LegalMovesList ;
    :taskPrompt :Prompt_Initiate_Chat_Message .

#################################################################
# Prompts for tasks (auxiliary)
#################################################################

:Prompt_GetLegalMoves_Instructions a :Prompt ;
    rdfs:label "Prompt for get_legal_moves tool call" ;
    :promptInstruction "Call get_legal_moves() to obtain the legal moves in UCI format; parse or present the returned comma-separated list to decide on the next move." ;
    rdfs:comment "Guidance for agents on how to use the get_legal_moves tool return value." .

:Prompt_MakeMove_Instructions a :Prompt ;
    rdfs:label "Prompt for make_move tool call" ;
    :promptInstruction "Call make_move(move) with a single move argument in UCI format when selecting a move to apply. Expect a textual confirmation describing the moved piece and board update." ;
    rdfs:comment "Guidance for agents on how to call the make_move tool." .

#################################################################
# Task registration / participation mapping (caller -> task)
#################################################################

# Both player agents can call the tasks (they participate in the tasks as callers)
:Player_White beam:participatedIn :Task_GetLegalMoves , :Task_MakeMove .
:Player_Black beam:participatedIn :Task_GetLegalMoves , :Task_MakeMove .

#################################################################
# Workflow pattern: Conversational Chess game
#################################################################

:WorkflowPattern_Conversational_Chess a :WorkflowPattern ;
    rdfs:label "Conversational Chess Workflow Pattern" ;
    rdfs:comment "A workflow pattern describing the conversational chess lesson: (1) initiation by black, (2) player alternating turns: request legal moves, choose and make a move, board applies move, repeat until termination." ;
    :hasWorkflowStep :Step_Start_Initiation ,
                     :Step_Player_White_Turn ,
                     :Step_Player_Black_Turn ,
                     :Step_End_Game .

:Step_Start_Initiation a :StartStep , :WorkflowStep ;
    rdfs:label "Start: Black initiates chat" ;
    :hasAssociatedTask :Task_Initiate_Chat_By_Black ;
    :stepOrder "1"^^xsd:integer .

:Step_Player_White_Turn a :WorkflowStep ;
    rdfs:label "Workflow step: Player White's turn" ;
    :hasAssociatedTask :Task_GetLegalMoves , :Task_MakeMove ;
    :stepOrder "2"^^xsd:integer .

:Step_Player_Black_Turn a :WorkflowStep ;
    rdfs:label "Workflow step: Player Black's turn" ;
    :hasAssociatedTask :Task_GetLegalMoves , :Task_MakeMove ;
    :stepOrder "3"^^xsd:integer ;
    :nextStep :Step_Player_White_Turn .

:Step_End_Game a :EndStep ;
    rdfs:label "End step: Game termination" ;
    rdfs:comment "Represents end of the workflow when the termination predicate configured on BoardProxy becomes true or game termination conditions are reached." ;
    :stepOrder "99"^^xsd:integer .

#################################################################
# Team that contains the two player agents and follows the workflow
#################################################################

:ChessPlayersTeam a :Team ;
    rdfs:label "Chess players team" ;
    rdfs:comment "A coordinated pair of agents (Player White and Player Black) that participate in the Conversational Chess workflow." ;
    :hasAgentMember :Player_White , :Player_Black ;
    :hasWorkflowPattern :WorkflowPattern_Conversational_Chess ;
    :hasSystemConfig :Config_Team_Description .

#################################################################
# Configurations (preserve parameter values and textual descriptions)
#################################################################

# Agent-level configs (llm_config and tools registration)
:Config_Player_White_Model a :Config ;
    :configKey "model" ;
    :configValue "gpt-4-turbo" ;
    rdfs:comment "LLM model configuration for Player White (llm_config['model'] = 'gpt-4-turbo')." .

:Config_Player_White_Tools a :Config ;
    :configKey "tools" ;
    :configValue "get_legal_moves, make_move" ;
    rdfs:comment "List of tool names registered into Player White's llm_config as their available tool set." .

:Config_Player_White_NestedChats a :Config ;
    :configKey "nested_chats" ;
    :configValue "trigger=player_black; chat_queue=[{sender=BoardProxy, recipient=Player_White, summary_method=last_msg}]" ;
    rdfs:comment "Nested chat configuration registered for Player White; encoded verbatim from code: player_white.register_nested_chats(trigger=player_black, chat_queue=[{sender: board_proxy, recipient: player_white, summary_method: 'last_msg'}])." .

:Config_Player_Black_Model a :Config ;
    :configKey "model" ;
    :configValue "gpt-4-turbo" ;
    rdfs:comment "LLM model configuration for Player Black (llm_config['model'] = 'gpt-4-turbo')." .

:Config_Player_Black_Tools a :Config ;
    :configKey "tools" ;
    :configValue "get_legal_moves, make_move" ;
    rdfs:comment "List of tool names registered into Player Black's llm_config as their available tool set." .

:Config_Player_Black_NestedChats a :Config ;
    :configKey "nested_chats" ;
    :configValue "trigger=player_white; chat_queue=[{sender=BoardProxy, recipient=Player_Black, summary_method=last_msg}]" ;
    rdfs:comment "Nested chat configuration registered for Player Black; encoded verbatim from code: player_black.register_nested_chats(trigger=player_white, chat_queue=[{sender: board_proxy, recipient: player_black, summary_method: 'last_msg'}])." .

# BoardProxy tool-specific configs (preserve special flags and semantics)
:Config_BoardProxy_llm_config a :Config ;
    :configKey "llm_config" ;
    :configValue "False" ;
    rdfs:comment "BoardProxy was created with llm_config=False indicating it does not call an LLM for its own behavior." .

:Config_BoardProxy_is_termination_msg a :Config ;
    :configKey "is_termination_msg" ;
    :configValue "check_made_move: a predicate that returns True when the global made_move flag is set (used to close nested chats when a move has been made)." ;
    rdfs:comment "Encoded description of the check_made_move termination function attached to the BoardProxy in the source code." .

:Config_BoardProxy_default_auto_reply a :Config ;
    :configKey "default_auto_reply" ;
    :configValue "Please make a move." ;
    rdfs:comment "Default auto-reply text configured for BoardProxy." .

:Config_BoardProxy_human_input_mode a :Config ;
    :configKey "human_input_mode" ;
    :configValue "NEVER" ;
    rdfs:comment "Human input mode for the BoardProxy was set to 'NEVER' in code." .

# Tool descriptions encoded as configs (auxiliary)
:Config_Tool_get_legal_moves_Description a :Config ;
    :configKey "description" ;
    :configValue "Get legal moves. Returns 'Possible moves are: ' + comma-separated UCI moves. No parameters." ;
    rdfs:comment "Preserves the user-visible description string used at registration time." .

:Config_Tool_make_move_Description a :Config ;
    :configKey "description" ;
    :configValue "Call this tool to make a move. Parameter: move (UCI string). Applies the move to the ChessBoard and returns a textual confirmation about the moved piece and squares." ;
    rdfs:comment "Preserves the user-visible description string used at registration time." .

# Team-level config
:Config_Team_Description a :Config ;
    :configKey "description" ;
    :configValue "Team composed of two player agents that alternate turns using interactive tools against a shared ChessBoard resource. Workflow pattern: Conversational Chess." .

#################################################################
# Additional linking and provenance hints
#################################################################

# Indicate that each Task conceptually corresponds to the registered tool names
:Task_GetLegalMoves rdfs:seeAlso :Tool_get_legal_moves .
:Task_MakeMove rdfs:seeAlso :Tool_make_move .

# Indicate ordering between workflow steps where appropriate
:Step_Start_Initiation :nextStep :Step_Player_White_Turn .
:Step_Player_White_Turn :nextStep :Step_Player_Black_Turn .
:Step_Player_Black_Turn :nextPattern :Step_Player_White_Turn .  # cyclic turn-taking (represented via existing properties)

#################################################################
# Human Agent (not used here but present in ontology) - omitted
#################################################################

# End of instance data.